{"decls":[{"body":["std.vec.extend_bytes","v","b"],"kind":"defn","name":"main.append_bytes","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"}],"result":"vec_u8"},{"body":["std.vec.push","v",10],"kind":"defn","name":"main.append_newline","params":[{"name":"v","ty":"vec_u8"}],"result":"vec_u8"},{"body":["if",["=",["view.len","b"],0],["std.vec.extend_bytes","v","fallback"],["std.vec.extend_bytes","v","b"]],"kind":"defn","name":"main.append_opt_view_or","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"},{"name":"fallback","ty":"bytes_view"}],"result":"vec_u8"},{"body":["std.vec.extend_bytes","v",["std.fmt.u32_to_dec","x"]],"kind":"defn","name":"main.append_u32","params":[{"name":"v","ty":"vec_u8"},{"name":"x","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","sha",["ext.crypto.sha256","msg"]],["ext.hex.hex_encode",["bytes.view","sha"]]],"kind":"defn","name":"main.sha256_hex","params":[{"name":"msg","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.crypto","ext.hex","ext.json.pointer","std.bytes","std.codec","std.fmt","std.fs","std.kv","std.path","std.rr","std.text.ascii","std.text.slices","std.vec"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.1.0","solve":["begin",["let","dir_len",["view.len","input"]],["if",["=","dir_len",0],["return",["bytes.lit","ERROR:expected_input=directory_path"]],0],["let","entries_b",["std.fs.list_dir_sorted","input"]],["let","entries_v",["bytes.view","entries_b"]],["let","x7sl_b",["std.text.ascii.split_lines_view","entries_v"]],["let","x7sl_v",["bytes.view","x7sl_b"]],["let","count",["std.text.slices.count_v1","x7sl_v"]],["let","read_handles",["std.vec.with_capacity",["*","count",4]]],["let","rr_handles",["std.vec.with_capacity",["*","count",4]]],["for","i",0,"count",["begin",["let","entry_v",["std.text.slices.view_at_v1","entries_v","x7sl_v","i"]],["let","dir_b",["std.bytes.copy","input"]],["let","entry_b",["std.bytes.copy","entry_v"]],["let","path_b",["std.path.join","dir_b","entry_b"]],["let","h_read",["std.fs.read_task","path_b"]],["task.spawn","h_read"],["set","read_handles",["std.vec.extend_bytes","read_handles",["std.codec.write_u32_le","h_read"]]],["let","rr_key",["std.bytes.copy","entry_v"]],["let","h_rr",["std.rr.fetch_task","rr_key"]],["task.spawn","h_rr"],["set","rr_handles",["std.vec.extend_bytes","rr_handles",["std.codec.write_u32_le","h_rr"]]],0]],["let","read_handles_b",["std.vec.as_bytes","read_handles"]],["let","rr_handles_b",["std.vec.as_bytes","rr_handles"]],["let","kv_hits",0],["let","kv_misses",0],["let","out",["std.vec.with_capacity",8192]],["set","out",["main.append_bytes","out",["bytes.lit","===_X07_Solve-Full_Pipeline_==="]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","dir="]]],["set","out",["main.append_bytes","out","input"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","files="]]],["set","out",["main.append_u32","out","count"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_newline","out"]],["for","i",0,"count",["begin",["let","entry_v",["std.text.slices.view_at_v1","entries_v","x7sl_v","i"]],["let","h_read",["std.codec.read_u32_le","read_handles_b",["*","i",4]]],["let","h_rr",["std.codec.read_u32_le","rr_handles_b",["*","i",4]]],["let","file_b",["await","h_read"]],["let","rr_b",["await","h_rr"]],["let","file_v",["bytes.view","file_b"]],["let","rr_v",["bytes.view","rr_b"]],["let","file_len",["view.len","file_v"]],["let","rr_len",["view.len","rr_v"]],["let","file_hex",["main.sha256_hex","file_v"]],["let","rr_hex",["main.sha256_hex","rr_v"]],["let","kind_b",["ext.json.pointer.pointer_get_string","rr_v",["bytes.lit","/kind"]]],["let","prio_b",["ext.json.pointer.pointer_get","rr_v",["bytes.lit","/priority"]]],["let","cached",["std.kv.get","entry_v"]],["let","hit",["if",["=",["bytes.len","cached"],0],0,1]],["if",["=","hit",1],["set","kv_hits",["+","kv_hits",1]],["set","kv_misses",["+","kv_misses",1]]],["set","out",["main.append_bytes","out","entry_v"]],["set","out",["main.append_bytes","out",["bytes.lit","_len="]]],["set","out",["main.append_u32","out","file_len"]],["set","out",["main.append_bytes","out",["bytes.lit","_sha256="]]],["set","out",["main.append_bytes","out",["bytes.view","file_hex"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","__rr.key="]]],["set","out",["main.append_bytes","out","entry_v"]],["set","out",["main.append_bytes","out",["bytes.lit","_len="]]],["set","out",["main.append_u32","out","rr_len"]],["set","out",["main.append_bytes","out",["bytes.lit","_sha256="]]],["set","out",["main.append_bytes","out",["bytes.view","rr_hex"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","__rr.kind="]]],["set","out",["main.append_opt_view_or","out",["bytes.view","kind_b"],["bytes.lit","<missing>"]]],["set","out",["main.append_bytes","out",["bytes.lit","_rr.priority="]]],["set","out",["main.append_opt_view_or","out",["bytes.view","prio_b"],["bytes.lit","<missing>"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","__kv.hit="]]],["set","out",["main.append_bytes","out",["if",["=","hit",1],["bytes.lit","yes"],["bytes.lit","no"]]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_newline","out"]],["if",["=","hit",0],["std.kv.set",["std.bytes.copy","entry_v"],"file_hex"],0],0]],["set","out",["main.append_bytes","out",["bytes.lit","---_Summary_---"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","kv_hits="]]],["set","out",["main.append_u32","out","kv_hits"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","kv_misses="]]],["set","out",["main.append_u32","out","kv_misses"]],["set","out",["main.append_newline","out"]],["std.vec.as_bytes","out"]]}
