{"decls":[{"kind":"export","names":["ext.tar.err_code","ext.tar.find_file_v1","ext.tar.get_bytes","ext.tar.is_err"]},{"body":["begin",["let","i",0],["let","done",0],["for","_",0,"max_len",["if",["=","done",0],["begin",["let","c",["view.get_u8","header",["+","off","i"]]],["if",["=","c",0],["set","done",1],["set","i",["+","i",1]]]],0]],"i"],"kind":"defn","name":"ext.tar._field_len_until_nul","params":[{"name":"header","ty":"bytes_view"},{"name":"off","ty":"i32"},{"name":"max_len","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.tar._make_err","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","name_off",0],["let","prefix_off",345],["let","name_len",["ext.tar._field_len_until_nul","header","name_off",100]],["let","prefix_len",["ext.tar._field_len_until_nul","header","prefix_off",155]],["let","tlen",["view.len","target"]],["if",["=","prefix_len",0],["begin",["if",["=",["=","tlen","name_len"],0],["return",0],0],["for","i",0,"name_len",["if",["=",["=",["view.get_u8","target","i"],["view.get_u8","header",["+","name_off","i"]]],0],["return",0],0]],["return",1]],0],["let","expected",["+",["+","prefix_len",1],"name_len"]],["if",["=",["=","tlen","expected"],0],["return",0],0],["for","i",0,"prefix_len",["if",["=",["=",["view.get_u8","target","i"],["view.get_u8","header",["+","prefix_off","i"]]],0],["return",0],0]],["if",["=",["=",["view.get_u8","target","prefix_len"],47],0],["return",0],0],["for","i",0,"name_len",["if",["=",["=",["view.get_u8","target",["+",["+","prefix_len",1],"i"]],["view.get_u8","header",["+","name_off","i"]]],0],["return",0],0]],1],"kind":"defn","name":"ext.tar._match_name","params":[{"name":"header","ty":"bytes_view"},{"name":"target","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["if",[">=u","c",48],["<u","c",56],0],["return",["-","c",48]],0],["-",0,1]],"kind":"defn","name":"ext.tar._oct_digit","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","off"],["let","end",["+","off","len"]],["let","val",0],["let","started",0],["let","done",0],["for","_","off","end",["if",["=","done",0],["begin",["let","c",["view.get_u8","header","i"]],["if",["=","started",0],["if",["if",["=","c",0],1,["=","c",32]],["set","i",["+","i",1]],["set","started",1]],0],["if",["if",["=",["=","started",0],0],["=","done",0],0],["if",["if",["=","c",0],1,["=","c",32]],["set","done",1],["begin",["let","d",["ext.tar._oct_digit","c"]],["if",["<","d",0],["return",["-",0,1]],0],["set","val",["+",["*","val",8],"d"]],["if",["<","val",0],["return",["-",0,1]],0],["set","i",["+","i",1]]]],0]],0]],"val"],"kind":"defn","name":"ext.tar._parse_octal_u32","params":[{"name":"header","ty":"bytes_view"},{"name":"off","ty":"i32"},{"name":"len","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],5],["return",0],0],["if",["=",["=",["view.get_u8","doc",0],0],0],["return",0],0],["codec.read_u32_le","doc",1]],"kind":"defn","name":"ext.tar.err_code","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<","max_size",0],["return",["ext.tar._make_err",4]],0],["let","n",["view.len","tar"]],["let","pos",0],["for","_",0,["+","n",1],["begin",["if",[">=u","pos","n"],["return",["ext.tar._make_err",1]],0],["if",["<u","n",["+","pos",512]],["return",["ext.tar._make_err",2]],0],["let","header",["view.slice","tar","pos",512]],["if",["=",["view.get_u8","header",0],0],["return",["ext.tar._make_err",1]],0],["let","typeflag",["view.get_u8","header",156]],["let","size",["ext.tar._parse_octal_u32","header",124,12]],["if",["<","size",0],["return",["ext.tar._make_err",2]],0],["let","data_start",["+","pos",512]],["if",["<u","n",["+","data_start","size"]],["return",["ext.tar._make_err",2]],0],["if",["if",["if",["=","typeflag",0],1,["=","typeflag",48]],["ext.tar._match_name","header","name"],0],["begin",["if",["<u","max_size","size"],["return",["ext.tar._make_err",3]],0],["let","out",["vec_u8.with_capacity",["+",1,"size"]]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes_range","out","tar","data_start","size"]],["return",["vec_u8.into_bytes","out"]]],0],["let","padded",["*",["/",["+","size",511],512],512]],["set","pos",["+","data_start","padded"]]]],["ext.tar._make_err",2]],"kind":"defn","name":"ext.tar.find_file_v1","params":[{"name":"tar","ty":"bytes_view"},{"name":"name","ty":"bytes_view"},{"name":"max_size","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","n",1],["return",["bytes.alloc",0]],0],["if",["=",["=",["view.get_u8","doc",0],1],0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc",1,["-","n",1]]]],"kind":"defn","name":"ext.tar.get_bytes","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["=",["view.get_u8","doc",0],0]],"kind":"defn","name":"ext.tar.is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"}],"imports":[],"kind":"module","meta":{"generated_by":"x07import","source_path":"import_sources/rust/ext_tar@0.1.0/tar.rs","source_sha256":"e92a8e74e5fa4141fe0fff9f5e3d6d0f7cf16fc7ce2e324d24f5fcc55e6c68c4"},"module_id":"ext.tar","schema_version":"x07.x07ast@0.2.0"}
