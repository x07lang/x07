{"decls":[{"kind":"defn","name":"main.rr_fetch_bytes_v1","params":[{"name":"key","ty":"bytes_view"}],"result":"bytes","body":["begin",["let","h",["std.rr.current_v1"]],["let","entry_res",["std.rr.next_v1","h",["bytes.lit","rr"],["bytes.lit","std.rr.fetch_v1"],"key"]],["let","code",["result_bytes.err_code","entry_res"]],["if",["!=","code",0],["bytes.alloc",0],["begin",["let","entry",["result_bytes.unwrap_or","entry_res",["bytes.alloc",0]]],["std.rr.entry_resp_v1",["bytes.view","entry"]]]]]},{"body":["begin",["let","key2",["std.bytes.copy","key"]],["let","body",["main.rr_fetch_bytes_v1","key"]],["std.kv.set","key2","body"],["bytes.empty"]],"kind":"defasync","name":"main.fetch_and_store","params":[{"name":"key","ty":"bytes"}],"result":"bytes"},{"kind":"defasync","name":"main.solve_bytes_v1","params":[{"name":"in","ty":"bytes_view"}],"result":"bytes","body":["begin",["let","n_input",["bytes.len","in"]],["if",["<u","n_input",1],["bytes.empty"],["begin",["let","n",["bytes.get_u8","in",0]],["if",["<u","n_input",["+",1,"n"]],["bytes.empty"],["begin",["let","keys_off",1],["let","seen",["set_u32.new",16]],["let","handles",["map_u32.new",16]],["for","i",0,"n",["begin",["let","key_u8",["bytes.get_u8","in",["+","keys_off","i"]]],["if",["=",["set_u32.contains","seen","key_u8"],0],["begin",["set_u32.add","seen","key_u8"],["let","key",["bytes.alloc",1]],["set","key",["bytes.set_u8","key",0,"key_u8"]],["let","h",["main.fetch_and_store","key"]],["map_u32.set","handles","key_u8",["task.spawn","h"]],0],0],0]],["let","joined",["set_u32.new",16]],["for","i",0,"n",["begin",["let","key_u8",["bytes.get_u8","in",["+","keys_off","i"]]],["if",["=",["set_u32.contains","joined","key_u8"],0],["begin",["set_u32.add","joined","key_u8"],["let","h",["map_u32.get","handles","key_u8",0]],["await","h"],0],0],0]],["let","out",["vec_u8.with_capacity",0]],["for","i",0,"n",["begin",["let","key_u8",["bytes.get_u8","in",["+","keys_off","i"]]],["let","key",["bytes.alloc",1]],["set","key",["bytes.set_u8","key",0,"key_u8"]],["let","body",["std.kv.get","key"]],["set","out",["vec_u8.extend_bytes","out","body"]],0]],["vec_u8.into_bytes","out"]]]]]]},{"kind":"defasync","name":"main.solve_result_v1","params":[{"name":"in","ty":"bytes_view"}],"result":"result_bytes","body":["std.rr.with_policy_v1",["bytes.lit","smoke_rr_v1"],["bytes.lit","smoke.rrbin"],["i32.lit",2],["result_bytes.ok",["begin",["let","h",["main.solve_bytes_v1","in"]],["task.spawn","h"],["await","h"]]]]}],"imports":["std.bytes","std.io","std.kv","std.rr"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.3.0","solve":["begin",["let","h",["main.solve_result_v1","input"]],["task.spawn","h"],["result_bytes.unwrap_or",["task.join.result_bytes","h"],["bytes.alloc",0]]]}
