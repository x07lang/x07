# x07 agent ergonomics — 2026-02-24..2026-03-01 (status + fixes)

This note summarizes what we verified from:

- `dev-docs/notes/x07-agent-ergonomics-2026-02-24.md`
- `dev-docs/notes/x07-agent-ergonomics-2026-02-25.md`
- `dev-docs/notes/x07-agent-ergonomics-2026-02-26.md`
- `dev-docs/notes/x07-agent-ergonomics-2026-02-27.md`
- `dev-docs/notes/x07-agent-ergonomics-2026-02-28.md`
- `dev-docs/notes/x07-agent-ergonomics-2026-03-01.md`

…and the concrete fixes applied across the toolchain and `x07-mcp`.

## Toolchain (x07/)

### Bundle fuel ergonomics

- `x07 bundle` supports `--solve-fuel <u64>` (overrides `profile.solve_fuel` / default).
- The selected fuel cap is passed through to the bundled OS runner guest invocation.
- Docs: `docs/toolchain/cli.md` and `skills/pack/.agent/skills/x07-bundle/SKILL.md`.

### `x07 test` debugging ergonomics

- Filters that select 0 tests are an error by default; `--allow-empty` opts into “0 tests selected” success.
- Per-test fuel overrides are supported via `solve_fuel` in `x07.tests_manifest` entries.
- Runner traps surface as `X07T_RUN_TRAP` with a decoded trap string (`details.trap`) in the test report.
- `x07 test --verbose` emits `test: <id>` progress lines to stderr while preserving the machine report on stdout.
- Docs: `docs/toolchain/testing.md`, `docs/toolchain/tests-manifest.md`, `docs/spec/internal/x07-testing-v1.md`, and `skills/pack/.agent/skills/x07-test/SKILL.md`.

### Stable human-editable formatting for x07AST JSON

- `x07 fmt --pretty` emits deterministic multi-line JSON for review/surgical edits while preserving canonical one-line output by default.
- Docs: `docs/toolchain/cli.md` and `skills/pack/.agent/skills/x07-format/SKILL.md`.

### `x07 fix` convergence loop ergonomics

- When `x07 fix` does not converge, it prints the next remaining error diagnostic (code + message + location when available).

### Locking / publish diagnostics

- `x07 pkg lock` produces stable lock output for vendored deps under `.x07/deps/` by filling `yanked: false` when index metadata is not consulted.
- `x07 pkg lock --check` hydrates missing vendored deps under `.x07/deps/` (including vendored patch-path deps) instead of requiring a separate “materialize patch deps” step.
- `x07 pkg versions --refresh` forces a cache-busted sparse-index fetch (useful immediately after `x07 pkg publish`).
- `x07 pkg publish` surfaces HTTP response bodies for GET/POST errors (useful when registry returns structured error payloads).
- Docs: `docs/packages/index.md`, `docs/toolchain/cli.md`, `docs/toolchain/diagnostic-codes.md`, and `skills/pack/.agent/skills/x07-package/SKILL.md`.

### Runtime trap context for filesystem paths

- Several OS-world filesystem open failures now include the attempted path in trap output (instead of a path-less “open failed”).

## MCP kit (x07-mcp/)

### Signed PRM metadata verification

- New `ext-mcp-auth@0.4.5`: `std.mcp.auth.prm_signed_v1.prm_signed_verify_and_merge_v1` parses the PRM first and returns `ok=true` when `signed_metadata` is absent, without requiring verification config.
- New regression test: `auth/prm_signed/verify_missing_signed_metadata_ok` under `packages/ext/x07-ext-mcp-auth/0.4.5/tests/tests.json`.

### Version bumps wired through templates/servers

- New `ext-mcp-transport-http@0.3.13` depends on `ext-mcp-auth@0.4.5`.
- New `ext-mcp-rr@0.3.13` depends on `ext-mcp-auth@0.4.5` and `ext-mcp-transport-http@0.3.13`.
- Pins + lockfiles updated across `x07-mcp` root, templates, servers, and conformance client.
- Docs: `docs/reference/packages.md` lists the latest published package versions.

### CI gate maintenance

- CI scripts capture logs on failure (rather than redirecting key steps to `/dev/null`) while keeping successful runs quiet.
- `locks/external-packages.lock` is regenerated by CI tooling and checked for stability.
- CLI template asset modules are generated deterministically from templates and checked in CI.

## Open items (not addressed in this patchset)

The notes also propose larger-scope tooling changes (AST query/edit helpers, automatic module-root derivation for package tests, vendor/sync workflows, relative-path standardization in nested configs, signal APIs for run-os, schema-driven JSON validation). These remain as follow-up work.

