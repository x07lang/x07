{"decls":[{"kind":"export","names":["ext.compress.code_checksum_mismatch","ext.compress.code_invalid_header","ext.compress.code_invalid_stream","ext.compress.code_output_limit","ext.compress.code_truncated","ext.compress.crc32","ext.compress.err_code","ext.compress.get_bytes","ext.compress.get_view","ext.compress.gzip_decompress","ext.compress.inflate_raw","ext.compress.is_err","ext.compress.out_len","ext.compress.zlib_decompress"]},{"body":["begin",["let","modp",65521],["let","s1",1],["let","s2",0],["let","n",["view.len","b"]],["let","off",0],["for","_",0,["+","n",1],["begin",["if",[">=u","off","n"],["return",["|",["<<u","s2",16],"s1"]],0],["let","remain",["-","n","off"]],["let","block",["if",["<u","remain",5552],"remain",5552]],["for","i",0,"block",["begin",["let","x",["view.get_u8","b",["+","off","i"]]],["set","s1",["+","s1","x"]],["set","s2",["+","s2","s1"]]]],["set","s1",["%","s1","modp"]],["set","s2",["%","s2","modp"]],["set","off",["+","off","block"]]]],["|",["<<u","s2",16],"s1"]],"kind":"defn","name":"ext.compress._adler32","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out",0],["for","_",0,"bits",["begin",["set","out",["|",["<<u","out",1],["&","code",1]]],["set","code",[">>u","code",1]]]],"out"],"kind":"defn","name":"ext.compress._bit_reverse","params":[{"name":"code","ty":"i32"},{"name":"bits","ty":"i32"}],"result":"i32"},{"body":["if",["=","i",0],16,["if",["=","i",1],17,["if",["=","i",2],18,["if",["=","i",3],0,["if",["=","i",4],8,["if",["=","i",5],7,["if",["=","i",6],9,["if",["=","i",7],6,["if",["=","i",8],10,["if",["=","i",9],5,["if",["=","i",10],11,["if",["=","i",11],4,["if",["=","i",12],12,["if",["=","i",13],3,["if",["=","i",14],13,["if",["=","i",15],2,["if",["=","i",16],14,["if",["=","i",17],1,15]]]]]]]]]]]]]]]]]],"kind":"defn","name":"ext.compress._cl_order","params":[{"name":"i","ty":"i32"}],"result":"i32"},{"body":["begin",["let","table_b",["ext.compress._crc32_table"]],["let","table",["bytes.view","table_b"]],["let","crc",["-",0,1]],["let","n",["view.len","b"]],["for","i",0,"n",["begin",["let","x",["view.get_u8","b","i"]],["let","idx",["&",["^","crc","x"],255]],["let","t",["codec.read_u32_le","table",["*","idx",4]]],["set","crc",["^",[">>u","crc",8],"t"]]]],["^","crc",["-",0,1]]],"kind":"defn","name":"ext.compress._crc32","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",["*",256,4]]],["for","i",0,256,["begin",["let","c","i"],["for","_",0,8,["if",["=",["=",["&","c",1],0],0],["set","c",["^",[">>u","c",1],-306674912]],["set","c",[">>u","c",1]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","c"]]]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.compress._crc32_table","params":[],"result":"bytes"},{"body":["begin",["if",["if",["<","sym",0],1,[">","sym",29]],["return",-1],0],["if",["<","sym",4],["+",1,"sym"],["begin",["let","eb",["-",["/","sym",2],1]],["let","group",["-","sym",["+",["*",2,"eb"],2]]],["+",["+",["<<u",1,["+","eb",1]],1],["*","group",["<<u",1,"eb"]]]]]],"kind":"defn","name":"ext.compress._dist_base","params":[{"name":"sym","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["if",["<","sym",0],1,[">","sym",29]],["return",-1],0],["if",["<","sym",4],0,["-",["/","sym",2],1]]],"kind":"defn","name":"ext.compress._dist_extra","params":[{"name":"sym","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["bytes.alloc",24]],["set","out",["ext.compress._write_u32_le","out",0,"code"]],"out"],"kind":"defn","name":"ext.compress._dyn_lens_err","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","max_bits",0],["for","i",0,"sym_count",["begin",["let","l",["view.get_u8","lens","i"]],["if",[">","l",15],["return",["bytes.alloc",0]],0],["if",[">","l","max_bits"],["set","max_bits","l"],0]]],["if",["=","max_bits",0],["return",["bytes.alloc",0]],0],["let","counts",["bytes.alloc",["*",["+","max_bits",1],4]]],["for","i",0,"sym_count",["begin",["let","l",["view.get_u8","lens","i"]],["if",["=",["=","l",0],0],["begin",["let","off",["*","l",4]],["let","cur",["codec.read_u32_le",["bytes.view","counts"],"off"]],["set","counts",["ext.compress._write_u32_le","counts","off",["+","cur",1]]]],0]]],["let","next",["bytes.alloc",["*",["+","max_bits",1],4]]],["let","code",0],["for","bits",1,["+","max_bits",1],["begin",["let","prev",["codec.read_u32_le",["bytes.view","counts"],["*",["-","bits",1],4]]],["set","code",["<<u",["+","code","prev"],1]],["let","cur",["codec.read_u32_le",["bytes.view","counts"],["*","bits",4]]],["if",[">",["+","code","cur"],["<<u",1,"bits"]],["return",["bytes.alloc",0]],0],["set","next",["ext.compress._write_u32_le","next",["*","bits",4],"code"]]]],["let","table_len",["<<u",1,"max_bits"]],["let","table",["bytes.alloc",["+",4,["*","table_len",4]]]],["set","table",["ext.compress._write_u32_le","table",0,"max_bits"]],["for","sym",0,"sym_count",["begin",["let","l",["view.get_u8","lens","sym"]],["if",["=",["=","l",0],0],["begin",["let","off",["*","l",4]],["let","c",["codec.read_u32_le",["bytes.view","next"],"off"]],["set","next",["ext.compress._write_u32_le","next","off",["+","c",1]]],["let","r",["ext.compress._bit_reverse","c","l"]],["let","entry",["|",["<<u","l",16],"sym"]],["let","step",["<<u",1,"l"]],["let","j","r"],["for","_",0,["+","table_len",1],["if",["<u","j","table_len"],["begin",["let","pos",["+",4,["*","j",4]]],["if",["=",["=",["codec.read_u32_le",["bytes.view","table"],"pos"],0],0],["return",["bytes.alloc",0]],0],["set","table",["ext.compress._write_u32_le","table","pos","entry"]],["set","j",["+","j","step"]]],0]]],0]]],"table"],"kind":"defn","name":"ext.compress._huff_build_table","params":[{"name":"lens","ty":"bytes_view"},{"name":"sym_count","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off0",["codec.read_u32_le",["bytes.view","st"],8]],["let","bit_buf0",["codec.read_u32_le",["bytes.view","st"],12]],["let","bit_count0",["codec.read_u32_le",["bytes.view","st"],16]],["let","lens_b",["ext.compress._inflate_dynamic_read_lens","data","n","off0","bit_buf0","bit_count0"]],["let","lens",["bytes.view","lens_b"]],["let","status",["codec.read_u32_le","lens",0]],["if",["=",["=","status",0],0],["return",["ext.compress._write_u32_le","st",0,"status"]],0],["let","off1",["codec.read_u32_le","lens",4]],["let","bit_buf1",["codec.read_u32_le","lens",8]],["let","bit_count1",["codec.read_u32_le","lens",12]],["let","hlit",["codec.read_u32_le","lens",16]],["let","hdist",["codec.read_u32_le","lens",20]],["let","total",["+","hlit","hdist"]],["let","all_lens",["view.slice","lens",24,"total"]],["let","lit_lens",["view.slice","all_lens",0,"hlit"]],["let","dist_lens",["view.slice","all_lens","hlit","hdist"]],["let","lit_table_b",["ext.compress._huff_build_table","lit_lens","hlit"]],["let","dist_table_b",["ext.compress._huff_build_table","dist_lens","hdist"]],["if",["if",["=",["bytes.len","lit_table_b"],0],1,["=",["bytes.len","dist_table_b"],0]],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],0],["set","st",["ext.compress._write_u32_le","st",8,"off1"]],["set","st",["ext.compress._write_u32_le","st",12,"bit_buf1"]],["set","st",["ext.compress._write_u32_le","st",16,"bit_count1"]],["ext.compress._inflate_block_huffman_decode","data","n","max_out_bytes","st","bfinal",["bytes.view","lit_table_b"],["bytes.view","dist_table_b"]]],"kind":"defn","name":"ext.compress._inflate_block_dynamic","params":[{"name":"data","ty":"bytes_view"},{"name":"n","ty":"i32"},{"name":"max_out_bytes","ty":"i32"},{"name":"st","ty":"bytes"},{"name":"bfinal","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","lit_lens",["bytes.alloc",288]],["for","i",0,144,["set","lit_lens",["bytes.set_u8","lit_lens","i",8]]],["for","i",144,256,["set","lit_lens",["bytes.set_u8","lit_lens","i",9]]],["for","i",256,280,["set","lit_lens",["bytes.set_u8","lit_lens","i",7]]],["for","i",280,288,["set","lit_lens",["bytes.set_u8","lit_lens","i",8]]],["let","dist_lens",["bytes.alloc",32]],["for","i",0,32,["set","dist_lens",["bytes.set_u8","dist_lens","i",5]]],["let","lit_table_b",["ext.compress._huff_build_table",["bytes.view","lit_lens"],288]],["let","dist_table_b",["ext.compress._huff_build_table",["bytes.view","dist_lens"],32]],["if",["if",["=",["bytes.len","lit_table_b"],0],1,["=",["bytes.len","dist_table_b"],0]],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],0],["ext.compress._inflate_block_huffman_decode","data","n","max_out_bytes","st","bfinal",["bytes.view","lit_table_b"],["bytes.view","dist_table_b"]]],"kind":"defn","name":"ext.compress._inflate_block_fixed","params":[{"name":"data","ty":"bytes_view"},{"name":"n","ty":"i32"},{"name":"max_out_bytes","ty":"i32"},{"name":"st","ty":"bytes"},{"name":"bfinal","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","out_len",["codec.read_u32_le",["bytes.view","st"],4]],["let","off",["codec.read_u32_le",["bytes.view","st"],8]],["let","bit_buf",["codec.read_u32_le",["bytes.view","st"],12]],["let","bit_count",["codec.read_u32_le",["bytes.view","st"],16]],["let","lit_max",["codec.read_u32_le","lit_table",0]],["let","lit_mask",["-",["<<u",1,"lit_max"],1]],["let","dist_max",["codec.read_u32_le","dist_table",0]],["let","dist_mask",["-",["<<u",1,"dist_max"],1]],["let","block_done",0],["for","_",0,["+",["*","n",8],1],["if",["=","block_done",0],["begin",["for","_",0,3,["if",["<","bit_count","lit_max"],["if",[">=u","off","n"],0,["begin",["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]]],0]],["let","entry",["codec.read_u32_le","lit_table",["+",4,["*",["&","bit_buf","lit_mask"],4]]]],["let","elen",[">>u","entry",16]],["if",["=","elen",0],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],["return","st"]],0],["if",["<","bit_count","elen"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["let","sym",["&","entry",65535]],["set","bit_buf",[">>u","bit_buf","elen"]],["set","bit_count",["-","bit_count","elen"]],["if",["<","sym",256],["begin",["if",["<u","max_out_bytes",["+","out_len",1]],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_output_limit"]]],["return","st"]],0],["set","st",["bytes.set_u8","st",["+",24,"out_len"],"sym"]],["set","out_len",["+","out_len",1]]],["if",["=","sym",256],["set","block_done",1],["begin",["let","base",["ext.compress._len_base","sym"]],["let","eb",["ext.compress._len_extra","sym"]],["if",["if",["<","base",0],1,["<","eb",0]],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],["return","st"]],0],["let","extra",0],["if",[">","eb",0],["begin",["for","_",0,3,["if",["<","bit_count","eb"],["begin",["if",[">=u","off","n"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count","eb"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["set","extra",["&","bit_buf",["-",["<<u",1,"eb"],1]]],["set","bit_buf",[">>u","bit_buf","eb"]],["set","bit_count",["-","bit_count","eb"]]],0],["let","len",["+","base","extra"]],["for","_",0,3,["if",["<","bit_count","dist_max"],["if",[">=u","off","n"],0,["begin",["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]]],0]],["let","dentry",["codec.read_u32_le","dist_table",["+",4,["*",["&","bit_buf","dist_mask"],4]]]],["let","dlen",[">>u","dentry",16]],["if",["=","dlen",0],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],["return","st"]],0],["if",["<","bit_count","dlen"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["let","dsym",["&","dentry",65535]],["set","bit_buf",[">>u","bit_buf","dlen"]],["set","bit_count",["-","bit_count","dlen"]],["let","dbase",["ext.compress._dist_base","dsym"]],["let","deb",["ext.compress._dist_extra","dsym"]],["if",["if",["<","dbase",0],1,["<","deb",0]],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],["return","st"]],0],["let","dext",0],["if",[">","deb",0],["begin",["for","_",0,3,["if",["<","bit_count","deb"],["begin",["if",[">=u","off","n"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count","deb"],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["set","dext",["&","bit_buf",["-",["<<u",1,"deb"],1]]],["set","bit_buf",[">>u","bit_buf","deb"]],["set","bit_count",["-","bit_count","deb"]]],0],["let","dist",["+","dbase","dext"]],["if",["if",["<=","dist",0],1,[">","dist","out_len"]],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],["return","st"]],0],["if",["if",["<u","max_out_bytes","out_len"],1,["<u",["-","max_out_bytes","out_len"],"len"]],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_output_limit"]]],["return","st"]],0],["for","_",0,"len",["begin",["let","b",["bytes.get_u8","st",["+",24,["-","out_len","dist"]]]],["set","st",["bytes.set_u8","st",["+",24,"out_len"],"b"]],["set","out_len",["+","out_len",1]]]]]]]],0]],["if",["=","block_done",0],["begin",["set","st",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],["return","st"]],0],["set","st",["ext.compress._write_u32_le","st",4,"out_len"]],["set","st",["ext.compress._write_u32_le","st",8,"off"]],["set","st",["ext.compress._write_u32_le","st",12,"bit_buf"]],["set","st",["ext.compress._write_u32_le","st",16,"bit_count"]],["if",["=",["=","bfinal",0],0],["set","st",["ext.compress._write_u32_le","st",20,1]],0],"st"],"kind":"defn","name":"ext.compress._inflate_block_huffman_decode","params":[{"name":"data","ty":"bytes_view"},{"name":"n","ty":"i32"},{"name":"max_out_bytes","ty":"i32"},{"name":"st","ty":"bytes"},{"name":"bfinal","ty":"i32"},{"name":"lit_table","ty":"bytes_view"},{"name":"dist_table","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<","max_out_bytes",0],["return",["ext.compress._make_err",["ext.compress.code_output_limit"]]],0],["let","n",["view.len","data"]],["let","st",["bytes.alloc",["+",24,"max_out_bytes"]]],["for","_",0,["+","n",1],["begin",["let","status",["codec.read_u32_le",["bytes.view","st"],0]],["let","done",["codec.read_u32_le",["bytes.view","st"],20]],["if",["if",["=","status",0],["=","done",0],0],["set","st",["ext.compress._inflate_one_block","data","n","max_out_bytes","st"]],0]]],["let","status",["codec.read_u32_le",["bytes.view","st"],0]],["if",["=",["=","status",0],0],["return",["ext.compress._make_err","status"]],0],["let","done",["codec.read_u32_le",["bytes.view","st"],20]],["if",["=","done",0],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["let","off",["codec.read_u32_le",["bytes.view","st"],8]],["let","bit_buf",["codec.read_u32_le",["bytes.view","st"],12]],["let","bit_count",["codec.read_u32_le",["bytes.view","st"],16]],["let","drop",["&","bit_count",7]],["set","bit_buf",[">>u","bit_buf","drop"]],["set","bit_count",["-","bit_count","drop"]],["let","buf_bytes",[">>u","bit_count",3]],["if",["<u","off","buf_bytes"],["return",["ext.compress._make_err",["ext.compress.code_invalid_stream"]]],0],["set","off",["-","off","buf_bytes"]],["if",["=",["=","off","n"],0],["return",["ext.compress._make_err",["ext.compress.code_invalid_stream"]]],0],["let","out_len",["codec.read_u32_le",["bytes.view","st"],4]],["let","out",["vec_u8.with_capacity",["+",1,"out_len"]]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes_range","out",["bytes.view","st"],24,"out_len"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.compress._inflate_deflate","params":[{"name":"data","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"body":["begin",["for","_",0,3,["if",["<","bit_count",["+",["+",5,5],4]],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",["+",["+",5,5],4]],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","hlit",["+",["&","bit_buf",31],257]],["set","bit_buf",[">>u","bit_buf",5]],["set","bit_count",["-","bit_count",5]],["let","hdist",["+",["&","bit_buf",31],1]],["set","bit_buf",[">>u","bit_buf",5]],["set","bit_count",["-","bit_count",5]],["let","hclen",["+",["&","bit_buf",15],4]],["set","bit_buf",[">>u","bit_buf",4]],["set","bit_count",["-","bit_count",4]],["let","cl_lens",["bytes.alloc",19]],["for","i",0,"hclen",["begin",["for","_",0,3,["if",["<","bit_count",3],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",3],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","v",["&","bit_buf",7]],["set","bit_buf",[">>u","bit_buf",3]],["set","bit_count",["-","bit_count",3]],["let","sym",["ext.compress._cl_order","i"]],["set","cl_lens",["bytes.set_u8","cl_lens","sym","v"]]]],["let","cl_table_b",["ext.compress._huff_build_table",["bytes.view","cl_lens"],19]],["if",["=",["bytes.len","cl_table_b"],0],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["let","cl_table",["bytes.view","cl_table_b"]],["let","cl_max",["codec.read_u32_le","cl_table",0]],["let","cl_mask",["-",["<<u",1,"cl_max"],1]],["let","total",["+","hlit","hdist"]],["let","out",["bytes.alloc",["+",24,"total"]]],["let","idx",0],["let","prev",0],["for","_",0,["+","total",1],["if",["<u","idx","total"],["begin",["for","_",0,3,["if",["<","bit_count","cl_max"],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count","cl_max"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","entry",["codec.read_u32_le","cl_table",["+",4,["*",["&","bit_buf","cl_mask"],4]]]],["let","elen",[">>u","entry",16]],["if",["=","elen",0],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["let","sym",["&","entry",65535]],["set","bit_buf",[">>u","bit_buf","elen"]],["set","bit_count",["-","bit_count","elen"]],["if",["<=","sym",15],["begin",["set","out",["bytes.set_u8","out",["+",24,"idx"],"sym"]],["set","prev","sym"],["set","idx",["+","idx",1]]],["if",["=","sym",16],["begin",["if",["=","idx",0],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["for","_",0,3,["if",["<","bit_count",2],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",2],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","extra",["&","bit_buf",3]],["set","bit_buf",[">>u","bit_buf",2]],["set","bit_count",["-","bit_count",2]],["let","rep",["+",3,"extra"]],["for","_",0,"rep",["begin",["if",[">=u","idx","total"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["set","out",["bytes.set_u8","out",["+",24,"idx"],"prev"]],["set","idx",["+","idx",1]]]]],["if",["=","sym",17],["begin",["for","_",0,3,["if",["<","bit_count",3],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",3],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","extra",["&","bit_buf",7]],["set","bit_buf",[">>u","bit_buf",3]],["set","bit_count",["-","bit_count",3]],["let","rep",["+",3,"extra"]],["set","prev",0],["for","_",0,"rep",["begin",["if",[">=u","idx","total"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["set","out",["bytes.set_u8","out",["+",24,"idx"],0]],["set","idx",["+","idx",1]]]]],["if",["=","sym",18],["begin",["for","_",0,3,["if",["<","bit_count",7],["begin",["if",[">=u","off","n"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",7],["return",["ext.compress._dyn_lens_err",["ext.compress.code_truncated"]]],0],["let","extra",["&","bit_buf",127]],["set","bit_buf",[">>u","bit_buf",7]],["set","bit_count",["-","bit_count",7]],["let","rep",["+",11,"extra"]],["set","prev",0],["for","_",0,"rep",["begin",["if",[">=u","idx","total"],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["set","out",["bytes.set_u8","out",["+",24,"idx"],0]],["set","idx",["+","idx",1]]]]],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]]]]]]],0]],["if",["=",["=","idx","total"],0],["return",["ext.compress._dyn_lens_err",["ext.compress.code_invalid_stream"]]],0],["set","out",["ext.compress._write_u32_le","out",0,0]],["set","out",["ext.compress._write_u32_le","out",4,"off"]],["set","out",["ext.compress._write_u32_le","out",8,"bit_buf"]],["set","out",["ext.compress._write_u32_le","out",12,"bit_count"]],["set","out",["ext.compress._write_u32_le","out",16,"hlit"]],["set","out",["ext.compress._write_u32_le","out",20,"hdist"]],"out"],"kind":"defn","name":"ext.compress._inflate_dynamic_read_lens","params":[{"name":"data","ty":"bytes_view"},{"name":"n","ty":"i32"},{"name":"off","ty":"i32"},{"name":"bit_buf","ty":"i32"},{"name":"bit_count","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","status",["codec.read_u32_le",["bytes.view","st"],0]],["let","done",["codec.read_u32_le",["bytes.view","st"],20]],["if",["if",["=",["=","status",0],0],1,["=",["=","done",0],0]],["return","st"],0],["let","out_len",["codec.read_u32_le",["bytes.view","st"],4]],["let","off",["codec.read_u32_le",["bytes.view","st"],8]],["let","bit_buf",["codec.read_u32_le",["bytes.view","st"],12]],["let","bit_count",["codec.read_u32_le",["bytes.view","st"],16]],["for","_",0,3,["if",["<","bit_count",3],["begin",["if",[">=u","off","n"],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],0],["set","bit_buf",["|","bit_buf",["<<u",["view.get_u8","data","off"],"bit_count"]]],["set","bit_count",["+","bit_count",8]],["set","off",["+","off",1]]],0]],["if",["<","bit_count",3],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],0],["let","bfinal",["&","bit_buf",1]],["let","btype",["&",[">>u","bit_buf",1],3]],["set","bit_buf",[">>u","bit_buf",3]],["set","bit_count",["-","bit_count",3]],["set","st",["ext.compress._write_u32_le","st",4,"out_len"]],["set","st",["ext.compress._write_u32_le","st",8,"off"]],["set","st",["ext.compress._write_u32_le","st",12,"bit_buf"]],["set","st",["ext.compress._write_u32_le","st",16,"bit_count"]],["if",["=","btype",0],["begin",["let","drop",["&","bit_count",7]],["set","bit_buf",[">>u","bit_buf","drop"]],["set","bit_count",["-","bit_count","drop"]],["let","buf_bytes",[">>u","bit_count",3]],["if",["<u","off","buf_bytes"],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],0],["set","off",["-","off","buf_bytes"]],["set","bit_buf",0],["set","bit_count",0],["if",["<u","n",["+","off",4]],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],0],["let","len",["ext.compress._read_u16_le","data","off"]],["let","nlen",["ext.compress._read_u16_le","data",["+","off",2]]],["if",["=",["=",["&",["^","len","nlen"],65535],65535],0],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]],0],["set","off",["+","off",4]],["if",["<u","n",["+","off","len"]],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_truncated"]]],0],["if",["if",["<u","max_out_bytes","out_len"],1,["<u",["-","max_out_bytes","out_len"],"len"]],["return",["ext.compress._write_u32_le","st",0,["ext.compress.code_output_limit"]]],0],["for","i",0,"len",["begin",["set","st",["bytes.set_u8","st",["+",24,"out_len"],["view.get_u8","data",["+","off","i"]]]],["set","out_len",["+","out_len",1]]]],["set","off",["+","off","len"]],["set","st",["ext.compress._write_u32_le","st",4,"out_len"]],["set","st",["ext.compress._write_u32_le","st",8,"off"]],["set","st",["ext.compress._write_u32_le","st",12,"bit_buf"]],["set","st",["ext.compress._write_u32_le","st",16,"bit_count"]],["if",["=",["=","bfinal",0],0],["set","st",["ext.compress._write_u32_le","st",20,1]],0],"st"],["if",["=","btype",1],["ext.compress._inflate_block_fixed","data","n","max_out_bytes","st","bfinal"],["if",["=","btype",2],["ext.compress._inflate_block_dynamic","data","n","max_out_bytes","st","bfinal"],["ext.compress._write_u32_le","st",0,["ext.compress.code_invalid_stream"]]]]]],"kind":"defn","name":"ext.compress._inflate_one_block","params":[{"name":"data","ty":"bytes_view"},{"name":"n","ty":"i32"},{"name":"max_out_bytes","ty":"i32"},{"name":"st","ty":"bytes"}],"result":"bytes"},{"body":["begin",["if",["if",["<","sym",257],1,[">","sym",285]],["return",-1],0],["if",["<","sym",265],["+",3,["-","sym",257]],["if",["<","sym",269],["+",11,["*",["-","sym",265],2]],["if",["<","sym",273],["+",19,["*",["-","sym",269],4]],["if",["<","sym",277],["+",35,["*",["-","sym",273],8]],["if",["<","sym",281],["+",67,["*",["-","sym",277],16]],["if",["<","sym",285],["+",131,["*",["-","sym",281],32]],258]]]]]]],"kind":"defn","name":"ext.compress._len_base","params":[{"name":"sym","ty":"i32"}],"result":"i32"},{"body":["if",["<","sym",265],0,["if",["<","sym",269],1,["if",["<","sym",273],2,["if",["<","sym",277],3,["if",["<","sym",281],4,["if",["<","sym",285],5,["if",["=","sym",285],0,-1]]]]]]],"kind":"defn","name":"ext.compress._len_extra","params":[{"name":"sym","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.compress._make_err","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","b0",["view.get_u8","b","off"]],["let","b1",["view.get_u8","b",["+","off",1]]],["|","b0",["<<u","b1",8]]],"kind":"defn","name":"ext.compress._read_u16_le","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","b0",["view.get_u8","b","off"]],["let","b1",["view.get_u8","b",["+","off",1]]],["let","b2",["view.get_u8","b",["+","off",2]]],["let","b3",["view.get_u8","b",["+","off",3]]],["|",["|",["|",["<<u","b0",24],["<<u","b1",16]],["<<u","b2",8]],"b3"]],"kind":"defn","name":"ext.compress._read_u32_be","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","b0",["view.get_u8","b","off"]],["let","b1",["view.get_u8","b",["+","off",1]]],["let","b2",["view.get_u8","b",["+","off",2]]],["let","b3",["view.get_u8","b",["+","off",3]]],["|",["|",["|","b0",["<<u","b1",8]],["<<u","b2",16]],["<<u","b3",24]]],"kind":"defn","name":"ext.compress._read_u32_le","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["set","b",["bytes.set_u8","b",["+","off",0],["&","v",255]]],["set","b",["bytes.set_u8","b",["+","off",1],["&",[">>u","v",8],255]]],["set","b",["bytes.set_u8","b",["+","off",2],["&",[">>u","v",16],255]]],["bytes.set_u8","b",["+","off",3],["&",[">>u","v",24],255]]],"kind":"defn","name":"ext.compress._write_u32_le","params":[{"name":"b","ty":"bytes"},{"name":"off","ty":"i32"},{"name":"v","ty":"i32"}],"result":"bytes"},{"body":4,"kind":"defn","name":"ext.compress.code_checksum_mismatch","params":[],"result":"i32"},{"body":2,"kind":"defn","name":"ext.compress.code_invalid_header","params":[],"result":"i32"},{"body":3,"kind":"defn","name":"ext.compress.code_invalid_stream","params":[],"result":"i32"},{"body":5,"kind":"defn","name":"ext.compress.code_output_limit","params":[],"result":"i32"},{"body":1,"kind":"defn","name":"ext.compress.code_truncated","params":[],"result":"i32"},{"body":["ext.compress._crc32","b"],"kind":"defn","name":"ext.compress.crc32","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],5],["return",0],0],["if",["=",["=",["view.get_u8","doc",0],0],0],["return",0],0],["codec.read_u32_le","doc",1]],"kind":"defn","name":"ext.compress.err_code","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["view.to_bytes",["ext.compress.get_view","doc"]],"kind":"defn","name":"ext.compress.get_bytes","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","n",1],["return",["view.slice","doc",0,0]],0],["if",["=",["=",["view.get_u8","doc",0],1],0],["return",["view.slice","doc",0,0]],0],["view.slice","doc",1,["-","n",1]]],"kind":"defn","name":"ext.compress.get_view","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes_view"},{"body":["begin",["let","n",["view.len","data"]],["if",["<u","n",10],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["if",["if",["=",["=",["view.get_u8","data",0],31],0],1,["=",["=",["view.get_u8","data",1],139],0]],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["if",["=",["=",["view.get_u8","data",2],8],0],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["let","flg",["view.get_u8","data",3]],["if",["=",["=",["&","flg",224],0],0],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["let","off",10],["if",["=",["=",["&","flg",4],0],0],["begin",["if",["<u","n",["+","off",2]],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["let","xlen",["ext.compress._read_u16_le","data","off"]],["set","off",["+","off",2]],["if",["<u","n",["+","off","xlen"]],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["set","off",["+","off","xlen"]]],0],["if",["=",["=",["&","flg",8],0],0],["begin",["let","found",0],["for","i","off","n",["if",["if",["=","found",0],["=",["view.get_u8","data","i"],0],0],["begin",["set","found",1],["set","off",["+","i",1]]],0]],["if",["=","found",0],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0]],0],["if",["=",["=",["&","flg",16],0],0],["begin",["let","found",0],["for","i","off","n",["if",["if",["=","found",0],["=",["view.get_u8","data","i"],0],0],["begin",["set","found",1],["set","off",["+","i",1]]],0]],["if",["=","found",0],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0]],0],["if",["=",["=",["&","flg",2],0],0],["begin",["if",["<u","n",["+","off",2]],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["set","off",["+","off",2]]],0],["if",["<u","n",["+","off",8]],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["let","expected_crc",["ext.compress._read_u32_le","data",["-","n",8]]],["let","expected_isize",["ext.compress._read_u32_le","data",["-","n",4]]],["let","deflate_len",["-",["-","n",8],"off"]],["let","deflate",["view.slice","data","off","deflate_len"]],["let","doc",["ext.compress._inflate_deflate","deflate","max_out_bytes"]],["if",["ext.compress.is_err",["bytes.view","doc"]],["return","doc"],0],["let","actual_crc",["ext.compress._crc32",["ext.compress.get_view",["bytes.view","doc"]]]],["let","actual_isize",["ext.compress.out_len",["bytes.view","doc"]]],["if",["=",["=","expected_crc","actual_crc"],0],["return",["ext.compress._make_err",["ext.compress.code_checksum_mismatch"]]],0],["if",["=",["=","expected_isize","actual_isize"],0],["return",["ext.compress._make_err",["ext.compress.code_checksum_mismatch"]]],0],"doc"],"kind":"defn","name":"ext.compress.gzip_decompress","params":[{"name":"data","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"body":["ext.compress._inflate_deflate","data","max_out_bytes"],"kind":"defn","name":"ext.compress.inflate_raw","params":[{"name":"data","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["=",["view.get_u8","doc",0],0]],"kind":"defn","name":"ext.compress.is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","n",1],["return",0],0],["if",["=",["=",["view.get_u8","doc",0],1],0],["return",0],0],["-","n",1]],"kind":"defn","name":"ext.compress.out_len","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","data"]],["if",["<u","n",2],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["let","cmf",["view.get_u8","data",0]],["let","flg",["view.get_u8","data",1]],["let","cm",["&","cmf",15]],["let","cinfo",[">>u","cmf",4]],["if",["if",["=",["=","cm",8],0],1,[">","cinfo",7]],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["let","check",["|",["<<u","cmf",8],"flg"]],["if",["=",["=",["%","check",31],0],0],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["if",["=",["=",["&","flg",32],0],0],["return",["ext.compress._make_err",["ext.compress.code_invalid_header"]]],0],["if",["<u","n",["+",2,4]],["return",["ext.compress._make_err",["ext.compress.code_truncated"]]],0],["let","deflate_len",["-",["-","n",2],4]],["let","deflate",["view.slice","data",2,"deflate_len"]],["let","doc",["ext.compress._inflate_deflate","deflate","max_out_bytes"]],["if",["ext.compress.is_err",["bytes.view","doc"]],["return","doc"],0],["let","expected",["ext.compress._read_u32_be","data",["-","n",4]]],["let","actual",["ext.compress._adler32",["ext.compress.get_view",["bytes.view","doc"]]]],["if",["=",["=","expected","actual"],0],["return",["ext.compress._make_err",["ext.compress.code_checksum_mismatch"]]],0],"doc"],"kind":"defn","name":"ext.compress.zlib_decompress","params":[{"name":"data","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"}],"imports":[],"kind":"module","meta":{"generated_by":"x07import","source_path":"import_sources/rust/ext_compress@0.1.0/compress.rs","source_sha256":"d62b0c25068d127f22b25862e5b57552bf75cd372cf74a03252de3b2ebc462ce"},"module_id":"ext.compress","schema_version":"x07.x07ast@0.3.0"}
