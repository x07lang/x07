{"decls":[{"body":["std.vec.extend_bytes","v","b"],"kind":"defn","name":"main.append_bytes","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"}],"result":"vec_u8"},{"body":["std.vec.push","v",10],"kind":"defn","name":"main.append_newline","params":[{"name":"v","ty":"vec_u8"}],"result":"vec_u8"},{"body":["std.vec.extend_bytes","v",["std.fmt.u32_to_dec","x"]],"kind":"defn","name":"main.append_u32","params":[{"name":"v","ty":"vec_u8"},{"name":"x","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","n",["view.len","hay"]],["let","m",["view.len","needle"]],["if",["=","m",0],["return",0],0],["if",["<u","n","m"],["return",0],0],["let","limit",["+",["-","n","m"],1]],["let","count",0],["for","i",0,"limit",["if",["=",["view.cmp_range","hay","i","m","needle",0,"m"],0],["set","count",["+","count",1]],0]],"count"],"kind":"defn","name":"main.count_literal","params":[{"name":"hay","ty":"bytes_view"},{"name":"needle","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","total",["view.len","set"]],["let","out",["std.text.slices.builder_new_v1","total"]],["let","count",0],["let","off",0],["for","_",0,["+","total",1],["begin",["if",[">=u","off","total"],["return",["std.text.slices.builder_finish_v1","out","count"]],0],["if",["<u","total",["+","off",4]],["return",["std.text.slices.builder_finish_v1","out","count"]],0],["let","len",["std.codec.read_u32_le","set","off"]],["let","start",["+","off",4]],["let","next",["+","start","len"]],["if",["<u","total","next"],["return",["std.text.slices.builder_finish_v1","out","count"]],0],["set","out",["std.text.slices.builder_push_v1","out","start","len"]],["set","count",["+","count",1]],["set","off","next"],0]],["std.text.slices.builder_finish_v1","out","count"]],"kind":"defn","name":"main.small_set_to_x7sl_v1","params":[{"name":"set","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.crypto","ext.hex","ext.zip","std.bytes","std.codec","std.fmt","std.text.slices","std.vec"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.3.0","solve":["begin",["let","zip_len",["view.len","input"]],["if",["=","zip_len",0],["return",["bytes.lit","ERROR:empty_input"]],0],["let","needle",["bytes.lit","TODO"]],["let","doc",["ext.zip.list_names_v1","input",512,262144]],["let","doc_v",["bytes.view","doc"]],["if",["=",["ext.zip.is_err","doc_v"],0],0,["begin",["let","code",["ext.zip.err_code","doc_v"]],["let","out",["std.vec.with_capacity",128]],["set","out",["main.append_bytes","out",["bytes.lit","ERROR:zip_list_names_v1_code="]]],["set","out",["main.append_u32","out","code"]],["set","out",["main.append_newline","out"]],["return",["std.vec.as_bytes","out"]]]],["let","names_set_v",["ext.zip.get_view","doc_v"]],["let","names_x7sl",["main.small_set_to_x7sl_v1","names_set_v"]],["let","names_x7sl_v",["bytes.view","names_x7sl"]],["let","names_count",["std.text.slices.count_v1","names_x7sl_v"]],["let","out",["std.vec.with_capacity",4096]],["set","out",["main.append_bytes","out",["bytes.lit","===_X07_Zip_Grep_==="]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","zip_len="]]],["set","out",["main.append_u32","out","zip_len"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","needle="]]],["set","out",["main.append_bytes","out",["bytes.view","needle"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_newline","out"]],["let","files_seen",0],["let","files_matched",0],["let","total_hits",0],["for","idx",0,"names_count",["begin",["let","name_v",["std.text.slices.view_at_v1","names_set_v","names_x7sl_v","idx"]],["set","files_seen",["+","files_seen",1]],["if",["if",["std.bytes.ends_with","name_v",["bytes.lit",".txt"]],1,["std.bytes.ends_with","name_v",["bytes.lit",".md"]]],["begin",["let","file_doc",["ext.zip.extract_file_v1","input","name_v",1048576]],["let","file_doc_v",["bytes.view","file_doc"]],["if",["=",["ext.zip.is_err","file_doc_v"],0],["begin",["let","file_v",["ext.zip.get_view","file_doc_v"]],["let","file_len",["view.len","file_v"]],["let","hits",["main.count_literal","file_v",["bytes.view","needle"]]],["set","total_hits",["+","total_hits","hits"]],["if",[">u","hits",0],["set","files_matched",["+","files_matched",1]],0],["let","sha",["ext.crypto.sha256","file_v"]],["let","hex",["ext.hex.hex_encode",["bytes.view","sha"]]],["set","out",["main.append_bytes","out","name_v"]],["set","out",["main.append_bytes","out",["bytes.lit","_hits="]]],["set","out",["main.append_u32","out","hits"]],["set","out",["main.append_bytes","out",["bytes.lit","_len="]]],["set","out",["main.append_u32","out","file_len"]],["set","out",["main.append_bytes","out",["bytes.lit","_sha256="]]],["set","out",["main.append_bytes","out",["bytes.view","hex"]]],["set","out",["main.append_newline","out"]],0],["begin",["set","out",["main.append_bytes","out",["bytes.lit","SKIP_extract_err:"]]],["set","out",["main.append_bytes","out","name_v"]],["set","out",["main.append_bytes","out",["bytes.lit","_code="]]],["set","out",["main.append_u32","out",["ext.zip.err_code","file_doc_v"]]],["set","out",["main.append_newline","out"]],0]],0],0],0]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","---_Summary_---"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","files_seen="]]],["set","out",["main.append_u32","out","files_seen"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","files_matched="]]],["set","out",["main.append_u32","out","files_matched"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","total_hits="]]],["set","out",["main.append_u32","out","total_hits"]],["set","out",["main.append_newline","out"]],["std.vec.as_bytes","out"]]}
