{"decls":[{"body":["std.vec.extend_bytes","v","b"],"kind":"defn","name":"main.append_bytes","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"}],"result":"vec_u8"},{"body":["std.vec.push","v",10],"kind":"defn","name":"main.append_newline","params":[{"name":"v","ty":"vec_u8"}],"result":"vec_u8"},{"body":["if",["=",["view.len","b"],0],["std.vec.extend_bytes","v","fallback"],["std.vec.extend_bytes","v","b"]],"kind":"defn","name":"main.append_opt_view_or","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"},{"name":"fallback","ty":"bytes_view"}],"result":"vec_u8"},{"body":["std.vec.extend_bytes","v",["std.fmt.u32_to_dec","x"]],"kind":"defn","name":"main.append_u32","params":[{"name":"v","ty":"vec_u8"},{"name":"x","ty":"i32"}],"result":"vec_u8"}],"imports":["ext.compress","ext.crypto","ext.hex","ext.json.pointer","ext.tar","std.bytes","std.codec","std.fmt","std.vec"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.3.0","solve":["begin",["let","in_len",["view.len","input"]],["if",["=","in_len",0],["return",["bytes.lit","ERROR:empty_input"]],0],["let","gz_doc",["ext.compress.gzip_decompress","input",16777216]],["let","gz_doc_v",["bytes.view","gz_doc"]],["if",["=",["ext.compress.is_err","gz_doc_v"],0],0,["begin",["let","code",["ext.compress.err_code","gz_doc_v"]],["let","out",["std.vec.with_capacity",128]],["set","out",["main.append_bytes","out",["bytes.lit","ERROR:gzip_decompress_code="]]],["set","out",["main.append_u32","out","code"]],["set","out",["main.append_newline","out"]],["return",["std.vec.as_bytes","out"]]]],["let","tar_bytes",["ext.compress.get_bytes","gz_doc_v"]],["let","tar_len",["bytes.len","tar_bytes"]],["let","tar_v",["bytes.view","tar_bytes"]],["let","manifest_doc",["ext.tar.find_file_v1","tar_v",["bytes.lit","manifest.json"],262144]],["let","manifest_doc_v",["bytes.view","manifest_doc"]],["if",["=",["ext.tar.is_err","manifest_doc_v"],0],0,["begin",["let","code",["ext.tar.err_code","manifest_doc_v"]],["let","out",["std.vec.with_capacity",128]],["set","out",["main.append_bytes","out",["bytes.lit","ERROR:tar_find_file_v1_manifest_json_code="]]],["set","out",["main.append_u32","out","code"]],["set","out",["main.append_newline","out"]],["return",["std.vec.as_bytes","out"]]]],["let","manifest_bytes",["ext.tar.get_bytes","manifest_doc_v"]],["let","manifest_v",["bytes.view","manifest_bytes"]],["let","name_b",["ext.json.pointer.pointer_get_string","manifest_v",["bytes.lit","/name"]]],["let","version_b",["ext.json.pointer.pointer_get_string","manifest_v",["bytes.lit","/version"]]],["let","payload_doc",["ext.tar.find_file_v1","tar_v",["bytes.lit","payload.bin"],2097152]],["let","payload_doc_v",["bytes.view","payload_doc"]],["let","payload_ok",["if",["=",["ext.tar.is_err","payload_doc_v"],0],1,0]],["let","payload_bytes",["if",["=","payload_ok",1],["ext.tar.get_bytes","payload_doc_v"],["bytes.alloc",0]]],["let","payload_len",["bytes.len","payload_bytes"]],["let","manifest_sha",["ext.crypto.sha256","manifest_v"]],["let","manifest_hex",["ext.hex.hex_encode",["bytes.view","manifest_sha"]]],["let","payload_hex",["bytes.alloc",0]],["if",["=","payload_ok",1],["begin",["let","payload_sha",["ext.crypto.sha256",["bytes.view","payload_bytes"]]],["set","payload_hex",["ext.hex.hex_encode",["bytes.view","payload_sha"]]],0],0],["let","out",["std.vec.with_capacity",2048]],["set","out",["main.append_bytes","out",["bytes.lit","===_X07_Artifact_Audit_==="]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","input_len="]]],["set","out",["main.append_u32","out","in_len"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","tar_len="]]],["set","out",["main.append_u32","out","tar_len"]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","manifest.name="]]],["set","out",["main.append_opt_view_or","out",["bytes.view","name_b"],["bytes.lit","<missing>"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","manifest.version="]]],["set","out",["main.append_opt_view_or","out",["bytes.view","version_b"],["bytes.lit","<missing>"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","manifest.sha256="]]],["set","out",["main.append_bytes","out",["bytes.view","manifest_hex"]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","payload.bin.present="]]],["set","out",["main.append_bytes","out",["if",["=","payload_ok",1],["bytes.lit","yes"],["bytes.lit","no"]]]],["set","out",["main.append_newline","out"]],["set","out",["main.append_bytes","out",["bytes.lit","payload.bin.len="]]],["set","out",["main.append_u32","out","payload_len"]],["set","out",["main.append_newline","out"]],["if",["=","payload_ok",1],["begin",["set","out",["main.append_bytes","out",["bytes.lit","payload.bin.sha256="]]],["set","out",["main.append_bytes","out",["bytes.view","payload_hex"]]],["set","out",["main.append_newline","out"]],0],0],["std.vec.as_bytes","out"]]}
