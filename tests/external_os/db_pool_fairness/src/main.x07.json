{"decls":[{"body":["begin",["let","ch",["std.db.pool.chan_v1","pool"]],["let","tok",["chan.bytes.recv","ch"]],["chan.bytes.send","events",["begin",["let","b",["bytes.alloc",1]],["set","b",["bytes.set_u8","b",0,"id"]],"b"]],["task.sleep",1],["chan.bytes.send","ch","tok"],["bytes.alloc",0]],"kind":"defasync","name":"main.worker","params":[{"name":"pool","ty":"bytes_view"},{"name":"events","ty":"i32"},{"name":"id","ty":"i32"}],"result":"bytes"}],"imports":["std.db.pool","std.db.spec","std.db.sqlite","std.db.sqlite.pool"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.2.0","solve":["begin",["let","caps",["std.db.sqlite.caps_default_v1"]],["let","hpool",["std.db.sqlite.pool.new_path_v1",["bytes.lit","benchmarks/fixtures/db/sqlite/v1/app.db"],1,["bytes.view","caps"],1]],["task.spawn","hpool"],["let","resp",["task.join.bytes","hpool"]],["if",["=",["std.db.spec.resp_is_ok_v1","resp"],0],["return",["bytes.lit","FAIL_pool_new"]],0],["let","pool",["std.db.spec.resp_ok_payload_v1","resp"]],["let","pool_v",["bytes.view","pool"]],["let","pool_close",["std.db.pool.pack_v1",["std.db.pool.chan_v1","pool_v"],["std.db.pool.max_conns_v1","pool_v"]]],["let","events",["chan.bytes.new",16]],["let","t0",["main.worker","pool_v","events",0]],["let","t1",["main.worker","pool_v","events",1]],["let","t2",["main.worker","pool_v","events",2]],["task.spawn","t0"],["task.spawn","t1"],["task.spawn","t2"],["task.join.bytes","t0"],["task.join.bytes","t1"],["task.join.bytes","t2"],["let","e0",["chan.bytes.recv","events"]],["let","e1",["chan.bytes.recv","events"]],["let","e2",["chan.bytes.recv","events"]],["let","out",["bytes.alloc",3]],["set","out",["bytes.set_u8","out",0,["bytes.get_u8","e0",0]]],["set","out",["bytes.set_u8","out",1,["bytes.get_u8","e1",0]]],["set","out",["bytes.set_u8","out",2,["bytes.get_u8","e2",0]]],["let","hclose",["std.db.sqlite.pool.close_v1","pool_close",["bytes.view","caps"]]],["task.spawn","hclose"],["let","close_resp",["task.join.bytes","hclose"]],["if",["=",["std.db.spec.resp_is_ok_v1","close_resp"],0],["return",["bytes.lit","FAIL_pool_close"]],0],"out"]}
