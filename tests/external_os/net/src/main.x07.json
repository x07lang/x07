{"decls":[],"imports":["std.io","std.net.http","std.net.http.spec","test.fixtures.file_url"],"kind":"entry","module_id":"main","schema_version":"x07.x07ast@0.1.0","solve":["begin",["let","t0",["std.net.http.spec.headers_empty_v1"]],["let","k1",["bytes.lit","X-Test"]],["let","v1",["bytes.lit","b"]],["set","t0",["std.net.http.spec.headers_push_v1","t0",["bytes.view","k1"],["bytes.view","v1"]]],["let","k2",["bytes.lit","x-test"]],["let","v2",["bytes.lit","a"]],["set","t0",["std.net.http.spec.headers_push_v1","t0",["bytes.view","k2"],["bytes.view","v2"]]],["let","canon",["std.net.http.spec.headers_canon_join_sorted_v1",["bytes.view","t0"]]],["let","canon_v",["bytes.view","canon"]],["if",["!=",["codec.read_u32_le","canon_v",0],1],["return",["bytes.lit","err"]],0],["let","pos",4],["let","klen",["codec.read_u32_le","canon_v","pos"]],["set","pos",["+","pos",4]],["let","key",["view.to_bytes",["view.slice","canon_v","pos","klen"]]],["set","pos",["+","pos","klen"]],["let","key_expected",["bytes.lit","x-test"]],["if",["=",["bytes.eq",["bytes.view","key"],["bytes.view","key_expected"]],0],["return",["bytes.lit","err"]],0],["let","vlen",["codec.read_u32_le","canon_v","pos"]],["set","pos",["+","pos",4]],["let","val",["view.to_bytes",["view.slice","canon_v","pos","vlen"]]],["let","val_expected",["begin",["let","tmp",["vec_u8.with_capacity",4]],["set","tmp",["vec_u8.push","tmp",97]],["set","tmp",["vec_u8.push","tmp",44]],["set","tmp",["vec_u8.push","tmp",32]],["set","tmp",["vec_u8.push","tmp",98]],["vec_u8.into_bytes","tmp"]]],["if",["=",["bytes.eq",["bytes.view","val"],["bytes.view","val_expected"]],0],["return",["bytes.lit","err"]],0],["let","vc",["bytes.lit","c"]],["let","set1",["std.net.http.spec.headers_set_v1",["bytes.view","t0"],["bytes.view","k1"],["bytes.view","vc"]]],["let","set1_v",["bytes.view","set1"]],["if",["!=",["codec.read_u32_le","set1_v",0],1],["return",["bytes.lit","err"]],0],["let","pos2",4],["let","klen2",["codec.read_u32_le","set1_v","pos2"]],["set","pos2",["+","pos2",4]],["let","key2",["view.to_bytes",["view.slice","set1_v","pos2","klen2"]]],["set","pos2",["+","pos2","klen2"]],["if",["=",["bytes.eq",["bytes.view","key2"],["bytes.view","key_expected"]],0],["return",["bytes.lit","err"]],0],["let","vlen2",["codec.read_u32_le","set1_v","pos2"]],["set","pos2",["+","pos2",4]],["let","val2",["view.to_bytes",["view.slice","set1_v","pos2","vlen2"]]],["if",["=",["bytes.eq",["bytes.view","val2"],["bytes.view","vc"]],0],["return",["bytes.lit","err"]],0],["let","t2",["std.net.http.spec.headers_empty_v1"]],["let","ka",["bytes.lit","A"]],["let","va1",["bytes.lit","1"]],["set","t2",["std.net.http.spec.headers_push_v1","t2",["bytes.view","ka"],["bytes.view","va1"]]],["let","kb",["bytes.lit","B"]],["let","vb2",["bytes.lit","2"]],["set","t2",["std.net.http.spec.headers_push_v1","t2",["bytes.view","kb"],["bytes.view","vb2"]]],["let","ka_l",["bytes.lit","a"]],["let","va3",["bytes.lit","3"]],["set","t2",["std.net.http.spec.headers_push_v1","t2",["bytes.view","ka_l"],["bytes.view","va3"]]],["let","v9",["bytes.lit","9"]],["let","set2",["std.net.http.spec.headers_set_v1",["bytes.view","t2"],["bytes.view","ka"],["bytes.view","v9"]]],["let","set2_v",["bytes.view","set2"]],["if",["!=",["codec.read_u32_le","set2_v",0],2],["return",["bytes.lit","err"]],0],["let","pos3",4],["let","klen3",["codec.read_u32_le","set2_v","pos3"]],["set","pos3",["+","pos3",4]],["let","key3",["view.to_bytes",["view.slice","set2_v","pos3","klen3"]]],["set","pos3",["+","pos3","klen3"]],["if",["=",["bytes.eq",["bytes.view","key3"],["bytes.view","ka_l"]],0],["return",["bytes.lit","err"]],0],["let","vlen3",["codec.read_u32_le","set2_v","pos3"]],["set","pos3",["+","pos3",4]],["let","val3",["view.to_bytes",["view.slice","set2_v","pos3","vlen3"]]],["if",["=",["bytes.eq",["bytes.view","val3"],["bytes.view","v9"]],0],["return",["bytes.lit","err"]],0],["set","pos3",["+","pos3","vlen3"]],["let","klen4",["codec.read_u32_le","set2_v","pos3"]],["set","pos3",["+","pos3",4]],["let","b_expected",["bytes.lit","b"]],["let","key4",["view.to_bytes",["view.slice","set2_v","pos3","klen4"]]],["set","pos3",["+","pos3","klen4"]],["if",["=",["bytes.eq",["bytes.view","key4"],["bytes.view","b_expected"]],0],["return",["bytes.lit","err"]],0],["let","vlen4",["codec.read_u32_le","set2_v","pos3"]],["set","pos3",["+","pos3",4]],["let","val4",["view.to_bytes",["view.slice","set2_v","pos3","vlen4"]]],["if",["=",["bytes.eq",["bytes.view","val4"],["bytes.view","vb2"]],0],["return",["bytes.lit","err"]],0],["let","url",["test.fixtures.file_url.external_os_file_url_v1"]],["let","body",["bytes.lit","hello"]],["let","caps_bad",["bytes.alloc",0]],["let","req",["std.net.http.spec.req_post_v1",["bytes.view","url"],["bytes.view","t0"],["bytes.view","body"],["bytes.view","caps_bad"]]],["let","req_v",["bytes.view","req"]],["if",["!=",["std.net.http.spec.req_method_v1","req_v"],["std.net.http.spec.method_post"]],["return",["bytes.lit","err"]],0],["let","req_url",["std.net.http.spec.req_url_v1","req_v"]],["if",["=",["bytes.eq",["bytes.view","req_url"],["bytes.view","url"]],0],["return",["bytes.lit","err"]],0],["let","req_body",["std.net.http.spec.req_body_v1","req_v"]],["if",["=",["bytes.eq",["bytes.view","req_body"],["bytes.view","body"]],0],["return",["bytes.lit","err"]],0],["let","req_headers",["std.net.http.spec.req_headers_v1","req_v"]],["let","expected_headers",["std.net.http.spec.headers_canon_join_sorted_v1",["bytes.view","t0"]]],["if",["=",["bytes.eq",["bytes.view","req_headers"],["bytes.view","expected_headers"]],0],["return",["bytes.lit","err"]],0],["let","req_caps",["std.net.http.spec.req_caps_v1","req_v"]],["let","expected_caps",["std.net.http.spec.caps_default_v1"]],["if",["=",["bytes.eq",["bytes.view","req_caps"],["bytes.view","expected_caps"]],0],["return",["bytes.lit","err"]],0],["let","out_rel",["bytes.lit","tmp/ext_net_download.bin"]],["let","req3",["std.net.http.spec.req_get_v1","url",["bytes.view","t0"],"expected_caps"]],["let","resp",["std.net.http.get_v1","url","expected_caps"]],["let","resp_v",["bytes.view","resp"]],["if",["std.net.http.resp_is_err_v1","resp_v"],["return",["bytes.lit","err"]],0],["if",["!=",["std.net.http.resp_ver_v1","resp_v"],2],["return",["bytes.lit","err"]],0],["let","body2",["std.net.http.resp_body_v1","resp_v"]],["if",["<=",["bytes.len","body2"],0],["return",["bytes.lit","err"]],0],["let","resp3",["std.net.http.fetch_to_file_v1","req3",["bytes.view","out_rel"]]],["let","resp3_v",["bytes.view","resp3"]],["if",["std.net.http.resp_is_err_v1","resp3_v"],["return",["bytes.lit","err"]],0],["if",["!=",["std.net.http.resp_ver_v1","resp3_v"],3],["return",["bytes.lit","err"]],0],["let","path3",["std.net.http.resp_file_path_v1","resp3_v"]],["let","len3",["std.net.http.resp_file_len_v1","resp3_v"]],["if",["=",["bytes.len","path3"],0],["return",["bytes.lit","err"]],0],["if",["<","len3",1],["return",["bytes.lit","err"]],0],["let","reader3",["std.net.http.resp_file_reader_v1","resp3_v"]],["let","file3",["std.io.read_all","reader3"]],["if",["!=",["bytes.len","file3"],"len3"],["return",["bytes.lit","err"]],0],["if",["=",["bytes.eq",["bytes.view","file3"],["bytes.view","body2"]],0],["return",["bytes.lit","err"]],0],["bytes.lit","ok"]]}
