{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://x07.io/spec/x07-tool.report.schema.json",
  "title": "x07.tool.report@0.1.0",
  "description": "Generic machine-readable report envelope for x07 CLI command wrappers.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "schema_version": { "type": "string" },
    "command": { "type": "string" },
    "ok": { "type": "boolean" },
    "exit_code": { "type": "integer", "minimum": 0, "maximum": 255 },
    "diagnostics": {
      "type": "array",
      "items": { "$ref": "https://x07.io/spec/x07diag.schema.json#/$defs/diagnostic" },
      "default": []
    },
    "meta": { "$ref": "#/$defs/meta" },
    "result": { "$ref": "#/$defs/result" }
  },
  "required": [
    "schema_version",
    "command",
    "ok",
    "exit_code",
    "diagnostics",
    "meta",
    "result"
  ],
  "$defs": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tool": { "$ref": "#/$defs/tool_meta" },
        "elapsed_ms": { "type": "integer", "minimum": 0 },
        "cwd": { "type": "string" },
        "argv": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["tool", "elapsed_ms", "cwd", "argv"]
    },
    "tool_meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "const": "x07" },
        "version": { "type": "string" },
        "git_sha": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{7,40}$"
        }
      },
      "required": ["name", "version"]
    },
    "result": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "stdout": { "$ref": "#/$defs/stream_payload" },
        "stderr": { "$ref": "#/$defs/stream_payload" },
        "stdout_json": {},
        "stderr_json": {}
      },
      "required": ["stdout", "stderr"]
    },
    "stream_payload": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "bytes_len": { "type": "integer", "minimum": 0 },
        "text": { "type": "string" },
        "base64": { "type": "string" }
      },
      "required": ["bytes_len"]
    }
  }
}
