{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "std.math.decimal.codec_v1",
  "imports": [
    "std.math.bigint"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "std.math.decimal.codec_v1.sign_v1",
        "std.math.decimal.codec_v1.scale_v1",
        "std.math.decimal.codec_v1.is_valid_v1",
        "std.math.decimal.codec_v1.mag_view_v1",
        "std.math.decimal.codec_v1.canon_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._zero",
      "params": [],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "out", ["vec_u8.with_capacity", 9]],
        ["set", "out", ["vec_u8.push", "out", 0]],
        ["set", "out", ["vec_u8.extend_bytes", "out", ["codec.write_u32_le", 0]]],
        ["set", "out", ["vec_u8.extend_bytes", "out", ["codec.write_u32_le", 0]]],
        ["vec_u8.into_bytes", "out"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._make",
      "params": [
        { "name": "sign", "ty": "i32" },
        { "name": "scale", "ty": "i32" },
        { "name": "mag", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "mag_len", ["view.len", "mag"]],
        ["let", "out", ["vec_u8.with_capacity", ["+", 9, "mag_len"]]],
        ["set", "out", ["vec_u8.push", "out", "sign"]],
        ["set", "out", ["vec_u8.extend_bytes", "out", ["codec.write_u32_le", "scale"]]],
        ["set", "out", ["vec_u8.extend_bytes", "out", ["codec.write_u32_le", "mag_len"]]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "mag", 0, "mag_len"]],
        ["vec_u8.into_bytes", "out"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._mag_is_zero_vec",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["if", ["=", "n", 0], ["return", 1], 0],
        ["if", ["=", "n", 1], ["return", ["=", ["view.get_u8", "v", 0], 0]], 0],
        ["for", "i", 0, "n", ["if", ["=", ["view.get_u8", "v", "i"], 0], 0, ["return", 0]]],
        1
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._mag_mod_u32_be",
      "params": [
        { "name": "mag", "ty": "bytes_view" },
        { "name": "d", "ty": "i32" }
      ],
      "result": "i32",
      "body": [
        "begin",
        ["if", ["<=", "d", 0], ["return", -1], 0],
        ["let", "n", ["view.len", "mag"]],
        ["let", "rem", 0],
        [
          "for",
          "i",
          0,
          "n",
          [
            "begin",
            ["let", "b", ["view.get_u8", "mag", "i"]],
            ["set", "rem", ["%", ["+", ["*", "rem", 256], "b"], "d"]]
          ]
        ],
        "rem"
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._mag_div_u32_be",
      "params": [
        { "name": "v", "ty": "vec_u8" },
        { "name": "d", "ty": "i32" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["<=", "d", 0], ["return", "v"], 0],
        ["let", "n", ["vec_u8.len", "v"]],
        ["let", "rem", 0],
        [
          "for",
          "i",
          0,
          "n",
          [
            "begin",
            ["let", "b", ["vec_u8.get", "v", "i"]],
            ["let", "val", ["+", ["*", "rem", 256], "b"]],
            ["let", "q", ["/", "val", "d"]],
            ["set", "rem", ["%", "val", "d"]],
            ["set", "v", ["vec_u8.set", "v", "i", "q"]]
          ]
        ],
        "v"
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1.sign_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["if", ["<u", "n", 9], ["return", -1], 0],
        ["let", "s", ["view.get_u8", "v", 0]],
        ["if", ["if", ["if", ["=", "s", 0], 1, ["=", "s", 1]], 1, ["=", "s", 2]], ["return", "s"], 0],
        -1
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1._shape_ok_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["if", ["<u", "n", 9], ["return", 0], 0],
        ["let", "scale", ["codec.read_u32_le", "v", 1]],
        ["if", ["<", "scale", 0], ["return", 0], 0],
        ["let", "mag_len", ["codec.read_u32_le", "v", 5]],
        ["if", ["<", "mag_len", 0], ["return", 0], 0],
        ["=", "n", ["+", 9, "mag_len"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1.scale_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["if", ["=", ["std.math.decimal.codec_v1._shape_ok_v1", "v"], 0], ["return", -1], 0],
        ["codec.read_u32_le", "v", 1]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1.mag_view_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "bytes_view",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["if", ["=", ["std.math.decimal.codec_v1._shape_ok_v1", "v"], 0], ["return", ["view.slice", "v", "n", 0]], 0],
        ["let", "mag_len", ["codec.read_u32_le", "v", 5]],
        ["view.slice", "v", 9, "mag_len"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1.is_valid_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "s", ["std.math.decimal.codec_v1.sign_v1", "v"]],
        ["if", ["<", "s", 0], ["return", 0], 0],
        ["std.math.decimal.codec_v1._shape_ok_v1", "v"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.decimal.codec_v1.canon_v1",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["if", ["=", ["std.math.decimal.codec_v1._shape_ok_v1", "v"], 0], ["return", ["bytes.alloc", 0]], 0],
        ["let", "s", ["view.get_u8", "v", 0]],
        ["if", ["if", ["if", ["=", "s", 0], 1, ["=", "s", 1]], 1, ["=", "s", 2]], 0, ["return", ["bytes.alloc", 0]]],
        ["let", "scale0", ["codec.read_u32_le", "v", 1]],
        ["let", "mag_len0", ["codec.read_u32_le", "v", 5]],
        ["if", ["=", "s", 0], ["return", ["std.math.decimal.codec_v1._zero"]], 0],
        ["if", ["=", "mag_len0", 0], ["return", ["std.math.decimal.codec_v1._zero"]], 0],
        ["let", "mag0", ["view.slice", "v", 9, "mag_len0"]],
        ["let", "work", ["vec_u8.with_capacity", "mag_len0"]],
        ["set", "work", ["vec_u8.extend_bytes_range", "work", "mag0", 0, "mag_len0"]],
        ["set", "work", ["std.math.bigint._trim_mag_vec", "work"]],
        ["if", ["std.math.decimal.codec_v1._mag_is_zero_vec", ["vec_u8.as_view", "work"]], ["return", ["std.math.decimal.codec_v1._zero"]], 0],
        ["let", "scale", "scale0"],
        ["let", "done", 0],
        [
          "for",
          "_",
          0,
          10000,
          [
            "if",
            ["=", "done", 0],
            [
              "if",
              ["=", "scale", 0],
              ["set", "done", 1],
              [
                "begin",
                ["let", "rem", ["std.math.decimal.codec_v1._mag_mod_u32_be", ["vec_u8.as_view", "work"], 10]],
                [
                  "if",
                  ["=", "rem", 0],
                  [
                    "begin",
                    ["set", "work", ["std.math.decimal.codec_v1._mag_div_u32_be", "work", 10]],
                    ["set", "work", ["std.math.bigint._trim_mag_vec", "work"]],
                    ["set", "scale", ["-", "scale", 1]],
                    ["if", ["std.math.decimal.codec_v1._mag_is_zero_vec", ["vec_u8.as_view", "work"]], ["begin", ["set", "done", 1], ["set", "s", 0], ["set", "scale", 0]], 0]
                  ],
                  ["set", "done", 1]
                ]
              ]
            ],
            0
          ]
        ],
        ["if", ["=", "s", 0], ["return", ["std.math.decimal.codec_v1._zero"]], 0],
        ["let", "magv", ["vec_u8.as_view", "work"]],
        ["std.math.decimal.codec_v1._make", "s", "scale", "magv"]
      ]
    }
  ],
  "meta": {
    "generated_by": "manual",
    "package": "x07:ext-decimal-rs@0.1.0"
  }
}
