{"decls":[{"kind":"export","names":["ext.cli.specrows.compile","ext.cli.specrows.validate"]},{"body":["begin",["let","rows_count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","rows_count",0],["return",["result_bytes.err",1001]],0],["let","root",["bytes.lit","root"]],["let","help_kind",["bytes.lit","help"]],["let","version_kind",["bytes.lit","version"]],["let","help_long",["bytes.lit","--help"]],["let","version_long",["bytes.lit","--version"]],["let","help_desc",["bytes.lit","Show_help"]],["let","version_desc",["bytes.lit","Show_version"]],["let","empty_short",["bytes.alloc",0]],["let","seen_scopes",["std.small_set.empty_bytes"]],["let","scopes_payload",["vec_u8.with_capacity",0]],["let","scopes_count",0],["set","seen_scopes",["std.small_set.insert_bytes","seen_scopes",["std.bytes.copy",["bytes.view","root"]]]],["set","scopes_payload",["vec_u8.extend_bytes","scopes_payload",["codec.write_u32_le",["bytes.len","root"]]]],["set","scopes_payload",["vec_u8.extend_bytes","scopes_payload","root"]],["set","scopes_count",1],["let","help_scopes",["std.small_set.empty_bytes"]],["let","root_has_version",0],["for","i",0,"rows_count",["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","scope",["ext.data_model.string_get","docv","scope_off"]],["if",["=",["std.small_set.contains_bytes",["std.bytes.copy",["bytes.view","seen_scopes"]],["std.bytes.copy",["bytes.view","scope"]]],0],["begin",["set","seen_scopes",["std.small_set.insert_bytes","seen_scopes",["std.bytes.copy",["bytes.view","scope"]]]],["set","scopes_payload",["vec_u8.extend_bytes","scopes_payload",["codec.write_u32_le",["bytes.len","scope"]]]],["set","scopes_payload",["vec_u8.extend_bytes","scopes_payload","scope"]],["set","scopes_count",["+","scopes_count",1]],0],0],["let","kind_off",["ext.data_model.seq_get","docv","row_off",1]],["let","kind",["ext.data_model.string_get","docv","kind_off"]],["if",["bytes.eq","kind","help_kind"],["set","help_scopes",["std.small_set.insert_bytes","help_scopes",["std.bytes.copy",["bytes.view","scope"]]]],0],["if",["if",["bytes.eq","kind","version_kind"],["bytes.eq","scope","root"],0],["set","root_has_version",1],0],0]],["let","out_payload",["vec_u8.with_capacity",0]],["let","out_count",0],["for","i",0,"rows_count",["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","row_end",["ext.data_model.skip_value","docv","row_off"]],["if",["<","row_end",0],["return",["result_bytes.err",1099]],0],["let","row_len",["-","row_end","row_off"]],["set","out_payload",["vec_u8.extend_bytes","out_payload",["codec.write_u32_le","row_len"]]],["set","out_payload",["vec_u8.extend_bytes_range","out_payload","docv","row_off","row_len"]],["set","out_count",["+","out_count",1]],0]],["let","scopes_b",["std.vec.as_bytes","scopes_payload"]],["let","scopes_v",["bytes.view","scopes_b"]],["let","pos",0],["for","j",0,"scopes_count",["begin",["if",["<u",["view.len","scopes_v"],["+","pos",4]],["return",["result_bytes.err",1099]],0],["let","s_len",["codec.read_u32_le","scopes_v","pos"]],["let","s_start",["+","pos",4]],["if",["<u",["view.len","scopes_v"],["+","s_start","s_len"]],["return",["result_bytes.err",1099]],0],["let","s_view",["view.slice","scopes_v","s_start","s_len"]],["set","pos",["+","s_start","s_len"]],["if",["=",["std.small_set.contains_bytes",["std.bytes.copy",["bytes.view","help_scopes"]],["std.bytes.copy","s_view"]],0],["begin",["let","row_val",["begin",["let","scope_val",["ext.data_model.value_string","s_view"]],["let","kind_val",["ext.data_model.value_string",["bytes.view","help_kind"]]],["let","short_val",["ext.data_model.value_string",["bytes.view","empty_short"]]],["let","long_val",["ext.data_model.value_string",["bytes.view","help_long"]]],["let","desc_val",["ext.data_model.value_string",["bytes.view","help_desc"]]],["let","row_elems",["vec_u8.with_capacity",0]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",5]]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","scope_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","scope_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","kind_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","kind_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","short_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","short_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","long_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","long_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","desc_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","desc_val"]],["let","row_elems_b",["std.vec.as_bytes","row_elems"]],["let","row_val",["ext.data_model.value_seq_from_elems",["bytes.view","row_elems_b"]]],["if",["=",["bytes.len","row_val"],0],["return",["result_bytes.err",1099]],0],"row_val"]],["set","out_payload",["vec_u8.extend_bytes","out_payload",["codec.write_u32_le",["bytes.len","row_val"]]]],["set","out_payload",["vec_u8.extend_bytes","out_payload","row_val"]],["set","out_count",["+","out_count",1]],0],0],0]],["if",["=","root_has_version",0],["begin",["let","row_val",["begin",["let","scope_val",["ext.data_model.value_string",["bytes.view","root"]]],["let","kind_val",["ext.data_model.value_string",["bytes.view","version_kind"]]],["let","short_val",["ext.data_model.value_string",["bytes.view","empty_short"]]],["let","long_val",["ext.data_model.value_string",["bytes.view","version_long"]]],["let","desc_val",["ext.data_model.value_string",["bytes.view","version_desc"]]],["let","row_elems",["vec_u8.with_capacity",0]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",5]]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","scope_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","scope_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","kind_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","kind_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","short_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","short_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","long_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","long_val"]],["set","row_elems",["vec_u8.extend_bytes","row_elems",["codec.write_u32_le",["bytes.len","desc_val"]]]],["set","row_elems",["vec_u8.extend_bytes","row_elems","desc_val"]],["let","row_elems_b",["std.vec.as_bytes","row_elems"]],["let","row_val",["ext.data_model.value_seq_from_elems",["bytes.view","row_elems_b"]]],["if",["=",["bytes.len","row_val"],0],["return",["result_bytes.err",1099]],0],"row_val"]],["set","out_payload",["vec_u8.extend_bytes","out_payload",["codec.write_u32_le",["bytes.len","row_val"]]]],["set","out_payload",["vec_u8.extend_bytes","out_payload","row_val"]],["set","out_count",["+","out_count",1]],0],0],["let","payload_b",["std.vec.as_bytes","out_payload"]],["let","elems",["vec_u8.with_capacity",["+",4,["bytes.len","payload_b"]]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","out_count"]]],["set","elems",["vec_u8.extend_bytes","elems","payload_b"]],["let","elems_b",["std.vec.as_bytes","elems"]],["let","rows_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["bytes.len","rows_val"],0],["return",["result_bytes.err",1099]],0],["result_bytes.ok","rows_val"]],"kind":"defn","name":"ext.cli.specrows._build_rows_val_v1","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"}],"result":"result_bytes"},{"body":["begin",["let","doc",["ext.json.data_model.parse",["bytes.view","spec_json"]]],["let","docv",["bytes.view","doc"]],["if",["ext.data_model.doc_is_err","docv"],["return",["result_bytes.err",1001]],0],["let","root_off",["ext.data_model.root_offset","docv"]],["let","schema_key",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","docv","root_off",["bytes.view","schema_key"]]],["if",["<","schema_off",0],["return",["result_bytes.err",1001]],0],["let","schema",["ext.data_model.string_get","docv","schema_off"]],["if",["bytes.eq","schema",["bytes.lit","x07cli.specrows@0.1.0"]],0,["return",["result_bytes.err",1001]]],["let","rows_key",["bytes.lit","rows"]],["let","rows_off",["ext.data_model.map_find","docv","root_off",["bytes.view","rows_key"]]],["if",["<","rows_off",0],["return",["result_bytes.err",1001]],0],["let","rows_val",["try",["ext.cli.specrows._build_rows_val_v1","docv","rows_off"]]],["let","map_len",["ext.data_model.map_len","docv","root_off"]],["if",["<","map_len",0],["return",["result_bytes.err",1099]],0],["let","entries",["vec_u8.with_capacity",0]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","map_len"]]],["for","i",0,"map_len",["begin",["let","k",["ext.data_model.map_key_at","docv","root_off","i"]],["let","v_off",["ext.data_model.map_value_at","docv","root_off","i"]],["if",["bytes.eq","k","rows_key"],["begin",["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","k"]]]],["set","entries",["vec_u8.extend_bytes","entries","k"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","rows_val"]]]],["set","entries",["vec_u8.extend_bytes","entries","rows_val"]],0],["begin",["let","v_end",["ext.data_model.skip_value","docv","v_off"]],["if",["<","v_end",0],["return",["result_bytes.err",1099]],0],["let","v_len",["-","v_end","v_off"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","k"]]]],["set","entries",["vec_u8.extend_bytes","entries","k"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","v_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","docv","v_off","v_len"]],0]],0]],["let","entries_b",["std.vec.as_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["if",["=",["bytes.len","map_val"],0],["return",["result_bytes.err",1099]],0],["let","new_doc",["ext.data_model.doc_ok",["bytes.view","map_val"]]],["result_bytes.ok","new_doc"]],"kind":"defn","name":"ext.cli.specrows.compile","params":[{"name":"spec_json","ty":"bytes"}],"result":"result_bytes"},{"body":["begin",["let","res",["ext.cli.specrows.compile","spec_json"]],["let","code",["result_bytes.err_code","res"]],["if",["=","code",0],["result_i32.ok",0],["result_i32.err","code"]]],"kind":"defn","name":"ext.cli.specrows.validate","params":[{"name":"spec_json","ty":"bytes"}],"result":"result_i32"}],"imports":["ext.data_model","ext.json.data_model","std.bytes","std.small_set","std.vec"],"kind":"module","module_id":"ext.cli.specrows","schema_version":"x07.x07ast@0.3.0"}
