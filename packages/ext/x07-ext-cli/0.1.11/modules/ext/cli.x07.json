{"decls":[{"kind":"export","names":["ext.cli.err_code","ext.cli.err_msg","ext.cli.err_usage","ext.cli.is_ok","ext.cli.matches_cmd","ext.cli.matches_get","ext.cli.parse_compiled","ext.cli.parse_specrows"]},{"body":["if",["<u",["view.len","argv_v1"],4],-1,["codec.read_u32_le","argv_v1",0]],"kind":"defn","name":"ext.cli._argv_count","params":[{"name":"argv_v1","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","argv_v1"]],["if",["<u","n",4],["return",["bytes.alloc",0]],0],["let","argc",["codec.read_u32_le","argv_v1",0]],["let","out",["std.text.slices.builder_new_v1","argc"]],["let","off",4],["for","_",0,"argc",["begin",["if",["<u","n",["+","off",4]],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","argv_v1","off"]],["let","start",["+","off",4]],["if",["<u","n",["+","start","len"]],["return",["bytes.alloc",0]],0],["set","out",["std.text.slices.builder_push_v1","out","start","len"]],["set","off",["+","start","len"]],0]],["std.text.slices.builder_finish_v1","out","argc"]],"kind":"defn","name":"ext.cli._argv_index","params":[{"name":"argv_v1","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","rows_count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","rows_count",0],["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_spec"],["std.bytes.copy","usage"]]],0],["let","out","entries"],["let","help_key",["bytes.lit","help"]],["let","version_key",["bytes.lit","version"]],["let","required_key",["bytes.lit","required"]],["let","multiple_key",["bytes.lit","multiple"]],["begin",["let","help_off",["ext.cli._match_map_find",["bytes.view","out"],["bytes.view","help_key"]]],["if",[">=","help_off",0],["return","out"],0],["let","ver_off",["ext.cli._match_map_find",["bytes.view","out"],["bytes.view","version_key"]]],["if",[">=","ver_off",0],["return","out"],0],0],["let","pos_i",0],["for","i",0,"rows_count",["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","row_scope",["ext.data_model.string_get","docv","scope_off"]],["if",["view.eq","scope",["bytes.view","row_scope"]],["begin",["let","kind_off",["ext.data_model.seq_get","docv","row_off",1]],["let","kind",["ext.data_model.string_get","docv","kind_off"]],["if",["bytes.eq","kind",["bytes.lit","opt"]],["begin",["let","key_off",["ext.data_model.seq_get","docv","row_off",4]],["let","key",["ext.data_model.string_get","docv","key_off"]],["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["let","req",["if",[">=","row_len",8],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",7]],["let","r_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","required_key"]]],["if",["<","r_off",0],0,["ext.data_model.bool_get","docv","r_off"]]],0]],["if",["=","req",1],["if",["<",["ext.cli._match_map_find",["bytes.view","out"],["bytes.view","key"]],0],["return",["ext.cli._err_v1",1002,["bytes.lit","missing_required_opt"],["std.bytes.copy","usage"]]],0],0],0],["if",["bytes.eq","kind",["bytes.lit","arg"]],["begin",["let","pos_name_off",["ext.data_model.seq_get","docv","row_off",2]],["let","pos_name",["ext.data_model.string_get","docv","pos_name_off"]],["let","key_off",["ext.data_model.seq_get","docv","row_off",3]],["let","key",["ext.data_model.string_get","docv","key_off"]],["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["let","req",["if",[">=","row_len",6],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",5]],["let","r_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","required_key"]]],["if",["<","r_off",0],1,["ext.data_model.bool_get","docv","r_off"]]],1]],["let","is_multi",["if",[">=","row_len",6],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",5]],["let","m_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","multiple_key"]]],["if",["<","m_off",0],0,["ext.data_model.bool_get","docv","m_off"]]],0]],["if",["=","is_multi",1],["begin",["let","rem",["-","pos_count","pos_i"]],["if",["<=","rem",0],["if",["=","req",1],["return",["ext.cli._err_v1",1002,["bytes.lit","missing_required_arg"],["std.bytes.copy","usage"]]],0],["begin",["let","mv",["vec_u8.with_capacity",0]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le","rem"]]],["for","j","pos_i","pos_count",["begin",["let","start",["std.text.slices.start_v1","pos_idx","j"]],["let","len",["std.text.slices.len_v1","pos_idx","j"]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le","len"]]],["set","mv",["vec_u8.extend_bytes_range","mv","argv_v1","start","len"]],0]],["let","mb",["std.vec.as_bytes","mv"]],["set","out",["ext.cli._match_map_put","out",["bytes.view","key"],4,["bytes.view","mb"]]],["set","pos_i","pos_count"],0]],0],["begin",["if",[">=","pos_i","pos_count"],["if",["=","req",1],["return",["ext.cli._err_v1",1002,["bytes.lit","missing_required_arg"],["std.bytes.copy","usage"]]],0],["begin",["let","start",["std.text.slices.start_v1","pos_idx","pos_i"]],["let","len",["std.text.slices.len_v1","pos_idx","pos_i"]],["let","tok",["view.slice","argv_v1","start","len"]],["set","out",["ext.cli._match_map_put","out",["bytes.view","key"],3,"tok"]],["set","pos_i",["+","pos_i",1]],0]],0]],0],0]],0],0],0]],["if",["<","pos_i","pos_count"],["return",["ext.cli._err_v1",1002,["bytes.lit","too_many_args"],["std.bytes.copy","usage"]]],0],"out"],"kind":"defn","name":"ext.cli._bind_args","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"},{"name":"scope","ty":"bytes_view"},{"name":"argv_v1","ty":"bytes_view"},{"name":"pos_idx","ty":"bytes_view"},{"name":"pos_count","ty":"i32"},{"name":"entries","ty":"bytes"},{"name":"usage","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","count",0],["return",["bytes.alloc",0]],0],["let","seen",["std.small_set.empty_bytes"]],["let","payload",["vec_u8.with_capacity",0]],["let","out_count",0],["for","i",0,"count",["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","scope",["ext.data_model.string_get","docv","scope_off"]],["if",["bytes.eq","scope",["bytes.lit","root"]],0,["begin",["begin",["let","_x07_tmp_scope_for_contains",["std.bytes.copy",["bytes.view","scope"]]],["if",["=",["std.small_set.contains_bytes",["std.bytes.copy",["bytes.view","seen"]],"_x07_tmp_scope_for_contains"],0],["begin",["set","seen",["std.small_set.insert_bytes","seen",["std.bytes.copy",["bytes.view","scope"]]]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","scope"]]]],["set","payload",["vec_u8.extend_bytes","payload","scope"]],["set","out_count",["+","out_count",1]],0],0]]]],0]],["let","out",["vec_u8.with_capacity",["+",4,["vec_u8.len","payload"]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","out_count"]]],["set","out",["vec_u8.extend_bytes","out",["std.vec.as_bytes","payload"]]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._collect_subcommands","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","msg_len",["bytes.len","msg"]],["let","usage_len",["bytes.len","usage"]],["let","out",["vec_u8.with_capacity",["+",13,["+","msg_len","usage_len"]]]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","msg_len"]]],["set","out",["vec_u8.extend_bytes","out","msg"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","usage_len"]]],["set","out",["vec_u8.extend_bytes","out","usage"]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._err_v1","params":[{"name":"code","ty":"i32"},{"name":"msg","ty":"bytes"},{"name":"usage","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","tok"]],["if",["<u","n",2],["return",0],0],["if",["!=",["view.get_u8","tok",0],45],0,1]],"kind":"defn","name":"ext.cli._is_option_token","params":[{"name":"tok","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","key_len",["view.len","key"]],["let","total",["view.len","m"]],["let","off",0],["for","_",0,["+","total",1],["begin",["if",[">=u","off","total"],["return",-1],0],["if",["<u",["-","total","off"],9],["return",-1],0],["let","klen",["codec.read_u32_le","m","off"]],["let","kstart",["+","off",4]],["let","cmp",["bytes.cmp_range","key",0,"key_len","m","kstart","klen"]],["if",["=","cmp",0],["return","off"],0],["if",["<","cmp",0],["return",-1],0],["let","kind_pos",["+","kstart","klen"]],["let","vlen_off",["+","kind_pos",1]],["if",["<u","total",["+","vlen_off",4]],["return",-1],0],["let","vlen",["codec.read_u32_le","m","vlen_off"]],["set","off",["+","vlen_off",["+",4,"vlen"]]],0]],-1],"kind":"defn","name":"ext.cli._match_map_find","params":[{"name":"m","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","total",["view.len","m"]],["let","off",0],["let","count",0],["for","_",0,["+","total",1],["begin",["if",[">=u","off","total"],["return","count"],0],["if",["<u",["-","total","off"],9],["return","count"],0],["let","klen",["codec.read_u32_le","m","off"]],["let","kind_pos",["+","off",["+",4,"klen"]]],["let","vlen_off",["+","kind_pos",1]],["if",["<u","total",["+","vlen_off",4]],["return","count"],0],["let","vlen",["codec.read_u32_le","m","vlen_off"]],["set","off",["+","vlen_off",["+",4,"vlen"]]],["set","count",["+","count",1]],0]],"count"],"kind":"defn","name":"ext.cli._match_map_len","params":[{"name":"m","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out","m"],["let","rv",["bytes.view","r"]],["let","n",["bytes.len","r"]],["if",["<u","n",3],["return","out"],0],["let","off",2],["for","_",0,["+","n",1],["begin",["if",[">=u","off","n"],["return","out"],0],["if",["<u",["-","n","off"],9],["return","out"],0],["let","klen",["codec.read_u32_le","rv","off"]],["let","kstart",["+","off",4]],["let","kind_pos",["+","kstart","klen"]],["if",["<u","n",["+","kind_pos",1]],["return","out"],0],["let","kind",["view.get_u8","rv","kind_pos"]],["let","vlen_off",["+","kind_pos",1]],["if",["<u","n",["+","vlen_off",4]],["return","out"],0],["let","vlen",["codec.read_u32_le","rv","vlen_off"]],["let","vstart",["+","vlen_off",4]],["let","next",["+","vstart","vlen"]],["if",["<u","n","next"],["return","out"],0],["let","key",["view.slice","rv","kstart","klen"]],["let","val",["view.slice","rv","vstart","vlen"]],["if",["=","kind",1],["begin",["let","entry_off",["ext.cli._match_map_find",["bytes.view","out"],"key"]],["let","old_count",["if",["<","entry_off",0],0,["begin",["let","old_klen",["codec.read_u32_le",["bytes.view","out"],"entry_off"]],["let","old_kind_pos",["+","entry_off",["+",4,"old_klen"]]],["let","old_vlen_off",["+","old_kind_pos",1]],["let","old_vlen",["codec.read_u32_le",["bytes.view","out"],"old_vlen_off"]],["let","old_vstart",["+","old_vlen_off",4]],["if",["<u","old_vlen",1],0,["view.get_u8",["bytes.view","out"],"old_vstart"]]]]],["let","inc",["if",["<u","vlen",1],0,["view.get_u8","rv","vstart"]]],["let","sum",["+","old_count","inc"]],["let","new_count",["if",["<","sum",255],"sum",255]],["let","b",["bytes.alloc",1]],["set","b",["bytes.set_u8","b",0,"new_count"]],["set","out",["ext.cli._match_map_put","out","key",1,["bytes.view","b"]]],0],["if",["=","kind",4],["begin",["let","entry_off",["ext.cli._match_map_find",["bytes.view","out"],"key"]],["if",["<","entry_off",0],["begin",["set","out",["ext.cli._match_map_put","out","key",4,"val"]],0],["begin",["let","old_klen",["codec.read_u32_le",["bytes.view","out"],"entry_off"]],["let","old_kind_pos",["+","entry_off",["+",4,"old_klen"]]],["let","old_kind",["view.get_u8",["bytes.view","out"],"old_kind_pos"]],["let","old_vlen_off",["+","old_kind_pos",1]],["let","old_vlen",["codec.read_u32_le",["bytes.view","out"],"old_vlen_off"]],["let","old_vstart",["+","old_vlen_off",4]],["if",["!=","old_kind",4],["begin",["set","out",["ext.cli._match_map_put","out","key",4,"val"]],0],["begin",["if",["<u","old_vlen",4],["begin",["set","out",["ext.cli._match_map_put","out","key",4,"val"]],0],["if",["<u","vlen",4],0,["begin",["let","old_count",["codec.read_u32_le",["bytes.view","out"],"old_vstart"]],["let","new_count",["codec.read_u32_le","rv","vstart"]],["let","total_count",["+","old_count","new_count"]],["let","mv",["vec_u8.with_capacity",["+","old_vlen","vlen"]]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le","total_count"]]],["set","mv",["vec_u8.extend_bytes_range","mv",["bytes.view","out"],["+","old_vstart",4],["-","old_vlen",4]]],["set","mv",["vec_u8.extend_bytes_range","mv","rv",["+","vstart",4],["-","vlen",4]]],["let","mb",["std.vec.as_bytes","mv"]],["set","out",["ext.cli._match_map_put","out","key",4,["bytes.view","mb"]]],0]]]]],0]],0],["begin",["set","out",["ext.cli._match_map_put","out","key","kind","val"]],0]]],["set","off","next"],0]],"out"],"kind":"defn","name":"ext.cli._match_map_merge","params":[{"name":"m","ty":"bytes"},{"name":"r","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","key_len",["view.len","key"]],["let","vlen",["view.len","value"]],["let","total",["bytes.len","m"]],["let","out",["vec_u8.with_capacity",["+","total",["+",9,["+","key_len","vlen"]]]]],["let","inserted",0],["let","off",0],["for","_",0,["+","total",1],["begin",["if",[">=u","off","total"],["begin",["if",["=","inserted",0],["begin",["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","key_len"]]],["set","out",["vec_u8.extend_bytes","out","key"]],["set","out",["vec_u8.push","out","kind"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","vlen"]]],["set","out",["vec_u8.extend_bytes","out","value"]],["set","inserted",1]],0],["return",["std.vec.as_bytes","out"]]],0],["let","entry_klen",["codec.read_u32_le","m","off"]],["let","entry_kstart",["+","off",4]],["let","entry_kind_pos",["+","entry_kstart","entry_klen"]],["let","entry_vlen_off",["+","entry_kind_pos",1]],["let","entry_vlen",["codec.read_u32_le","m","entry_vlen_off"]],["let","entry_next",["+","entry_vlen_off",["+",4,"entry_vlen"]]],["if",["=","inserted",0],["begin",["let","cmp",["bytes.cmp_range","key",0,"key_len","m","entry_kstart","entry_klen"]],["if",["=","cmp",0],["begin",["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","key_len"]]],["set","out",["vec_u8.extend_bytes","out","key"]],["set","out",["vec_u8.push","out","kind"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","vlen"]]],["set","out",["vec_u8.extend_bytes","out","value"]],["set","inserted",1]],["if",["<","cmp",0],["begin",["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","key_len"]]],["set","out",["vec_u8.extend_bytes","out","key"]],["set","out",["vec_u8.push","out","kind"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","vlen"]]],["set","out",["vec_u8.extend_bytes","out","value"]],["set","inserted",1],["set","out",["vec_u8.extend_bytes_range","out","m","off",["-","entry_next","off"]]],0],["begin",["set","out",["vec_u8.extend_bytes_range","out","m","off",["-","entry_next","off"]]],0]]]],["begin",["set","out",["vec_u8.extend_bytes_range","out","m","off",["-","entry_next","off"]]],0]],["set","off","entry_next"],0]],"m"],"kind":"defn","name":"ext.cli._match_map_put","params":[{"name":"m","ty":"bytes"},{"name":"key","ty":"bytes_view"},{"name":"kind","ty":"i32"},{"name":"value","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","cmd_len",["view.len","cmd"]],["let","entries_v",["bytes.view","entries"]],["let","entry_count",["ext.cli._match_map_len","entries_v"]],["let","out",["vec_u8.with_capacity",["+",9,["+","cmd_len",["bytes.len","entries"]]]]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","cmd_len"]]],["set","out",["vec_u8.extend_bytes","out","cmd"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","entry_count"]]],["set","out",["vec_u8.extend_bytes","out","entries"]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._matches_v1","params":[{"name":"cmd","ty":"bytes_view"},{"name":"entries","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","usage",["ext.cli._usage_short","docv","rows_off","app_name","scope"]],["let","tok_len",["view.len","tok"]],["let","is_long",["if",[">=u","tok_len",2],["=",["view.get_u8","tok",1],45],0]],["if",["=","is_long",1],["ext.cli._parse_one_option_long","docv","rows_off","scope","tok","argv_v1","tok_idx","ti","usage"],["ext.cli._parse_one_option_short_bundle","docv","rows_off","scope","tok","argv_v1","tok_idx","ti","usage"]]],"kind":"defn","name":"ext.cli._parse_one_option","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"},{"name":"app_name","ty":"bytes_view"},{"name":"scope","ty":"bytes_view"},{"name":"tok","ty":"bytes_view"},{"name":"argv_v1","ty":"bytes_view"},{"name":"tok_idx","ty":"bytes_view"},{"name":"ti","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","tok_len",["view.len","tok"]],["let","consumed",0],["let","payload",["vec_u8.with_capacity",0]],["let","root",["bytes.lit","root"]],["let","global_key",["bytes.lit","global"]],["let","multiple_key",["bytes.lit","multiple"]],["begin",["let","eq_pos",["std.bytes.find_u8","tok",61]],["let","name",["if",[">=","eq_pos",0],["view.slice","tok",0,"eq_pos"],"tok"]],["let","inline_val",["if",[">=","eq_pos",0],["view.slice","tok",["+","eq_pos",1],["-","tok_len",["+","eq_pos",1]]],["view.slice","tok","tok_len",0]]],["let","rows_count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","rows_count",0],["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_spec"],"usage"]],0],["let","found_row",-1],["let","found_kind",["bytes.alloc",0]],["for","i",0,"rows_count",["begin",["if",["=","found_row",-1],["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","row_scope",["ext.data_model.string_get","docv","scope_off"]],["let","kind_off",["ext.data_model.seq_get","docv","row_off",1]],["let","kind",["ext.data_model.string_get","docv","kind_off"]],["let","in_scope",["begin",["let","row_scope_v",["bytes.view","row_scope"]],["let","root_v",["bytes.view","root"]],["if",["view.eq","scope","row_scope_v"],1,["if",["view.eq","scope","root_v"],0,["if",["view.eq","root_v","row_scope_v"],["begin",["if",["bytes.eq","kind",["bytes.lit","flag"]],["begin",["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["if",[">=","row_len",7],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",6]],["let","g_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","global_key"]]],["if",["<","g_off",0],0,["ext.data_model.bool_get","docv","g_off"]]],0]],["if",["bytes.eq","kind",["bytes.lit","opt"]],["begin",["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["if",[">=","row_len",8],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",7]],["let","g_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","global_key"]]],["if",["<","g_off",0],0,["ext.data_model.bool_get","docv","g_off"]]],0]],0]]],0]]]]],["if",["=","in_scope",1],["begin",["if",["if",["bytes.eq","kind",["bytes.lit","flag"]],1,["if",["bytes.eq","kind",["bytes.lit","opt"]],1,["if",["bytes.eq","kind",["bytes.lit","help"]],1,["if",["bytes.eq","kind",["bytes.lit","version"]],1,0]]]],["begin",["let","long_off",["ext.data_model.seq_get","docv","row_off",3]],["let","long",["ext.data_model.string_get","docv","long_off"]],["if",["view.eq","name",["bytes.view","long"]],["begin",["set","found_row","row_off"],["set","found_kind","kind"],0],0],0],0],0],0],0],0],0]],["if",["<","found_row",0],["return",["ext.cli._err_v1",1002,["bytes.lit","unknown_option"],"usage"]],0],["if",["if",[">=","eq_pos",0],1,0],["if",["bytes.eq","found_kind",["bytes.lit","opt"]],0,["return",["ext.cli._err_v1",1002,["bytes.lit","unexpected_value"],"usage"]]],0],["if",["bytes.eq","found_kind",["bytes.lit","opt"]],["begin",["let","key_off",["ext.data_model.seq_get","docv","found_row",4]],["let","key",["ext.data_model.string_get","docv","key_off"]],["let","row_len",["ext.data_model.seq_len","docv","found_row"]],["let","is_multi",["if",[">=","row_len",8],["begin",["let","meta_off",["ext.data_model.seq_get","docv","found_row",7]],["let","m_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","multiple_key"]]],["if",["<","m_off",0],0,["ext.data_model.bool_get","docv","m_off"]]],0]],["let","val",["if",[">=","eq_pos",0],"inline_val",["begin",["if",["<",["std.text.slices.count_v1","tok_idx"],["+","ti",2]],["return",["ext.cli._err_v1",1002,["bytes.lit","missing_value"],"usage"]],0],["let","start",["std.text.slices.start_v1","tok_idx",["+","ti",1]]],["let","len",["std.text.slices.len_v1","tok_idx",["+","ti",1]]],["set","consumed",1],["view.slice","argv_v1","start","len"]]]],["if",["=","is_multi",1],["begin",["let","mv",["vec_u8.with_capacity",0]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le",1]]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le",["view.len","val"]]]],["set","mv",["vec_u8.extend_bytes","mv","val"]],["let","mb",["std.vec.as_bytes","mv"]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","key"]]]],["set","payload",["vec_u8.extend_bytes","payload","key"]],["set","payload",["vec_u8.push","payload",4]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","mb"]]]],["set","payload",["vec_u8.extend_bytes","payload","mb"]],0],["begin",["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","key"]]]],["set","payload",["vec_u8.extend_bytes","payload","key"]],["set","payload",["vec_u8.push","payload",2]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["view.len","val"]]]],["set","payload",["vec_u8.extend_bytes","payload","val"]],0]],0],["begin",["let","k",["if",["bytes.eq","found_kind",["bytes.lit","help"]],["bytes.lit","help"],["if",["bytes.eq","found_kind",["bytes.lit","version"]],["bytes.lit","version"],["begin",["let","key_off",["ext.data_model.seq_get","docv","found_row",4]],["ext.data_model.string_get","docv","key_off"]]]]],["let","inc",["bytes.alloc",1]],["set","inc",["bytes.set_u8","inc",0,1]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","k"]]]],["set","payload",["vec_u8.extend_bytes","payload","k"]],["set","payload",["vec_u8.push","payload",1]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",1]]],["set","payload",["vec_u8.extend_bytes","payload",["bytes.view","inc"]]],0]],0],["let","out",["vec_u8.with_capacity",["+",2,["vec_u8.len","payload"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.push","out","consumed"]],["set","out",["vec_u8.extend_bytes","out",["std.vec.as_bytes","payload"]]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._parse_one_option_long","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"},{"name":"scope","ty":"bytes_view"},{"name":"tok","ty":"bytes_view"},{"name":"argv_v1","ty":"bytes_view"},{"name":"tok_idx","ty":"bytes_view"},{"name":"ti","ty":"i32"},{"name":"usage","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","r"]],["if",["<u","n",2],["return","ti"],0],["+","ti",["view.get_u8","r",1]]],"kind":"defn","name":"ext.cli._parse_one_option_next_i","params":[{"name":"r","ty":"bytes_view"},{"name":"ti","ty":"i32"}],"result":"i32"},{"body":["begin",["let","tok_len",["view.len","tok"]],["let","consumed",0],["let","payload",["vec_u8.with_capacity",0]],["let","root",["bytes.lit","root"]],["let","global_key",["bytes.lit","global"]],["let","multiple_key",["bytes.lit","multiple"]],["begin",["let","body",["view.slice","tok",1,["-","tok_len",1]]],["let","body_len",["view.len","body"]],["let","rows_count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","rows_count",0],["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_spec"],"usage"]],0],0,["for","j",0,"body_len",["begin",["if",[">=u","j","body_len"],0,0],0,["let","c",["view.get_u8","body","j"]],["let","sb",["vec_u8.with_capacity",2]],["set","sb",["vec_u8.push","sb",45]],["set","sb",["vec_u8.push","sb","c"]],["let","s",["std.vec.as_bytes","sb"]],["let","found_row",-1],["let","found_kind",["bytes.alloc",0]],["for","i",0,"rows_count",["begin",["if",["=","found_row",-1],["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","row_scope",["ext.data_model.string_get","docv","scope_off"]],["let","kind_off",["ext.data_model.seq_get","docv","row_off",1]],["let","kind",["ext.data_model.string_get","docv","kind_off"]],["let","in_scope",["begin",["let","row_scope_v",["bytes.view","row_scope"]],["let","root_v",["bytes.view","root"]],["if",["view.eq","scope","row_scope_v"],1,["if",["view.eq","scope","root_v"],0,["if",["view.eq","root_v","row_scope_v"],["begin",["if",["bytes.eq","kind",["bytes.lit","flag"]],["begin",["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["if",[">=","row_len",7],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",6]],["let","g_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","global_key"]]],["if",["<","g_off",0],0,["ext.data_model.bool_get","docv","g_off"]]],0]],["if",["bytes.eq","kind",["bytes.lit","opt"]],["begin",["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["if",[">=","row_len",8],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",7]],["let","g_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","global_key"]]],["if",["<","g_off",0],0,["ext.data_model.bool_get","docv","g_off"]]],0]],0]]],0]]]]],["if",["=","in_scope",1],["begin",["if",["if",["bytes.eq","kind",["bytes.lit","flag"]],1,["if",["bytes.eq","kind",["bytes.lit","opt"]],1,["if",["bytes.eq","kind",["bytes.lit","help"]],1,["if",["bytes.eq","kind",["bytes.lit","version"]],1,0]]]],["begin",["let","short_off",["ext.data_model.seq_get","docv","row_off",2]],["let","short",["ext.data_model.string_get","docv","short_off"]],["if",["view.eq",["bytes.view","s"],["bytes.view","short"]],["begin",["set","found_row","row_off"],["set","found_kind","kind"],0],0],0],0],0],0],0],0],0]],["if",["<","found_row",0],["return",["ext.cli._err_v1",1002,["bytes.lit","unknown_option"],"usage"]],0],["if",["bytes.eq","found_kind",["bytes.lit","opt"]],["begin",["let","key_off",["ext.data_model.seq_get","docv","found_row",4]],["let","key",["ext.data_model.string_get","docv","key_off"]],["let","row_len",["ext.data_model.seq_len","docv","found_row"]],["let","is_multi",["if",[">=","row_len",8],["begin",["let","meta_off",["ext.data_model.seq_get","docv","found_row",7]],["let","m_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","multiple_key"]]],["if",["<","m_off",0],0,["ext.data_model.bool_get","docv","m_off"]]],0]],["let","val",["if",["<u",["+","j",1],"body_len"],["view.slice","body",["+","j",1],["-","body_len",["+","j",1]]],["begin",["if",["<",["std.text.slices.count_v1","tok_idx"],["+","ti",2]],["return",["ext.cli._err_v1",1002,["bytes.lit","missing_value"],"usage"]],0],["let","start",["std.text.slices.start_v1","tok_idx",["+","ti",1]]],["let","len",["std.text.slices.len_v1","tok_idx",["+","ti",1]]],["set","consumed",1],["view.slice","argv_v1","start","len"]]]],["if",["=","is_multi",1],["begin",["let","mv",["vec_u8.with_capacity",0]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le",1]]],["set","mv",["vec_u8.extend_bytes","mv",["codec.write_u32_le",["view.len","val"]]]],["set","mv",["vec_u8.extend_bytes","mv","val"]],["let","mb",["std.vec.as_bytes","mv"]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","key"]]]],["set","payload",["vec_u8.extend_bytes","payload","key"]],["set","payload",["vec_u8.push","payload",4]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","mb"]]]],["set","payload",["vec_u8.extend_bytes","payload","mb"]],0],["begin",["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","key"]]]],["set","payload",["vec_u8.extend_bytes","payload","key"]],["set","payload",["vec_u8.push","payload",2]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["view.len","val"]]]],["set","payload",["vec_u8.extend_bytes","payload","val"]],0]],["set","j","body_len"],0],["begin",["let","k",["if",["bytes.eq","found_kind",["bytes.lit","help"]],["bytes.lit","help"],["if",["bytes.eq","found_kind",["bytes.lit","version"]],["bytes.lit","version"],["begin",["let","key_off",["ext.data_model.seq_get","docv","found_row",4]],["ext.data_model.string_get","docv","key_off"]]]]],["let","inc",["bytes.alloc",1]],["set","inc",["bytes.set_u8","inc",0,1]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","k"]]]],["set","payload",["vec_u8.extend_bytes","payload","k"]],["set","payload",["vec_u8.push","payload",1]],["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",1]]],["set","payload",["vec_u8.extend_bytes","payload",["bytes.view","inc"]]],0,0]]]],0],["let","out",["vec_u8.with_capacity",["+",2,["vec_u8.len","payload"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.push","out","consumed"]],["set","out",["vec_u8.extend_bytes","out",["std.vec.as_bytes","payload"]]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._parse_one_option_short_bundle","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"},{"name":"scope","ty":"bytes_view"},{"name":"tok","ty":"bytes_view"},{"name":"argv_v1","ty":"bytes_view"},{"name":"tok_idx","ty":"bytes_view"},{"name":"ti","ty":"i32"},{"name":"usage","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","docv","spec_json"],["if",["<u",["view.len","docv"],1],["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_specbin"],["bytes.alloc",0]]],0],["if",["=",["view.get_u8","docv",0],1],0,["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_specbin"],["bytes.alloc",0]]]],["let","rows_key",["bytes.lit","rows"]],["let","app_key",["bytes.lit","app"]],["let","name_key",["bytes.lit","name"]],["let","rows_off",["ext.data_model.map_find","docv",1,["bytes.view","rows_key"]]],["if",["<","rows_off",0],["return",["ext.cli._err_v1",1001,["bytes.lit","missing_rows"],["bytes.alloc",0]]],0],["let","app_off",["ext.data_model.map_find","docv",1,["bytes.view","app_key"]]],["let","app_name",["if",["<","app_off",0],["bytes.lit","app"],["begin",["let","name_off",["ext.data_model.map_find","docv","app_off",["bytes.view","name_key"]]],["if",["<","name_off",0],["bytes.lit","app"],["ext.data_model.string_get","docv","name_off"]]]]],["let","scope",["bytes.lit","root"]],["let","cmd",["bytes.lit","root"]],["let","entries",["bytes.alloc",0]],["let","argc_res",["ext.cli._argv_count","argv_v1"]],["if",["<","argc_res",0],["return",["ext.cli._err_v1",1002,["bytes.lit","invalid_argv_v1"],["bytes.alloc",0]]],0],["let","tok_idx",["ext.cli._argv_index","argv_v1"]],["if",["if",["=","argc_res",0],0,["=",["bytes.len","tok_idx"],0]],["return",["ext.cli._err_v1",1002,["bytes.lit","invalid_argv_v1"],["bytes.alloc",0]]],0],["let","tok_idx_v",["bytes.view","tok_idx"]],["let","root_pos",["std.text.slices.builder_new_v1","argc_res"]],["let","cmd_pos",["std.text.slices.builder_new_v1","argc_res"]],["let","root_pos_count",0],["let","cmd_pos_count",0],["let","opt_mode",1],["let","subcmd_selected",0],["let","subcmds",["ext.cli._collect_subcommands","docv","rows_off"]],["let","subcmds_v",["bytes.view","subcmds"]],["let","root_const",["bytes.lit","root"]],["let","dashdash",["bytes.lit","--"]],["for","ti",0,"argc_res",["begin",["let","start",["std.text.slices.start_v1","tok_idx_v","ti"]],["let","len",["std.text.slices.len_v1","tok_idx_v","ti"]],["let","tok",["view.slice","argv_v1","start","len"]],["let","is_argv0",["if",["=","ti",0],["view.eq","tok",["bytes.view","app_name"]],0]],["if",["=","is_argv0",1],0,["begin",["let","is_delim",["if",["=","opt_mode",1],["view.eq","tok",["bytes.view","dashdash"]],0]],["if",["=","is_delim",1],["begin",["set","opt_mode",0],0],["if",["if",["=","opt_mode",1],["ext.cli._is_option_token","tok"],0],["begin",["let","r",["ext.cli._parse_one_option","docv","rows_off",["bytes.view","app_name"],["bytes.view","scope"],"tok","argv_v1","tok_idx_v","ti"]],["if",["=",["view.get_u8",["bytes.view","r"],0],0],["return","r"],0],["let","next_ti",["ext.cli._parse_one_option_next_i",["bytes.view","r"],"ti"]],["set","entries",["ext.cli._match_map_merge","entries","r"]],["set","ti","next_ti"],0],["begin",["if",["if",["=","subcmd_selected",0],["ext.cli._subcmd_contains","subcmds_v","tok"],0],["begin",["set","scope",["view.to_bytes","tok"]],["set","cmd","scope"],["set","subcmd_selected",1],0],["begin",["if",["=","subcmd_selected",0],["begin",["set","root_pos",["std.text.slices.builder_push_v1","root_pos","start","len"]],["set","root_pos_count",["+","root_pos_count",1]],0],["begin",["set","cmd_pos",["std.text.slices.builder_push_v1","cmd_pos","start","len"]],["set","cmd_pos_count",["+","cmd_pos_count",1]],0]]]]]]],0]],0]],["let","usage",["ext.cli._usage_short","docv","rows_off",["bytes.view","app_name"],["bytes.view","cmd"]]],["let","root_pos_b",["std.text.slices.builder_finish_v1","root_pos","root_pos_count"]],["let","cmd_pos_b",["std.text.slices.builder_finish_v1","cmd_pos","cmd_pos_count"]],["let","entries2",["ext.cli._bind_args","docv","rows_off",["bytes.view","root_const"],"argv_v1",["bytes.view","root_pos_b"],"root_pos_count","entries",["bytes.view","usage"]]],["if",["if",["<u",["bytes.len","entries2"],1],0,["=",["view.get_u8",["bytes.view","entries2"],0],0]],["return","entries2"],0],["set","entries","entries2"],["if",["=","subcmd_selected",1],["begin",["let","entries3",["ext.cli._bind_args","docv","rows_off",["bytes.view","cmd"],"argv_v1",["bytes.view","cmd_pos_b"],"cmd_pos_count","entries",["bytes.view","usage"]]],["if",["if",["<u",["bytes.len","entries3"],1],0,["=",["view.get_u8",["bytes.view","entries3"],0],0]],["return","entries3"],0],["set","entries","entries3"],0],0],["ext.cli._matches_v1",["bytes.view","cmd"],"entries"]],"kind":"defn","name":"ext.cli._parse_specbin_and_argv_v1","params":[{"name":"spec_json","ty":"bytes_view"},{"name":"argv_v1","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","subcmds"]],["if",["<u","n",4],["return",0],0],["let","count",["codec.read_u32_le","subcmds",0]],["let","tok_len",["view.len","tok"]],["let","off",4],["for","_",0,"count",["begin",["if",["<u","n",["+","off",4]],["return",0],0],["let","len",["codec.read_u32_le","subcmds","off"]],["let","start",["+","off",4]],["if",["if",["=","len","tok_len"],["=",["bytes.cmp_range","tok",0,"tok_len","subcmds","start","len"],0],0],["return",1],0],["set","off",["+","start","len"]],0]],0],"kind":"defn","name":"ext.cli._subcmd_contains","params":[{"name":"subcmds","ty":"bytes_view"},{"name":"tok","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","count",["ext.data_model.seq_len","docv","rows_off"]],["if",["<","count",0],["return",["bytes.alloc",0]],0],["let","has_opts",0],["let","arg_part",["vec_u8.with_capacity",0]],["let","root",["bytes.lit","root"]],["let","multiple_key",["bytes.lit","multiple"]],["for","i",0,"count",["begin",["let","row_off",["ext.data_model.seq_get","docv","rows_off","i"]],["let","scope_off",["ext.data_model.seq_get","docv","row_off",0]],["let","scope",["ext.data_model.string_get","docv","scope_off"]],["if",["view.eq","cmd",["bytes.view","scope"]],["begin",["let","kind_off",["ext.data_model.seq_get","docv","row_off",1]],["let","kind",["ext.data_model.string_get","docv","kind_off"]],["if",["bytes.eq","kind",["bytes.lit","arg"]],["begin",["let","pos_off",["ext.data_model.seq_get","docv","row_off",2]],["let","pos",["ext.data_model.string_get","docv","pos_off"]],["set","arg_part",["vec_u8.push","arg_part",32]],["set","arg_part",["vec_u8.push","arg_part",60]],["set","arg_part",["vec_u8.extend_bytes","arg_part","pos"]],["let","row_len",["ext.data_model.seq_len","docv","row_off"]],["let","is_multi",["if",[">=","row_len",6],["begin",["let","meta_off",["ext.data_model.seq_get","docv","row_off",5]],["let","m_off",["ext.data_model.map_find","docv","meta_off",["bytes.view","multiple_key"]]],["if",["<","m_off",0],0,["ext.data_model.bool_get","docv","m_off"]]],0]],["if",["=","is_multi",1],["begin",["set","arg_part",["vec_u8.push","arg_part",46]],["set","arg_part",["vec_u8.push","arg_part",46]],["set","arg_part",["vec_u8.push","arg_part",46]],0],0],["set","arg_part",["vec_u8.push","arg_part",62]],0],["if",["bytes.eq","kind",["bytes.lit","flag"]],["set","has_opts",1],["if",["bytes.eq","kind",["bytes.lit","opt"]],["set","has_opts",1],["if",["bytes.eq","kind",["bytes.lit","help"]],["set","has_opts",1],["if",["bytes.eq","kind",["bytes.lit","version"]],["set","has_opts",1],0]]]]],0],0],0]],["let","out",["vec_u8.with_capacity",64]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","usage:"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","app_name"]],["if",["view.eq","cmd",["bytes.view","root"]],0,["begin",["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","cmd"]],0]],["if",["=","has_opts",1],["begin",["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","[OPTIONS]"]]],0],0],["set","out",["vec_u8.extend_bytes","out",["std.vec.as_bytes","arg_part"]]],["std.vec.as_bytes","out"]],"kind":"defn","name":"ext.cli._usage_short","params":[{"name":"docv","ty":"bytes_view"},{"name":"rows_off","ty":"i32"},{"name":"app_name","ty":"bytes_view"},{"name":"cmd","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["if",["<u",["view.len","doc"],5],1,["!=",["view.get_u8","doc",0],0]],["return",0],0],["codec.read_u32_le","doc",1]],"kind":"defn","name":"ext.cli.err_code","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<u","n",9],["return",["bytes.alloc",0]],0],["if",["!=",["view.get_u8","doc",0],0],["return",["bytes.alloc",0]],0],["let","msg_len",["codec.read_u32_le","doc",5]],["let","msg_start",9],["if",["<u","n",["+","msg_start","msg_len"]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc","msg_start","msg_len"]]],"kind":"defn","name":"ext.cli.err_msg","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<u","n",13],["return",["bytes.alloc",0]],0],["if",["!=",["view.get_u8","doc",0],0],["return",["bytes.alloc",0]],0],["let","msg_len",["codec.read_u32_le","doc",5]],["let","usage_len_off",["+",9,"msg_len"]],["if",["<u","n",["+","usage_len_off",4]],["return",["bytes.alloc",0]],0],["let","usage_len",["codec.read_u32_le","doc","usage_len_off"]],["let","usage_start",["+","usage_len_off",4]],["if",["<u","n",["+","usage_start","usage_len"]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc","usage_start","usage_len"]]],"kind":"defn","name":"ext.cli.err_usage","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["if",["<u",["view.len","doc"],1],0,["=",["view.get_u8","doc",0],1]],"kind":"defn","name":"ext.cli.is_ok","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<u","n",9],["return",["bytes.alloc",0]],0],["if",["!=",["view.get_u8","doc",0],1],["return",["bytes.alloc",0]],0],["let","cmd_len",["codec.read_u32_le","doc",1]],["let","cmd_start",5],["if",["<u","n",["+","cmd_start","cmd_len"]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc","cmd_start","cmd_len"]]],"kind":"defn","name":"ext.cli.matches_cmd","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["ext.cli.is_ok","doc"],0],["return",["option_bytes.none"]],0],["let","n",["view.len","doc"]],["if",["<u","n",9],["return",["option_bytes.none"]],0],["let","cmd_len",["codec.read_u32_le","doc",1]],["let","entries_off",["+",5,"cmd_len"]],["if",["<u","n",["+","entries_off",4]],["return",["option_bytes.none"]],0],["let","count",["codec.read_u32_le","doc","entries_off"]],["let","off",["+","entries_off",4]],["let","key_len",["view.len","key"]],["for","_",0,"count",["begin",["if",["<u","n",["+","off",9]],["return",["option_bytes.none"]],0],["let","klen",["codec.read_u32_le","doc","off"]],["let","kstart",["+","off",4]],["let","kind_pos",["+","kstart","klen"]],["let","vlen_off",["+","kind_pos",1]],["if",["<u","n",["+","vlen_off",4]],["return",["option_bytes.none"]],0],["let","vlen",["codec.read_u32_le","doc","vlen_off"]],["let","vstart",["+","vlen_off",4]],["let","next",["+","vstart","vlen"]],["if",["<u","n","next"],["return",["option_bytes.none"]],0],["let","cmp",["bytes.cmp_range","key",0,"key_len","doc","kstart","klen"]],["if",["=","cmp",0],["begin",["if",["=","kind",["view.get_u8","doc","kind_pos"]],["return",["option_bytes.some",["view.to_bytes",["view.slice","doc","vstart","vlen"]]]],["return",["option_bytes.none"]]]],0],["if",["<","cmp",0],["return",["option_bytes.none"]],0],["set","off","next"],0]],["option_bytes.none"]],"kind":"defn","name":"ext.cli.matches_get","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"},{"name":"kind","ty":"i32"}],"result":"option_bytes"},{"body":["ext.cli._parse_specbin_and_argv_v1",["bytes.view","specbin_v1"],["bytes.view","argv_v1"]],"kind":"defn","name":"ext.cli.parse_compiled","params":[{"name":"specbin_v1","ty":"bytes"},{"name":"argv_v1","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","compiled",["ext.cli.specrows.compile","spec_json"]],["let","specbin",["result_bytes.unwrap_or","compiled",["bytes.alloc",0]]],["if",["=",["bytes.len","specbin"],0],["return",["ext.cli._err_v1",1001,["bytes.lit","invalid_spec"],["bytes.alloc",0]]],0],["ext.cli._parse_specbin_and_argv_v1",["bytes.view","specbin"],["bytes.view","argv_v1"]]],"kind":"defn","name":"ext.cli.parse_specrows","params":[{"name":"spec_json","ty":"bytes"},{"name":"argv_v1","ty":"bytes"}],"result":"bytes"}],"imports":["ext.cli.specrows","ext.data_model","std.bytes","std.small_set","std.text.slices","std.u32","std.vec"],"kind":"module","module_id":"ext.cli","schema_version":"x07.x07ast@0.3.0"}
