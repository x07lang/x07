{"decls":[{"kind":"export","names":["std.msg.tests.test_envelope_encode_decode_v1","std.msg.tests.test_rr_entry_stability_v1"]},{"body":["begin",["let","entries",["codec.write_u32_le",0]],["let","mv",["ext.data_model.value_map_from_entries",["bytes.view","entries"]]],["ext.data_model.doc_ok",["bytes.view","mv"]]],"kind":"defn","name":"std.msg.tests._empty_map_doc_v1","params":[],"result":"bytes"},{"body":["begin",["let","end",["ext.data_model.skip_value","doc","off"]],["if",["<","end",0],["return",["bytes.alloc",0]],0],["ext.data_model.doc_ok",["view.slice","doc","off",["-","end","off"]]]],"kind":"defn","name":"std.msg.tests._wrap_value_as_doc_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","cases_path",["bytes.lit","msg/envelope_cases.json"]],["let","cases_raw",["std.fs.read",["bytes.view","cases_path"]]],["let","cases_doc_b",["ext.json.data_model.parse",["bytes.view","cases_raw"]]],["let","cases_doc",["bytes.view","cases_doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","cases_doc"],0,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","cases_doc"]],["let","count",["ext.data_model.seq_len","cases_doc","root"]],["try",["std.test.assert_true",[">=","count",1],["std.test.code_assert_true"]]],["let","out",["std.vec.with_capacity",256]],["let","k_topic",["bytes.lit","topic"]],["let","k_key",["bytes.lit","key"]],["let","k_value",["bytes.lit","value"]],["let","k_headers",["bytes.lit","headers"]],["for","i",0,"count",["begin",["let","case_off",["ext.data_model.seq_get","cases_doc","root","i"]],["let","topic_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_topic"]]],["let","key_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_key"]]],["let","value_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_value"]]],["try",["std.test.assert_true",[">=","topic_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","key_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","value_off",0],["std.test.code_assert_true"]]],["let","topic_b",["ext.data_model.string_get","cases_doc","topic_off"]],["let","key_b",["ext.data_model.string_get","cases_doc","key_off"]],["let","value_b",["ext.data_model.string_get","cases_doc","value_off"]],["let","headers_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_headers"]]],["let","headers_doc_b",["if",["<","headers_off",0],["std.msg.tests._empty_map_doc_v1"],["std.msg.tests._wrap_value_as_doc_v1","cases_doc","headers_off"]]],["try",["std.test.assert_true",[">",["bytes.len","headers_doc_b"],0],["std.test.code_assert_true"]]],["let","enc",["std.msg.envelope.encode_v1",["bytes.view","topic_b"],["bytes.view","key_b"],["bytes.view","value_b"],["bytes.view","headers_doc_b"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","enc"],0,["std.test.code_assert_i32_eq"]]],["let","env_b",["result_bytes.unwrap_or","enc",["bytes.alloc",0]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","env_b"]]],["let","dec",["std.msg.envelope.decode_v1",["bytes.view","env_b"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","dec"],0,["std.test.code_assert_i32_eq"]]],["let","doc_b",["result_bytes.unwrap_or","dec",["bytes.alloc",0]]],["let","dv",["bytes.view","doc_b"]],["let","dr",["ext.data_model.root_offset","dv"]],["let","dt_off",["ext.data_model.map_find","dv","dr",["bytes.view","k_topic"]]],["let","dk_off",["ext.data_model.map_find","dv","dr",["bytes.view","k_key"]]],["let","dv_off",["ext.data_model.map_find","dv","dr",["bytes.view","k_value"]]],["try",["std.test.assert_true",[">=","dt_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","dk_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","dv_off",0],["std.test.code_assert_true"]]],["let","dt_b",["ext.data_model.string_get","dv","dt_off"]],["let","dk_b",["ext.data_model.string_get","dv","dk_off"]],["let","dv_b",["ext.data_model.string_get","dv","dv_off"]],["try",["std.test.assert_i32_eq",["std.bytes.eq",["bytes.view","dt_b"],["bytes.view","topic_b"]],1,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["std.bytes.eq",["bytes.view","dk_b"],["bytes.view","key_b"]],1,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["std.bytes.eq",["bytes.view","dv_b"],["bytes.view","value_b"]],1,["std.test.code_assert_i32_eq"]]],0]],["let","out_b",["std.vec.as_bytes","out"]],["let","golden_path",["bytes.lit","msg/envelope.golden.bin"]],["let","golden",["std.fs.read",["bytes.view","golden_path"]]],["try",["std.test.assert_bytes_eq","out_b","golden",["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.msg.tests.test_envelope_encode_decode_v1","params":[],"result":"result_i32"},{"body":["begin",["let","cases_path",["bytes.lit","rr/msg_rr_entry_cases.json"]],["let","cases_raw",["std.fs.read",["bytes.view","cases_path"]]],["let","cases_doc_b",["ext.json.data_model.parse",["bytes.view","cases_raw"]]],["let","cases_doc",["bytes.view","cases_doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","cases_doc"],0,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","cases_doc"]],["let","count",["ext.data_model.seq_len","cases_doc","root"]],["try",["std.test.assert_true",[">=","count",1],["std.test.code_assert_true"]]],["let","out",["std.vec.with_capacity",256]],["let","k_op_tag",["bytes.lit","op_tag"]],["let","k_driver_kind",["bytes.lit","driver_kind"]],["let","k_endpoint_hash",["bytes.lit","endpoint_hash"]],["let","k_ack_tag",["bytes.lit","ack_tag"]],["let","k_ack",["bytes.lit","ack"]],["let","k_topic",["bytes.lit","topic"]],["let","k_key",["bytes.lit","key"]],["let","k_value",["bytes.lit","value"]],["let","k_headers",["bytes.lit","headers"]],["for","i",0,"count",["begin",["let","case_off",["ext.data_model.seq_get","cases_doc","root","i"]],["let","op_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_op_tag"]]],["let","dk_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_driver_kind"]]],["let","eh_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_endpoint_hash"]]],["let","ack_tag_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_ack_tag"]]],["let","ack_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_ack"]]],["let","topic_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_topic"]]],["let","key_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_key"]]],["let","value_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_value"]]],["try",["std.test.assert_true",[">=","op_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","dk_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","eh_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","ack_tag_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","ack_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","topic_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","key_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_true",[">=","value_off",0],["std.test.code_assert_true"]]],["let","op_tag_b",["ext.data_model.number_get","cases_doc","op_off"]],["let","driver_kind_b",["ext.data_model.number_get","cases_doc","dk_off"]],["let","ack_tag_b",["ext.data_model.number_get","cases_doc","ack_tag_off"]],["let","op_tag",["std.parse.u32_dec",["bytes.view","op_tag_b"]]],["let","driver_kind",["std.parse.u32_dec",["bytes.view","driver_kind_b"]]],["let","ack_tag",["std.parse.u32_dec",["bytes.view","ack_tag_b"]]],["let","endpoint_hash_b",["ext.data_model.string_get","cases_doc","eh_off"]],["let","ack_b",["ext.data_model.string_get","cases_doc","ack_off"]],["let","topic_b",["ext.data_model.string_get","cases_doc","topic_off"]],["let","key_b",["ext.data_model.string_get","cases_doc","key_off"]],["let","value_b",["ext.data_model.string_get","cases_doc","value_off"]],["let","headers_off",["ext.data_model.map_find","cases_doc","case_off",["bytes.view","k_headers"]]],["let","headers_doc_b",["if",["<","headers_off",0],["std.msg.tests._empty_map_doc_v1"],["std.msg.tests._wrap_value_as_doc_v1","cases_doc","headers_off"]]],["try",["std.test.assert_true",[">",["bytes.len","headers_doc_b"],0],["std.test.code_assert_true"]]],["let","enc",["std.msg.envelope.encode_v1",["bytes.view","topic_b"],["bytes.view","key_b"],["bytes.view","value_b"],["bytes.view","headers_doc_b"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","enc"],0,["std.test.code_assert_i32_eq"]]],["let","env_b",["result_bytes.unwrap_or","enc",["bytes.alloc",0]]],["let","entry_res",["if",["=","op_tag",1],["std.msg.rr.record_publish_v1","driver_kind",["bytes.view","endpoint_hash_b"],["bytes.view","env_b"],"ack_tag",["bytes.view","ack_b"]],["std.msg.rr.record_deliver_v1","driver_kind",["bytes.view","endpoint_hash_b"],["bytes.view","env_b"],"ack_tag",["bytes.view","ack_b"]]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","entry_res"],0,["std.test.code_assert_i32_eq"]]],["let","entry_b",["result_bytes.unwrap_or","entry_res",["bytes.alloc",0]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","entry_b"]]],["let","parsed",["std.msg.rr.parse_v1",["bytes.view","entry_b"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","parsed"],0,["std.test.code_assert_i32_eq"]]],0]],["let","out_b",["std.vec.as_bytes","out"]],["let","golden_path",["bytes.lit","rr/msg_rr_entry.golden.bin"]],["let","golden",["std.fs.read",["bytes.view","golden_path"]]],["try",["std.test.assert_bytes_eq","out_b","golden",["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.msg.tests.test_rr_entry_stability_v1","params":[],"result":"result_i32"}],"imports":["ext.data_model","ext.json.data_model","std.bytes","std.fs","std.msg.envelope","std.msg.rr","std.parse","std.test","std.vec"],"kind":"module","module_id":"std.msg.tests","schema_version":"x07.x07ast@0.3.0"}
