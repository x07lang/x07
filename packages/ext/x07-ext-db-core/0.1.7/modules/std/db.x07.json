{"decls":[{"kind":"export","names":["std.db.close_v1","std.db.exec_rows_affected_v1","std.db.exec_v1","std.db.open_handle_v1","std.db.open_v1","std.db.query_rows_doc_v1","std.db.query_v1"]},{"body":["std.db.spec.resp_err_v1","op",30001,["bytes.alloc",0]],"kind":"defn","name":"std.db._err_not_implemented_v1","params":[{"name":"op","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","d",["std.db.spec.conn_driver_v1","conn"]],["if",["=","d",["std.db.spec.driver_sqlite_v1"]],["std.db.sqlite.close_v1","conn","caps"],["if",["=","d",["std.db.spec.driver_pg_v1"]],["begin",["let","caps_b",["view.to_bytes","caps"]],["std.db.pg.close_v1","conn","caps_b"]],["if",["=","d",["std.db.spec.driver_mysql_v1"]],["begin",["let","caps_b",["view.to_bytes","caps"]],["std.db.mysql.close_v1","conn","caps_b"]],["std.db._err_not_implemented_v1",["std.db.spec.op_close_v1"]]]]]],"kind":"defn","name":"std.db.close_v1","params":[{"name":"conn","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["std.db.spec.resp_is_ok_v1","resp"],0],["return",-1],0],0,["let","doc",["std.db.spec.resp_ok_payload_v1","resp"]],["std.db.dm.exec_doc_rows_affected_v1",["bytes.view","doc"]]],"kind":"defn","name":"std.db.exec_rows_affected_v1","params":[{"name":"resp","ty":"bytes"}],"result":"i32"},{"body":["begin",["let","d",["std.db.spec.conn_driver_v1","conn"]],["if",["=","d",["std.db.spec.driver_sqlite_v1"]],["std.db.sqlite.exec_v1","conn","sql","params_doc",["std.db.sqlite.spec.flags_none_v1"],"qcaps"],["if",["=","d",["std.db.spec.driver_pg_v1"]],["begin",["let","caps_b",["view.to_bytes","qcaps"]],["std.db.pg.exec_v1","conn","sql","params_doc",["std.db.pg.spec.flags_none_v1"],"caps_b"]],["if",["=","d",["std.db.spec.driver_mysql_v1"]],["begin",["let","caps_b",["view.to_bytes","qcaps"]],["std.db.mysql.exec_v1","conn","sql","params_doc",["std.db.mysql.spec.flags_none_v1"],"caps_b"]],["std.db._err_not_implemented_v1",["std.db.spec.op_exec_v1"]]]]]],"kind":"defn","name":"std.db.exec_v1","params":[{"name":"conn","ty":"i32"},{"name":"sql","ty":"bytes"},{"name":"params_doc","ty":"bytes"},{"name":"qcaps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["std.db.spec.resp_is_ok_v1","open_resp"],1],["codec.read_u32_le",["std.db.spec.resp_ok_payload_view_v1","open_resp"],0],-1]],"kind":"defn","name":"std.db.open_handle_v1","params":[{"name":"open_resp","ty":"bytes"}],"result":"i32"},{"body":["begin",["let","uri_b",["view.to_bytes","uri"]],["let","uri_v",["bytes.view","uri"]],["let","p_sqlite",["bytes.lit","sqlite:"]],["let","p_sqlite_v",["bytes.view","p_sqlite"]],["if",["=",["std.bytes.starts_with","uri_v","p_sqlite_v"],1],["std.db.sqlite.open_path_v1",["std.bytes.drop","uri_v",["view.len","p_sqlite_v"]],"caps"],["begin",["let","p_pg",["bytes.lit","postgres:"]],["if",["=",["std.bytes.starts_with","uri_v",["bytes.view","p_pg"]],1],["begin",["let","caps_b",["view.to_bytes","caps"]],["std.db.pg.open_v1","uri_b","caps_b"]],["begin",["let","p_pg2",["bytes.lit","postgresql:"]],["if",["=",["std.bytes.starts_with","uri_v",["bytes.view","p_pg2"]],1],["begin",["let","caps_b",["view.to_bytes","caps"]],["std.db.pg.open_v1","uri_b","caps_b"]],["begin",["let","p_my",["bytes.lit","mysql:"]],["if",["=",["std.bytes.starts_with","uri_v",["bytes.view","p_my"]],1],["begin",["let","caps_b",["view.to_bytes","caps"]],["std.db.mysql.open_v1","uri_b","caps_b"]],["std.db.sqlite.open_path_v1","uri_b","caps"]]]]]]]]],"kind":"defn","name":"std.db.open_v1","params":[{"name":"uri","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["std.db.spec.resp_is_ok_v1","resp"],1],["std.db.spec.resp_ok_payload_v1","resp"],["ext.data_model.doc_err_from_code",["std.db.spec.resp_err_code_v1","resp"]]]],"kind":"defn","name":"std.db.query_rows_doc_v1","params":[{"name":"resp","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","d",["std.db.spec.conn_driver_v1","conn"]],["if",["=","d",["std.db.spec.driver_sqlite_v1"]],["std.db.sqlite.query_v1","conn","sql","params_doc",["std.db.sqlite.spec.flags_none_v1"],"qcaps"],["if",["=","d",["std.db.spec.driver_pg_v1"]],["begin",["let","caps_b",["view.to_bytes","qcaps"]],["std.db.pg.query_v1","conn","sql","params_doc",["std.db.pg.spec.flags_none_v1"],"caps_b"]],["if",["=","d",["std.db.spec.driver_mysql_v1"]],["begin",["let","caps_b",["view.to_bytes","qcaps"]],["std.db.mysql.query_v1","conn","sql","params_doc",["std.db.mysql.spec.flags_none_v1"],"caps_b"]],["std.db._err_not_implemented_v1",["std.db.spec.op_query_v1"]]]]]],"kind":"defn","name":"std.db.query_v1","params":[{"name":"conn","ty":"i32"},{"name":"sql","ty":"bytes"},{"name":"params_doc","ty":"bytes"},{"name":"qcaps","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","std.bytes","std.codec","std.db.dm","std.db.mysql","std.db.mysql.spec","std.db.pg","std.db.pg.spec","std.db.spec","std.db.sqlite","std.db.sqlite.spec"],"kind":"module","module_id":"std.db","schema_version":"x07.x07ast@0.3.0"}
