{"decls":[{"kind":"export","names":["std.auth.jose_jws_v1.tests.test_alg_rejected_v1","std.auth.jose_jws_v1.tests.test_es256_ok_v1","std.auth.jose_jws_v1.tests.test_jwk_public_from_private_ok_v1","std.auth.jose_jws_v1.tests.test_jwk_thumbprint_ok_v1","std.auth.jose_jws_v1.tests.test_jws_sign_ed25519_ok_v1","std.auth.jose_jws_v1.tests.test_jws_sign_rs256_ok_v1","std.auth.jose_jws_v1.tests.test_rs256_ok_v1"]},{"body":["begin",["let","doc",["ext.json.data_model.parse","out_json"]],["let","dv",["bytes.view","doc"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","dv"],0,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","dv"],5,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","dv"]],["let","k_ok",["bytes.lit","ok"]],["let","ok_off",["ext.data_model.map_find","dv","root",["bytes.view","k_ok"]]],["try",["std.test.assert_true",[">=","ok_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_i32_eq",["ext.data_model.bool_get","dv","ok_off"],0,["std.test.code_assert_i32_eq"]]],["let","k_code",["bytes.lit","code"]],["let","code_off",["ext.data_model.map_find","dv","root",["bytes.view","k_code"]]],["try",["std.test.assert_true",[">=","code_off",0],["std.test.code_assert_true"]]],["let","code",["ext.data_model.string_get","dv","code_off"]],["try",["std.test.assert_bytes_eq","code",["bytes.lit","ERR_JWS_VERIFY"],["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests._assert_err_v1","params":[{"name":"out_json","ty":"bytes_view"}],"result":"result_i32"},{"body":["begin",["let","doc",["ext.json.data_model.parse","out_json"]],["let","dv",["bytes.view","doc"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","dv"],0,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","dv"],5,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","dv"]],["let","k_ok",["bytes.lit","ok"]],["let","ok_off",["ext.data_model.map_find","dv","root",["bytes.view","k_ok"]]],["try",["std.test.assert_true",[">=","ok_off",0],["std.test.code_assert_true"]]],["try",["std.test.assert_i32_eq",["ext.data_model.bool_get","dv","ok_off"],1,["std.test.code_assert_i32_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests._assert_ok_v1","params":[{"name":"out_json","ty":"bytes_view"}],"result":"result_i32"},{"body":["begin",["let","raw",["os.fs.read_file","path"]],["std.text.ascii.normalize_lines",["bytes.view","raw"]]],"kind":"defn","name":"std.auth.jose_jws_v1.tests._read_norm_text_v1","params":[{"name":"path","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","token",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/dpop_proof_valid.jwt"]]],["let","jwk",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_ec_p256_public.json"]]],["let","opts",["bytes.lit","{\"schema_version\":\"x07.jose.verify_opts@0.1.0\",\"accepted_algs\":[\"RS256\"],\"require_typ\":null}"]],["let","out_res",["std.auth.jose_jws_v1.jws_compact_verify_v1",["bytes.view","token"],["bytes.view","jwk"],["bytes.view","opts"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","out_res"],0,["std.test.code_assert_i32_eq"]]],["let","out",["result_bytes.unwrap_or","out_res",["bytes.alloc",0]]],["try",["std.auth.jose_jws_v1.tests._assert_err_v1",["bytes.view","out"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_alg_rejected_v1","params":[],"result":"result_i32"},{"body":["begin",["let","token",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/dpop_proof_valid.jwt"]]],["let","jwk",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_ec_p256_public.json"]]],["let","opts",["bytes.lit","{\"schema_version\":\"x07.jose.verify_opts@0.1.0\",\"accepted_algs\":[\"ES256\"],\"require_typ\":null}"]],["let","out_res",["std.auth.jose_jws_v1.jws_compact_verify_v1",["bytes.view","token"],["bytes.view","jwk"],["bytes.view","opts"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","out_res"],0,["std.test.code_assert_i32_eq"]]],["let","out",["result_bytes.unwrap_or","out_res",["bytes.alloc",0]]],["try",["std.auth.jose_jws_v1.tests._assert_ok_v1",["bytes.view","out"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_es256_ok_v1","params":[],"result":"result_i32"},{"body":["begin",["let","jwk_ed_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_ed25519_private.json"]]],["let","ed_pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_ed_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","ed_pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_ed_pub",["result_bytes.unwrap_or","ed_pub_res",["bytes.alloc",0]]],["let","doc",["ext.json.data_model.parse",["bytes.view","jwk_ed_pub"]]],["let","dv",["bytes.view","doc"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","dv"],0,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","dv"],5,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","dv"]],["let","k_d",["bytes.lit","d"]],["let","d_off",["ext.data_model.map_find","dv","root",["bytes.view","k_d"]]],["try",["std.test.assert_true",["<","d_off",0],["std.test.code_assert_true"]]],["let","k_kty",["bytes.lit","kty"]],["let","kty_off",["ext.data_model.map_find","dv","root",["bytes.view","k_kty"]]],["try",["std.test.assert_true",[">=","kty_off",0],["std.test.code_assert_true"]]],["let","kty",["ext.data_model.string_get","dv","kty_off"]],["try",["std.test.assert_bytes_eq","kty",["bytes.lit","OKP"],["std.test.code_assert_bytes_eq"]]],["let","k_crv",["bytes.lit","crv"]],["let","crv_off",["ext.data_model.map_find","dv","root",["bytes.view","k_crv"]]],["try",["std.test.assert_true",[">=","crv_off",0],["std.test.code_assert_true"]]],["let","crv",["ext.data_model.string_get","dv","crv_off"]],["try",["std.test.assert_bytes_eq","crv",["bytes.lit","Ed25519"],["std.test.code_assert_bytes_eq"]]],["let","k_x",["bytes.lit","x"]],["let","x_off",["ext.data_model.map_find","dv","root",["bytes.view","k_x"]]],["try",["std.test.assert_true",[">=","x_off",0],["std.test.code_assert_true"]]],["let","x",["ext.data_model.string_get","dv","x_off"]],["try",["std.test.assert_bytes_eq","x",["bytes.lit","A3WWp-lK4V561cvg97VV4VT0PskpQLPZDPpFk72qT88"],["std.test.code_assert_bytes_eq"]]],["let","jwk_rsa_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_rsa_private.json"]]],["let","rsa_pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_rsa_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","rsa_pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_rsa_pub",["result_bytes.unwrap_or","rsa_pub_res",["bytes.alloc",0]]],["let","doc2",["ext.json.data_model.parse",["bytes.view","jwk_rsa_pub"]]],["let","dv2",["bytes.view","doc2"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","dv2"],0,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","dv2"],5,["std.test.code_assert_i32_eq"]]],["let","root2",["ext.data_model.root_offset","dv2"]],["let","k_d2",["bytes.lit","d"]],["let","d2_off",["ext.data_model.map_find","dv2","root2",["bytes.view","k_d2"]]],["try",["std.test.assert_true",["<","d2_off",0],["std.test.code_assert_true"]]],["let","k_kty2",["bytes.lit","kty"]],["let","kty2_off",["ext.data_model.map_find","dv2","root2",["bytes.view","k_kty2"]]],["try",["std.test.assert_true",[">=","kty2_off",0],["std.test.code_assert_true"]]],["let","kty2",["ext.data_model.string_get","dv2","kty2_off"]],["try",["std.test.assert_bytes_eq","kty2",["bytes.lit","RSA"],["std.test.code_assert_bytes_eq"]]],["let","k_e",["bytes.lit","e"]],["let","e_off",["ext.data_model.map_find","dv2","root2",["bytes.view","k_e"]]],["try",["std.test.assert_true",[">=","e_off",0],["std.test.code_assert_true"]]],["let","e",["ext.data_model.string_get","dv2","e_off"]],["try",["std.test.assert_bytes_eq","e",["bytes.lit","AQAB"],["std.test.code_assert_bytes_eq"]]],["let","k_n",["bytes.lit","n"]],["let","n_off",["ext.data_model.map_find","dv2","root2",["bytes.view","k_n"]]],["try",["std.test.assert_true",[">=","n_off",0],["std.test.code_assert_true"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_jwk_public_from_private_ok_v1","params":[],"result":"result_i32"},{"body":["begin",["let","jwk_ed_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_ed25519_private.json"]]],["let","ed_pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_ed_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","ed_pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_ed_pub",["result_bytes.unwrap_or","ed_pub_res",["bytes.alloc",0]]],["let","ed_thumb_res",["std.auth.jose_jws_v1.jwk_thumbprint_sha256_b64u_v1",["bytes.view","jwk_ed_pub"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","ed_thumb_res"],0,["std.test.code_assert_i32_eq"]]],["let","ed_thumb",["result_bytes.unwrap_or","ed_thumb_res",["bytes.alloc",0]]],["try",["std.test.assert_bytes_eq","ed_thumb",["bytes.lit","HBezYLf-FkQpAT8hSgOVaRuSIB-pCfn5t1zRvMvYuTc"],["std.test.code_assert_bytes_eq"]]],["let","jwk_rsa_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_rsa_private.json"]]],["let","rsa_pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_rsa_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","rsa_pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_rsa_pub",["result_bytes.unwrap_or","rsa_pub_res",["bytes.alloc",0]]],["let","rsa_thumb_res",["std.auth.jose_jws_v1.jwk_thumbprint_sha256_b64u_v1",["bytes.view","jwk_rsa_pub"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","rsa_thumb_res"],0,["std.test.code_assert_i32_eq"]]],["let","rsa_thumb",["result_bytes.unwrap_or","rsa_thumb_res",["bytes.alloc",0]]],["try",["std.test.assert_bytes_eq","rsa_thumb",["bytes.lit","hkAGPITAvqf5M3iZGnbueP9rSgdGkTbo9oauiA__BP4"],["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_jwk_thumbprint_ok_v1","params":[],"result":"result_i32"},{"body":["begin",["let","jwk_ed_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_ed25519_private.json"]]],["let","header",["bytes.lit","{\"alg\":\"Ed25519\",\"kid\":\"test-ed25519-sign-1\"}"]],["let","payload",["bytes.lit","{\"a\":1}"]],["let","sign_res",["std.auth.jose_jws_v1.jws_compact_sign_v1",["bytes.view","header"],["bytes.view","payload"],["bytes.view","jwk_ed_priv"],["bytes.view_lit","{}"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","sign_res"],0,["std.test.code_assert_i32_eq"]]],["let","token",["result_bytes.unwrap_or","sign_res",["bytes.alloc",0]]],["let","pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_ed_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_ed_pub",["result_bytes.unwrap_or","pub_res",["bytes.alloc",0]]],["let","opts",["bytes.lit","{\"schema_version\":\"x07.jose.verify_opts@0.1.0\",\"accepted_algs\":[\"Ed25519\"],\"require_typ\":null}"]],["let","out_res",["std.auth.jose_jws_v1.jws_compact_verify_v1",["bytes.view","token"],["bytes.view","jwk_ed_pub"],["bytes.view","opts"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","out_res"],0,["std.test.code_assert_i32_eq"]]],["let","out",["result_bytes.unwrap_or","out_res",["bytes.alloc",0]]],["try",["std.auth.jose_jws_v1.tests._assert_ok_v1",["bytes.view","out"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_jws_sign_ed25519_ok_v1","params":[],"result":"result_i32"},{"body":["begin",["let","jwk_rsa_priv",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_rsa_private.json"]]],["let","header",["bytes.lit","{\"alg\":\"RS256\",\"kid\":\"test-rsa-sign-1\"}"]],["let","payload",["bytes.lit","{\"sub\":\"u\"}"]],["let","sign_res",["std.auth.jose_jws_v1.jws_compact_sign_v1",["bytes.view","header"],["bytes.view","payload"],["bytes.view","jwk_rsa_priv"],["bytes.view_lit","{}"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","sign_res"],0,["std.test.code_assert_i32_eq"]]],["let","token",["result_bytes.unwrap_or","sign_res",["bytes.alloc",0]]],["let","pub_res",["std.auth.jose_jws_v1.jwk_public_from_private_v1",["bytes.view","jwk_rsa_priv"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","pub_res"],0,["std.test.code_assert_i32_eq"]]],["let","jwk_rsa_pub",["result_bytes.unwrap_or","pub_res",["bytes.alloc",0]]],["let","opts",["bytes.lit","{\"schema_version\":\"x07.jose.verify_opts@0.1.0\",\"accepted_algs\":[\"RS256\"],\"require_typ\":null}"]],["let","out_res",["std.auth.jose_jws_v1.jws_compact_verify_v1",["bytes.view","token"],["bytes.view","jwk_rsa_pub"],["bytes.view","opts"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","out_res"],0,["std.test.code_assert_i32_eq"]]],["let","out",["result_bytes.unwrap_or","out_res",["bytes.alloc",0]]],["try",["std.auth.jose_jws_v1.tests._assert_ok_v1",["bytes.view","out"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_jws_sign_rs256_ok_v1","params":[],"result":"result_i32"},{"body":["begin",["let","token",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/access_token_rs256_valid.jwt"]]],["let","jwk",["std.auth.jose_jws_v1.tests._read_norm_text_v1",["bytes.lit","packages/ext/x07-ext-auth-jwt/0.1.4/tests/fixtures/jws/jwk_rsa_public.json"]]],["let","opts",["bytes.lit","{\"schema_version\":\"x07.jose.verify_opts@0.1.0\",\"accepted_algs\":[\"RS256\"],\"require_typ\":null}"]],["let","out_res",["std.auth.jose_jws_v1.jws_compact_verify_v1",["bytes.view","token"],["bytes.view","jwk"],["bytes.view","opts"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","out_res"],0,["std.test.code_assert_i32_eq"]]],["let","out",["result_bytes.unwrap_or","out_res",["bytes.alloc",0]]],["try",["std.auth.jose_jws_v1.tests._assert_ok_v1",["bytes.view","out"]]],["std.test.pass"]],"kind":"defn","name":"std.auth.jose_jws_v1.tests.test_rs256_ok_v1","params":[],"result":"result_i32"}],"imports":["ext.data_model","ext.json.data_model","std.auth.jose_jws_v1","std.test","std.text.ascii"],"kind":"module","module_id":"std.auth.jose_jws_v1.tests","schema_version":"x07.x07ast@0.3.0"}
