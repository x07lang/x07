{"decls":[{"kind":"export","names":["std.msg.amqp.rr.handle_doc_v1","std.msg.amqp.rr.max_body_bytes_v1","std.msg.amqp.rr.max_poll_items_v1","std.msg.amqp.rr.record_deliver_v1","std.msg.amqp.rr.record_publish_v1","std.msg.amqp.rr.replay_driver_v1"]},{"body":["begin",["let","off",["ext.data_model.map_find","doc","root","k"]],["if",["<","off",0],["return",-1],0],["let","n_b",["ext.data_model.number_get","doc","off"]],["std.parse.u32_dec",["bytes.view","n_b"]]],"kind":"defn","name":"std.msg.amqp.rr._get_num_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"root","ty":"i32"},{"name":"k","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","k_err",["bytes.lit","err"]],["let","k_key",["bytes.lit","key"]],["let","k_kind",["bytes.lit","kind"]],["let","k_op",["bytes.lit","op"]],["let","k_req",["bytes.lit","req"]],["let","k_resp",["bytes.lit","resp"]],["let","kind",["bytes.lit","rr"]],["let","err_s",["std.fmt.s32_to_dec","err"]],["let","v_err",["ext.data_model.value_number",["bytes.view","err_s"]]],["let","v_key",["ext.data_model.value_string","key"]],["let","v_kind",["ext.data_model.value_string",["bytes.view","kind"]]],["let","v_op",["ext.data_model.value_string","op"]],["let","v_req",["ext.data_model.value_string","req"]],["let","v_resp",["ext.data_model.value_string","resp"]],["let","entries",["std.vec.with_capacity",256]],["set","entries",["std.u32.push_le","entries",6]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_err"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_err"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_err"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_err"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_key"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_key"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_key"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_key"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_kind"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_kind"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_kind"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_kind"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_op"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_op"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_req"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_req"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_req"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_req"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_resp"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_resp"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_resp"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_resp"]]],["let","entries_b",["std.vec.as_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["if",["=",["bytes.len","map_val"],0],["return",["bytes.alloc",0]],0],["ext.data_model.doc_ok",["bytes.view","map_val"]]],"kind":"defn","name":"std.msg.amqp.rr._rr_entry_v1","params":[{"name":"op","ty":"bytes_view"},{"name":"key","ty":"bytes_view"},{"name":"req","ty":"bytes_view"},{"name":"resp","ty":"bytes_view"},{"name":"err","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","k_driver_kind",["bytes.lit","driver_kind"]],["let","k_endpoint_hash",["bytes.lit","endpoint_hash"]],["let","k_publish_op",["bytes.lit","publish_op"]],["let","k_poll_op",["bytes.lit","poll_op"]],["let","k_max_body_bytes",["bytes.lit","max_body_bytes"]],["let","k_prefetch_count",["bytes.lit","prefetch_count"]],["let","k_max_poll_items",["bytes.lit","max_poll_items"]],["let","publish_op",["bytes.lit","std.msg.amqp.publish_env_v1"]],["let","poll_op",["bytes.lit","std.msg.amqp.consume_env_v1"]],["let","driver_s",["std.fmt.s32_to_dec",2]],["let","v_driver_kind",["ext.data_model.value_number",["bytes.view","driver_s"]]],["let","v_endpoint_hash",["ext.data_model.value_string","endpoint_hash"]],["let","v_publish_op",["ext.data_model.value_string",["bytes.view","publish_op"]]],["let","v_poll_op",["ext.data_model.value_string",["bytes.view","poll_op"]]],["let","mb_s",["std.fmt.s32_to_dec","max_body_bytes"]],["let","pc_s",["std.fmt.s32_to_dec","prefetch_count"]],["let","mpi_s",["std.fmt.s32_to_dec","max_poll_items"]],["let","v_max_body_bytes",["ext.data_model.value_number",["bytes.view","mb_s"]]],["let","v_prefetch_count",["ext.data_model.value_number",["bytes.view","pc_s"]]],["let","v_max_poll_items",["ext.data_model.value_number",["bytes.view","mpi_s"]]],["let","entries",["std.vec.with_capacity",256]],["set","entries",["std.u32.push_le","entries",7]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_driver_kind"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_driver_kind"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_driver_kind"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_driver_kind"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_endpoint_hash"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_endpoint_hash"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_endpoint_hash"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_endpoint_hash"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_max_body_bytes"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_max_body_bytes"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_max_body_bytes"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_max_body_bytes"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_max_poll_items"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_max_poll_items"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_max_poll_items"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_max_poll_items"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_poll_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_poll_op"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_poll_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_poll_op"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_prefetch_count"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_prefetch_count"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_prefetch_count"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_prefetch_count"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","k_publish_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","k_publish_op"]]],["set","entries",["std.u32.push_le","entries",["bytes.len","v_publish_op"]]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","v_publish_op"]]],["let","entries_b",["std.vec.as_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["if",["=",["bytes.len","map_val"],0],["return",["bytes.alloc",0]],0],["ext.data_model.doc_ok",["bytes.view","map_val"]]],"kind":"defn","name":"std.msg.amqp.rr.handle_doc_v1","params":[{"name":"endpoint_hash","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"},{"name":"prefetch_count","ty":"i32"},{"name":"max_poll_items","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=",["ext.data_model.doc_is_err","handle_doc"],1],["return",-1],0],["let","root",["ext.data_model.root_offset","handle_doc"]],["let","k",["bytes.lit","max_body_bytes"]],["std.msg.amqp.rr._get_num_v1","handle_doc","root",["bytes.view","k"]]],"kind":"defn","name":"std.msg.amqp.rr.max_body_bytes_v1","params":[{"name":"handle_doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["ext.data_model.doc_is_err","handle_doc"],1],["return",-1],0],["let","root",["ext.data_model.root_offset","handle_doc"]],["let","k",["bytes.lit","max_poll_items"]],["std.msg.amqp.rr._get_num_v1","handle_doc","root",["bytes.view","k"]]],"kind":"defn","name":"std.msg.amqp.rr.max_poll_items_v1","params":[{"name":"handle_doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","op",["bytes.lit","std.msg.amqp.consume_env_v1"]],["let","entry_res",["std.msg.rr.record_deliver_v1",2,"endpoint_hash","env","ack_tag","ack"]],["if",["!=",["result_bytes.err_code","entry_res"],0],["return","entry_res"],0],["let","entry",["result_bytes.unwrap_or","entry_res",["bytes.alloc",0]]],["let","rr_entry",["std.msg.amqp.rr._rr_entry_v1",["bytes.view","op"],"endpoint_hash","env",["bytes.view","entry"],0]],["if",["=",["bytes.len","rr_entry"],0],["return",["result_bytes.err",9831]],0],["result_bytes.ok","rr_entry"]],"kind":"defn","name":"std.msg.amqp.rr.record_deliver_v1","params":[{"name":"endpoint_hash","ty":"bytes_view"},{"name":"env","ty":"bytes_view"},{"name":"ack_tag","ty":"i32"},{"name":"ack","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","op",["bytes.lit","std.msg.amqp.publish_env_v1"]],["let","entry_res",["std.msg.rr.record_publish_v1",2,"endpoint_hash","env","ack_tag","ack"]],["if",["!=",["result_bytes.err_code","entry_res"],0],["return","entry_res"],0],["let","entry",["result_bytes.unwrap_or","entry_res",["bytes.alloc",0]]],["let","rr_entry",["std.msg.amqp.rr._rr_entry_v1",["bytes.view","op"],"endpoint_hash","env",["bytes.view","entry"],0]],["if",["=",["bytes.len","rr_entry"],0],["return",["result_bytes.err",9830]],0],["result_bytes.ok","rr_entry"]],"kind":"defn","name":"std.msg.amqp.rr.record_publish_v1","params":[{"name":"endpoint_hash","ty":"bytes_view"},{"name":"env","ty":"bytes_view"},{"name":"ack_tag","ty":"i32"},{"name":"ack","ty":"bytes_view"}],"result":"result_bytes"},{"body":["std.msg.amqp.rr.handle_doc_v1","endpoint_hash",1048576,100,100],"kind":"defn","name":"std.msg.amqp.rr.replay_driver_v1","params":[{"name":"endpoint_hash","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","std.bytes","std.fmt","std.msg.rr","std.parse","std.u32","std.vec"],"kind":"module","module_id":"std.msg.amqp.rr","schema_version":"x07.x07ast@0.3.0"}
