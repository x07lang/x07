{"decls":[{"kind":"export","names":["std.db.sqlite.pool.close_v1","std.db.sqlite.pool.exec0_async_v1","std.db.sqlite.pool.new_path_v1","std.db.sqlite.pool.query0_async_v1"]},{"body":["begin",["let","pool_v",["bytes.view","pool"]],["let","ch",["std.db.pool.chan_v1","pool_v"]],["let","n",["std.db.pool.max_conns_v1","pool_v"]],["for","i",0,"n",["begin",["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["std.db.sqlite.close_v1","conn","caps"],0]],["chan.bytes.close","ch"],["std.db.spec.resp_ok_v1",["std.db.spec.op_pool_close_v1"],["bytes.alloc",0]]],"kind":"defasync","name":"std.db.sqlite.pool.close_v1","params":[{"name":"pool","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","ch",["std.db.pool.chan_v1","pool"]],["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["let","resp",["std.db.sqlite.exec_v1","conn","sql",["std.db.params.empty_v1"],["std.db.sqlite.spec.flags_none_v1"],"caps"]],["chan.bytes.send","ch","tok"],"resp"],"kind":"defasync","name":"std.db.sqlite.pool.exec0_async_v1","params":[{"name":"pool","ty":"bytes_view"},{"name":"sql","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<=","max_conns",0],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_pool_new_v1"],30001,["bytes.alloc",0]]],0],["let","ch",["chan.bytes.new","max_conns"]],["let","opened",["vec_u8.with_capacity",["*","max_conns",4]]],["let","path_v",["bytes.view","path"]],["for","i",0,"max_conns",["begin",["let","open_resp",["std.db.sqlite.open_v1",["view.to_bytes","path_v"],"open_flags","caps"]],["if",["=",["std.db.spec.resp_is_ok_v1","open_resp"],1],["begin",["let","pl",["std.db.spec.resp_ok_payload_v1","open_resp"]],["let","conn",["codec.read_u32_le","pl",0]],["set","opened",["vec_u8.extend_bytes","opened",["codec.write_u32_le","conn"]]],["chan.bytes.send","ch",["std.db.pool.conn_token_v1","conn"]],0],["begin",["let","ob",["vec_u8.into_bytes","opened"]],["let","ob_v",["bytes.view","ob"]],["let","n",["/",["view.len","ob_v"],4]],["for","j",0,"n",["begin",["let","conn",["codec.read_u32_le","ob_v",["*","j",4]]],["std.db.sqlite.close_v1","conn","caps"],0]],["chan.bytes.close","ch"],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_pool_new_v1"],["std.db.spec.resp_err_code_v1","open_resp"],["std.db.spec.resp_err_msg_v1","open_resp"]]]]]]],["let","pool",["std.db.pool.pack_v1","ch","max_conns"]],["std.db.spec.resp_ok_v1",["std.db.spec.op_pool_new_v1"],"pool"]],"kind":"defasync","name":"std.db.sqlite.pool.new_path_v1","params":[{"name":"path","ty":"bytes"},{"name":"open_flags","ty":"i32"},{"name":"caps","ty":"bytes_view"},{"name":"max_conns","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","ch",["std.db.pool.chan_v1","pool"]],["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["let","resp",["std.db.sqlite.query_v1","conn","sql",["std.db.params.empty_v1"],["std.db.sqlite.spec.flags_none_v1"],"caps"]],["chan.bytes.send","ch","tok"],"resp"],"kind":"defasync","name":"std.db.sqlite.pool.query0_async_v1","params":[{"name":"pool","ty":"bytes_view"},{"name":"sql","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"}],"imports":["std.codec","std.db.params","std.db.pool","std.db.spec","std.db.sqlite","std.db.sqlite.spec"],"kind":"module","module_id":"std.db.sqlite.pool","schema_version":"x07.x07ast@0.1.0"}
