{"decls":[{"kind":"export","names":["std.db.mysql.pool._not_implemented_note_v1","std.db.mysql.pool.close_v1","std.db.mysql.pool.exec0_async_v1","std.db.mysql.pool.new_uri_v1","std.db.mysql.pool.query0_async_v1"]},{"body":["std.db.mysql._not_implemented_note_v1"],"kind":"defn","name":"std.db.mysql.pool._not_implemented_note_v1","params":[],"result":"bytes"},{"body":["begin",["let","caps_b",["view.to_bytes","caps"]],["let","pool_v",["bytes.view","pool"]],["let","ch",["std.db.pool.chan_v1","pool_v"]],["let","n",["std.db.pool.max_conns_v1","pool_v"]],["for","i",0,"n",["begin",["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["std.db.mysql.close_v1","conn","caps_b"],0]],["chan.bytes.close","ch"],["std.db.spec.resp_ok_v1",["std.db.spec.op_pool_close_v1"],["bytes.alloc",0]]],"kind":"defasync","name":"std.db.mysql.pool.close_v1","params":[{"name":"pool","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","caps_b",["view.to_bytes","caps"]],["let","ch",["std.db.pool.chan_v1","pool"]],["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["let","resp",["std.db.mysql.exec_v1","conn","sql",["std.db.params.empty_v1"],["std.db.mysql.spec.flags_none_v1"],"caps_b"]],["chan.bytes.send","ch","tok"],"resp"],"kind":"defasync","name":"std.db.mysql.pool.exec0_async_v1","params":[{"name":"pool","ty":"bytes_view"},{"name":"sql","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<=","max_conns",0],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_pool_new_v1"],30001,["bytes.alloc",0]]],0],["let","caps_b",["view.to_bytes","caps"]],["let","ch",["chan.bytes.new","max_conns"]],["let","opened",["vec_u8.with_capacity",["*","max_conns",4]]],["for","i",0,"max_conns",["begin",["let","open_resp",["std.db.mysql.open_v1","uri","caps_b"]],["if",["=",["std.db.spec.resp_is_ok_v1","open_resp"],1],["begin",["let","pl",["std.db.spec.resp_ok_payload_v1","open_resp"]],["let","conn",["codec.read_u32_le","pl",0]],["set","opened",["vec_u8.extend_bytes","opened",["codec.write_u32_le","conn"]]],["let","tok",["std.db.pool.conn_token_v1","conn"]],["chan.bytes.send","ch","tok"],0],["begin",["let","ob",["vec_u8.into_bytes","opened"]],["let","ob_v",["bytes.view","ob"]],["let","n",["/",["view.len","ob_v"],4]],["for","j",0,"n",["begin",["let","c",["codec.read_u32_le","ob_v",["*","j",4]]],["std.db.mysql.close_v1","c","caps_b"],0]],["chan.bytes.close","ch"],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_pool_new_v1"],["std.db.spec.resp_err_code_v1","open_resp"],["std.db.spec.resp_err_msg_v1","open_resp"]]]]],0]],["let","pool",["std.db.pool.pack_v1","ch","max_conns"]],["std.db.spec.resp_ok_v1",["std.db.spec.op_pool_new_v1"],"pool"]],"kind":"defasync","name":"std.db.mysql.pool.new_uri_v1","params":[{"name":"uri","ty":"bytes"},{"name":"caps","ty":"bytes_view"},{"name":"max_conns","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","caps_b",["view.to_bytes","caps"]],["let","ch",["std.db.pool.chan_v1","pool"]],["let","tok",["chan.bytes.recv","ch"]],["let","conn",["std.db.pool.conn_from_token_v1","tok"]],["let","resp",["std.db.mysql.query_v1","conn","sql",["std.db.params.empty_v1"],["std.db.mysql.spec.flags_none_v1"],"caps_b"]],["chan.bytes.send","ch","tok"],"resp"],"kind":"defasync","name":"std.db.mysql.pool.query0_async_v1","params":[{"name":"pool","ty":"bytes_view"},{"name":"sql","ty":"bytes"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"}],"imports":["std.codec","std.db.mysql","std.db.mysql.spec","std.db.params","std.db.pool","std.db.spec"],"kind":"module","module_id":"std.db.mysql.pool","schema_version":"x07.x07ast@0.3.0"}
