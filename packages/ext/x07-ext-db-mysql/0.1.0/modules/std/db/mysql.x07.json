{"decls":[{"kind":"export","names":["std.db.mysql._not_implemented_note_v1","std.db.mysql.caps_default_v1","std.db.mysql.close_v1","std.db.mysql.exec_v1","std.db.mysql.open_v1","std.db.mysql.query_v1"]},{"body":["bytes.lit","std.db.mysql_not_implemented_v0.1.0"],"kind":"defn","name":"std.db.mysql._not_implemented_note_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["view.len","s"]],["if",["<=","n",0],["return","default_port"],0],["let","port",0],["for","i",0,"n",["begin",["let","c",["view.get_u8","s","i"]],["if",["<u","c",48],["return",0],0],["if",[">u","c",57],["return",0],0],["set","port",["+",["*","port",10],["-","c",48]]],["if",[">","port",65535],["return",0],0],0]],["if",["<=","port",0],0,"port"]],"kind":"defn","name":"std.db.mysql._parse_port_dec_v1","params":[{"name":"s","ty":"bytes_view"},{"name":"default_port","ty":"i32"}],"result":"i32"},{"body":["std.db.mysql.spec.caps_default_v1"],"kind":"defn","name":"std.db.mysql.caps_default_v1","params":[],"result":"bytes"},{"body":["begin",["let","raw",["std.db.spec.conn_raw_v1","conn"]],["let","req",["std.db.mysql.spec.close_req_v1","raw"]],["os.db.mysql.close_v1","req","caps"]],"kind":"defn","name":"std.db.mysql.close_v1","params":[{"name":"conn","ty":"i32"},{"name":"caps","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","raw",["std.db.spec.conn_raw_v1","conn"]],["let","req",["std.db.mysql.spec.exec_req_v1","raw","sql","params_doc","flags"]],["os.db.mysql.exec_v1","req","caps"]],"kind":"defn","name":"std.db.mysql.exec_v1","params":[{"name":"conn","ty":"i32"},{"name":"sql","ty":"bytes"},{"name":"params_doc","ty":"bytes"},{"name":"flags","ty":"i32"},{"name":"caps","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","u",["bytes.view","uri"]],["let","p1",["bytes.lit","mysql:"]],["let","off0",0],["if",["=",["std.bytes.starts_with","u",["bytes.view","p1"]],1],["set","off0",["view.len",["bytes.view","p1"]]],0],["let","v",["view.slice","u","off0",["-",["view.len","u"],"off0"]]],["if",["if",[">=u",["view.len","v"],2],["if",["=",["view.get_u8","v",0],47],["=",["view.get_u8","v",1],47],0],0],["begin",["set","v",["view.slice","v",2,["-",["view.len","v"],2]]],0],0],["let","n",["view.len","v"]],["let","slash",["std.bytes.find_u8","v",47]],["let","qmark",["std.bytes.find_u8","v",63]],["let","hash",["std.bytes.find_u8","v",35]],["let","auth_end","n"],["if",["if",[">=","slash",0],["<u","slash","auth_end"],0],["set","auth_end","slash"],0],["if",["if",[">=","qmark",0],["<u","qmark","auth_end"],0],["set","auth_end","qmark"],0],["if",["if",[">=","hash",0],["<u","hash","auth_end"],0],["set","auth_end","hash"],0],["let","path_end","n"],["if",["if",[">=","qmark",0],["<u","qmark","path_end"],0],["set","path_end","qmark"],0],["if",["if",[">=","hash",0],["<u","hash","path_end"],0],["set","path_end","hash"],0],["let","authority",["view.slice","v",0,"auth_end"]],["let","at",["std.bytes.find_u8","authority",64]],["let","userinfo",["if",[">=","at",0],["view.slice","authority",0,"at"],["view.slice","authority",0,0]]],["let","hostport",["if",[">=","at",0],["view.slice","authority",["+","at",1],["-",["view.len","authority"],["+","at",1]]],"authority"]],["let","user",["bytes.alloc",0]],["let","pass",["bytes.alloc",0]],["if",[">u",["view.len","userinfo"],0],["begin",["let","cidx",["std.bytes.find_u8","userinfo",58]],["if",[">=","cidx",0],["begin",["set","user",["view.to_bytes",["view.slice","userinfo",0,"cidx"]]],["set","pass",["view.to_bytes",["view.slice","userinfo",["+","cidx",1],["-",["view.len","userinfo"],["+","cidx",1]]]]]],["set","user",["view.to_bytes","userinfo"]]],0],0],["let","host",["bytes.alloc",0]],["let","port",3306],["let","hp_len",["view.len","hostport"]],["if",["if",[">u","hp_len",0],["=",["view.get_u8","hostport",0],91],0],["begin",["let","rbr",["std.bytes.find_u8","hostport",93]],["if",["<","rbr",0],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_open_v1"],53250,["bytes.alloc",0]]],0],["set","host",["view.to_bytes",["view.slice","hostport",1,["-","rbr",1]]]],["if",["if",["<u",["+","rbr",1],"hp_len"],["=",["view.get_u8","hostport",["+","rbr",1]],58],0],["begin",["let","pv",["view.slice","hostport",["+","rbr",2],["-","hp_len",["+","rbr",2]]]],["set","port",["std.db.mysql._parse_port_dec_v1","pv",3306]],0],0]],["begin",["let","cidx",["std.bytes.find_u8","hostport",58]],["if",[">=","cidx",0],["begin",["set","host",["view.to_bytes",["view.slice","hostport",0,"cidx"]]],["let","pv",["view.slice","hostport",["+","cidx",1],["-","hp_len",["+","cidx",1]]]],["set","port",["std.db.mysql._parse_port_dec_v1","pv",3306]]],["begin",["set","host",["view.to_bytes","hostport"]],0]]]],["let","db",["bytes.alloc",0]],["if",["<u","auth_end","path_end"],["begin",["let","path",["view.slice","v","auth_end",["-","path_end","auth_end"]]],["if",["if",[">u",["view.len","path"],0],["=",["view.get_u8","path",0],47],0],["begin",["set","db",["view.to_bytes",["view.slice","path",1,["-",["view.len","path"],1]]]],0],0],0],0],["if",["=",["bytes.len","host"],0],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_open_v1"],53250,["bytes.alloc",0]]],0],["if",["=","port",0],["return",["std.db.spec.resp_err_v1",["std.db.spec.op_open_v1"],53250,["bytes.alloc",0]]],0],["let","req",["std.db.mysql.spec.open_req_v1","host","port","user","pass","db",["std.db.mysql.spec.flags_none_v1"]]],["let","resp",["os.db.mysql.open_v1","req","caps"]],["if",["=",["std.db.spec.resp_is_ok_v1","resp"],1],["begin",["let","pl",["std.db.spec.resp_ok_payload_v1","resp"]],["let","raw",["codec.read_u32_le","pl",0]],["let","conn",["std.db.spec.conn_pack_v1",["std.db.spec.driver_mysql_v1"],"raw"]],["std.db.spec.resp_ok_v1",["std.db.spec.op_open_v1"],["codec.write_u32_le","conn"]]],"resp"]],"kind":"defn","name":"std.db.mysql.open_v1","params":[{"name":"uri","ty":"bytes"},{"name":"caps","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","raw",["std.db.spec.conn_raw_v1","conn"]],["let","req",["std.db.mysql.spec.query_req_v1","raw","sql","params_doc","flags"]],["os.db.mysql.query_v1","req","caps"]],"kind":"defn","name":"std.db.mysql.query_v1","params":[{"name":"conn","ty":"i32"},{"name":"sql","ty":"bytes"},{"name":"params_doc","ty":"bytes"},{"name":"flags","ty":"i32"},{"name":"caps","ty":"bytes"}],"result":"bytes"}],"imports":["std.bytes","std.codec","std.db.mysql.spec","std.db.spec"],"kind":"module","module_id":"std.db.mysql","schema_version":"x07.x07ast@0.2.0"}
