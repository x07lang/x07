{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "std.cli.jsonl",
  "imports": [
    "ext.data_model",
    "ext.data_model.json",
    "std.vec"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "std.cli.jsonl.encode_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "std.cli.jsonl.encode_v1",
      "params": [
        { "name": "doc", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "canon_doc", ["ext.data_model.json.emit_canon", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", ["bytes.view", "canon_doc"]], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "docv", ["bytes.view", "canon_doc"]],
        ["let", "n", ["view.len", "docv"]],
        ["if", ["<", "n", 1], ["return", ["bytes.alloc", 0]], 0],
        ["if", ["!=", ["view.get_u8", "docv", 0], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "json", ["view.to_bytes", ["view.slice", "docv", 1, ["-", "n", 1]]]],
        ["let", "out", ["std.vec.with_capacity", ["+", ["bytes.len", "json"], 1]]],
        ["set", "out", ["std.vec.extend_bytes", "out", ["bytes.view", "json"]]],
        ["set", "out", ["std.vec.push", "out", 10]],
        ["std.vec.as_bytes", "out"]
      ]
    }
  ]
}
