{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "ext.msgpack.data_model",
  "imports": [
    "ext.data_model",
    "ext.error.context",
    "std.fmt",
    "std.math.bigint.codec_v1",
    "std.math.bigint.fmt",
    "std.math.bigint.parse",
    "std.math.decimal.codec_v1",
    "std.math.decimal.fmt",
    "std.math.decimal.parse"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "ext.msgpack.data_model.emit_v1",
        "ext.msgpack.data_model.parse_v1",
        "ext.msgpack.data_model.is_err",
        "ext.msgpack.data_model.err_code",
        "ext.msgpack.data_model.get_bytes"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model.is_err",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "i32",
      "body": ["begin", ["if", ["<", ["view.len", "doc"], 1], ["return", 1], 0], ["=", ["view.get_u8", "doc", 0], 0]]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model.err_code",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "i32",
      "body": ["ext.error.context.error_code", "doc"]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model.get_bytes",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "doc"]],
        ["if", ["<", "n", 2], ["return", ["bytes.alloc", 0]], 0],
        ["if", ["=", ["view.get_u8", "doc", 0], 1], 0, ["return", ["bytes.alloc", 0]]],
        ["view.to_bytes", ["view.slice", "doc", 1, ["-", "n", 1]]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._err_from_code",
      "params": [{ "name": "code", "ty": "i32" }],
      "result": "vec_u8",
      "body": [
        "begin",
        ["let", "v", ["vec_u8.with_capacity", 9]],
        ["set", "v", ["vec_u8.push", "v", 0]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["codec.write_u32_le", "code"]]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["codec.write_u32_le", 0]]],
        "v"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._doc_ok",
      "params": [{ "name": "payload", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "payload"]],
        ["let", "out", ["vec_u8.with_capacity", ["+", 1, "n"]]],
        ["set", "out", ["vec_u8.push", "out", 1]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "payload", 0, "n"]],
        ["vec_u8.into_bytes", "out"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model.emit_v1",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "doc"]],
        ["if", ["<", "n", 1], ["return", ["ext.error.context.err_from_code", 1]], 0],
        ["if", ["=", ["view.get_u8", "doc", 0], 0], ["return", ["view.to_bytes", "doc"]], 0],
        ["let", "out", ["vec_u8.push", ["vec_u8.with_capacity", ["+", 64, "n"]], 1]],
        ["set", "out", ["ext.msgpack.data_model._emit_value_into", "out", "doc", 1]],
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", ["vec_u8.into_bytes", "out"]], 0],
        ["vec_u8.into_bytes", "out"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model.parse_v1",
      "params": [{ "name": "msgpack", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "msgpack"]],
        ["let", "res", ["ext.msgpack.data_model._parse_value", "msgpack", 0]],
        ["if", ["<", ["bytes.len", "res"], 1], ["return", ["ext.error.context.err_from_code", 1]], 0],
        ["if", ["=", ["bytes.get_u8", "res", 0], 0], ["return", "res"], 0],
        ["let", "rv", ["bytes.view", "res"]],
        ["if", ["<", ["view.len", "rv"], 6], ["return", ["ext.error.context.err_from_code", 1]], 0],
        ["let", "new_off", ["codec.read_u32_le", "rv", 1]],
        ["if", ["=", "new_off", "n"], 0, ["return", ["ext.error.context.err_from_code", 2]]],
        ["let", "val", ["view.slice", "rv", 5, ["-", ["view.len", "rv"], 5]]],
        ["ext.msgpack.data_model._doc_ok", "val"]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._ok_with_off",
      "params": [
        { "name": "new_off", "ty": "i32" },
        { "name": "payload", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "payload"]],
        ["let", "out", ["vec_u8.with_capacity", ["+", 5, "n"]]],
        ["set", "out", ["vec_u8.push", "out", 1]],
        ["set", "out", ["vec_u8.extend_bytes", "out", ["codec.write_u32_le", "new_off"]]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "payload", 0, "n"]],
        ["vec_u8.into_bytes", "out"]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_u16_be_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "x", "ty": "i32" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["if", ["<", "x", 0], ["return", ["ext.msgpack.data_model._err_from_code", 20]], 0],
        ["if", [">", "x", 65535], ["return", ["ext.msgpack.data_model._err_from_code", 20]], 0],
        ["set", "out", ["vec_u8.push", "out", ["&", [">>u", "x", 8], 255]]],
        ["set", "out", ["vec_u8.push", "out", ["&", "x", 255]]],
        "out"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_u32_be_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "x", "ty": "i32" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["set", "out", ["vec_u8.push", "out", ["&", [">>u", "x", 24], 255]]],
        ["set", "out", ["vec_u8.push", "out", ["&", [">>u", "x", 16], 255]]],
        ["set", "out", ["vec_u8.push", "out", ["&", [">>u", "x", 8], 255]]],
        ["set", "out", ["vec_u8.push", "out", ["&", "x", 255]]],
        "out"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_str_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "s", "ty": "bytes_view" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["let", "n", ["view.len", "s"]],
        ["if", ["<", "n", 0], ["return", ["ext.msgpack.data_model._err_from_code", 21]], 0],
        [
          "if",
          ["<", "n", 32],
          ["set", "out", ["vec_u8.push", "out", ["|", 160, "n"]]],
          [
            "if",
            ["<", "n", 256],
            [
              "begin",
              ["set", "out", ["vec_u8.push", "out", 217]],
              ["set", "out", ["vec_u8.push", "out", "n"]]
            ],
            [
              "if",
              ["<", "n", 65536],
              [
                "begin",
                ["set", "out", ["vec_u8.push", "out", 218]],
                ["set", "out", ["ext.msgpack.data_model._emit_u16_be_into", "out", "n"]]
              ],
              [
                "begin",
                ["set", "out", ["vec_u8.push", "out", 219]],
                ["set", "out", ["ext.msgpack.data_model._emit_u32_be_into", "out", "n"]]
              ]
            ]
          ]
        ],
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "s", 0, "n"]],
        "out"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_ext_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "type_code", "ty": "i32" },
        { "name": "data", "ty": "bytes_view" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["if", ["<", "type_code", 0], ["return", ["ext.msgpack.data_model._err_from_code", 22]], 0],
        ["if", [">", "type_code", 127], ["return", ["ext.msgpack.data_model._err_from_code", 22]], 0],
        ["let", "n", ["view.len", "data"]],
        ["if", ["<", "n", 0], ["return", ["ext.msgpack.data_model._err_from_code", 23]], 0],
        ["if", ["<", "n", 256], 0, ["return", ["ext.msgpack.data_model._err_from_code", 23]]],
        ["set", "out", ["vec_u8.push", "out", 199]],
        ["set", "out", ["vec_u8.push", "out", "n"]],
        ["set", "out", ["vec_u8.push", "out", "type_code"]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "data", 0, "n"]],
        "out"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_i32_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "x", "ty": "i32" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        [
          "if",
          ["<", "x", 0],
          [
            "begin",
            ["if", [">=", "x", -32], ["return", ["vec_u8.push", "out", ["&", "x", 255]]], 0],
            [
              "if",
              [">=", "x", -128],
              [
                "begin",
                ["set", "out", ["vec_u8.push", "out", 208]],
                ["set", "out", ["vec_u8.push", "out", ["&", "x", 255]]],
                ["return", "out"]
              ],
              [
                "if",
                [">=", "x", -32768],
                [
                  "begin",
                  ["let", "u", ["&", "x", 65535]],
                  ["set", "out", ["vec_u8.push", "out", 209]],
                  ["set", "out", ["ext.msgpack.data_model._emit_u16_be_into", "out", "u"]],
                  ["return", "out"]
                ],
                [
                  "begin",
                  ["set", "out", ["vec_u8.push", "out", 210]],
                  ["set", "out", ["ext.msgpack.data_model._emit_u32_be_into", "out", "x"]],
                  ["return", "out"]
                ]
              ]
            ]
          ],
          [
            "begin",
            ["if", ["<", "x", 128], ["return", ["vec_u8.push", "out", "x"]], 0],
            ["if", ["<", "x", 256], ["begin", ["set", "out", ["vec_u8.push", "out", 204]], ["set", "out", ["vec_u8.push", "out", "x"]], ["return", "out"]], 0],
            ["if", ["<", "x", 65536], ["begin", ["set", "out", ["vec_u8.push", "out", 205]], ["set", "out", ["ext.msgpack.data_model._emit_u16_be_into", "out", "x"]], ["return", "out"]], 0],
            ["set", "out", ["vec_u8.push", "out", 206]],
            ["set", "out", ["ext.msgpack.data_model._emit_u32_be_into", "out", "x"]],
            "out"
          ]
        ]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._emit_value_into",
      "params": [
        { "name": "out", "ty": "vec_u8" },
        { "name": "doc", "ty": "bytes_view" },
        { "name": "off", "ty": "i32" }
      ],
      "result": "vec_u8",
      "body": [
        "begin",
        ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
        ["let", "k", ["ext.data_model.kind_at", "doc", "off"]],
        ["if", ["<", "k", 0], ["return", ["ext.msgpack.data_model._err_from_code", 30]], 0],
        ["if", ["=", "k", 0], ["return", ["vec_u8.push", "out", 192]], 0],
        [
          "if",
          ["=", "k", 1],
          [
            "begin",
            ["let", "bv", ["ext.data_model.bool_get", "doc", "off"]],
            ["if", ["<", "bv", 0], ["return", ["ext.msgpack.data_model._err_from_code", 31]], 0],
            ["return", ["vec_u8.push", "out", ["if", ["=", "bv", 0], 194, 195]]]
          ],
          0
        ],
        [
          "if",
          ["=", "k", 3],
          [
            "begin",
            ["let", "s", ["ext.data_model.string_get", "doc", "off"]],
            ["if", ["=", ["bytes.len", "s"], 0], ["return", ["ext.msgpack.data_model._err_from_code", 32]], 0],
            ["return", ["ext.msgpack.data_model._emit_str_into", "out", ["bytes.view", "s"]]]
          ],
          0
        ],
        [
          "if",
          ["=", "k", 2],
          [
            "begin",
            ["let", "num", ["ext.data_model.number_get", "doc", "off"]],
            ["if", ["=", ["bytes.len", "num"], 0], ["return", ["ext.msgpack.data_model._err_from_code", 33]], 0],
            ["let", "numv", ["bytes.view", "num"]],
            ["let", "has_dot", 0],
            ["let", "has_exp", 0],
            ["let", "nn", ["view.len", "numv"]],
            [
              "for",
              "i",
              0,
              "nn",
              [
                "begin",
                ["let", "c", ["view.get_u8", "numv", "i"]],
                ["if", ["=", "c", 46], ["set", "has_dot", 1], 0],
                ["if", ["if", ["=", "c", 101], 1, ["=", "c", 69]], ["set", "has_exp", 1], 0]
              ]
            ],
            ["if", ["=", "has_exp", 1], ["return", ["ext.msgpack.data_model._err_from_code", 34]], 0],
            [
              "if",
              ["=", "has_dot", 0],
              [
                "begin",
                ["let", "bi_doc", ["std.math.bigint.parse.parse_dec_v1", "numv"]],
                ["let", "bi_docv", ["bytes.view", "bi_doc"]],
                ["if", ["std.math.bigint.parse.is_err", "bi_docv"], ["return", ["ext.msgpack.data_model._err_from_code", 35]], 0],
                ["let", "bi0", ["std.math.bigint.parse.get_bytes", "bi_docv"]],
                ["let", "canon", ["std.math.bigint.codec_v1.canon_v1", ["bytes.view", "bi0"]]],
                ["if", ["=", ["bytes.len", "canon"], 0], ["return", ["ext.msgpack.data_model._err_from_code", 36]], 0],
                ["let", "cv", ["bytes.view", "canon"]],
                ["let", "s", ["std.math.bigint.codec_v1.sign_v1", "cv"]],
                ["if", ["<", "s", 0], ["return", ["ext.msgpack.data_model._err_from_code", 36]], 0],
                ["if", ["=", "s", 0], ["return", ["ext.msgpack.data_model._emit_i32_into", "out", 0]], 0],
                ["let", "mag", ["std.math.bigint.codec_v1.mag_view_v1", "cv"]],
                ["let", "mlen", ["view.len", "mag"]],
                ["if", ["=", "mlen", 0], ["return", ["ext.msgpack.data_model._emit_i32_into", "out", 0]], 0],
                ["if", [">", "mlen", 4], ["return", ["ext.msgpack.data_model._emit_ext_into", "out", 1, "cv"]], 0],
                ["let", "hi", ["view.get_u8", "mag", 0]],
                ["if", ["if", ["=", "mlen", 4], [">=u", "hi", 128], 0], ["return", ["ext.msgpack.data_model._emit_ext_into", "out", 1, "cv"]], 0],
                ["let", "v", 0],
                ["for", "j", 0, "mlen", ["set", "v", ["|", ["<<u", "v", 8], ["view.get_u8", "mag", "j"]]]],
                ["if", ["=", "s", 1], ["return", ["ext.msgpack.data_model._emit_i32_into", "out", "v"]], 0],
                ["if", ["=", "s", 2], 0, ["return", ["ext.msgpack.data_model._err_from_code", 36]]],
                ["if", ["if", ["=", "mlen", 4], [">=u", "hi", 128], 0], ["return", ["ext.msgpack.data_model._emit_ext_into", "out", 1, "cv"]], 0],
                ["return", ["ext.msgpack.data_model._emit_i32_into", "out", ["-", 0, "v"]]]
              ],
              [
                "begin",
                ["let", "dec_doc", ["std.math.decimal.parse.parse_dec_v1", "numv"]],
                ["let", "dec_docv", ["bytes.view", "dec_doc"]],
                ["if", ["std.math.decimal.parse.is_err", "dec_docv"], ["return", ["ext.msgpack.data_model._err_from_code", 37]], 0],
                ["let", "dec0", ["std.math.decimal.parse.get_bytes", "dec_docv"]],
                ["let", "canon", ["std.math.decimal.codec_v1.canon_v1", ["bytes.view", "dec0"]]],
                ["if", ["=", ["bytes.len", "canon"], 0], ["return", ["ext.msgpack.data_model._err_from_code", 38]], 0],
                ["return", ["ext.msgpack.data_model._emit_ext_into", "out", 2, ["bytes.view", "canon"]]]
              ]
            ]
          ],
          0
        ],
        [
          "if",
          ["=", "k", 4],
          [
            "begin",
            ["let", "count", ["ext.data_model.seq_len", "doc", "off"]],
            ["if", ["<", "count", 0], ["return", ["ext.msgpack.data_model._err_from_code", 40]], 0],
            [
              "if",
              ["<", "count", 16],
              ["set", "out", ["vec_u8.push", "out", ["|", 144, "count"]]],
              [
                "if",
                ["<", "count", 65536],
                ["begin", ["set", "out", ["vec_u8.push", "out", 220]], ["set", "out", ["ext.msgpack.data_model._emit_u16_be_into", "out", "count"]]],
                ["begin", ["set", "out", ["vec_u8.push", "out", 221]], ["set", "out", ["ext.msgpack.data_model._emit_u32_be_into", "out", "count"]]]
              ]
            ],
            ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
            [
              "for",
              "i",
              0,
              "count",
              [
                "begin",
                ["let", "eo", ["ext.data_model.seq_get", "doc", "off", "i"]],
                ["if", ["<", "eo", 0], ["return", ["ext.msgpack.data_model._err_from_code", 41]], 0],
                ["set", "out", ["ext.msgpack.data_model._emit_value_into", "out", "doc", "eo"]]
              ]
            ],
            ["return", "out"]
          ],
          0
        ],
        [
          "if",
          ["=", "k", 5],
          [
            "begin",
            ["let", "count", ["ext.data_model.map_len", "doc", "off"]],
            ["if", ["<", "count", 0], ["return", ["ext.msgpack.data_model._err_from_code", 50]], 0],
            [
              "if",
              ["<", "count", 16],
              ["set", "out", ["vec_u8.push", "out", ["|", 128, "count"]]],
              [
                "if",
                ["<", "count", 65536],
                ["begin", ["set", "out", ["vec_u8.push", "out", 222]], ["set", "out", ["ext.msgpack.data_model._emit_u16_be_into", "out", "count"]]],
                ["begin", ["set", "out", ["vec_u8.push", "out", 223]], ["set", "out", ["ext.msgpack.data_model._emit_u32_be_into", "out", "count"]]]
              ]
            ],
            ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
            [
              "for",
              "i",
              0,
              "count",
              [
                "begin",
                ["let", "key", ["ext.data_model.map_key_at", "doc", "off", "i"]],
                ["if", ["=", ["bytes.len", "key"], 0], ["return", ["ext.msgpack.data_model._err_from_code", 51]], 0],
                ["set", "out", ["ext.msgpack.data_model._emit_str_into", "out", ["bytes.view", "key"]]],
                ["if", ["=", ["vec_u8.get", "out", 0], 0], ["return", "out"], 0],
                ["let", "vo", ["ext.data_model.map_value_at", "doc", "off", "i"]],
                ["if", ["<", "vo", 0], ["return", ["ext.msgpack.data_model._err_from_code", 52]], 0],
                ["set", "out", ["ext.msgpack.data_model._emit_value_into", "out", "doc", "vo"]]
              ]
            ],
            ["return", "out"]
          ],
          0
        ],
        ["ext.msgpack.data_model._err_from_code", 60]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._read_u16_be",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off", "ty": "i32" }
      ],
      "result": "i32",
      "body": [
        "begin",
        ["let", "b0", ["view.get_u8", "b", "off"]],
        ["let", "b1", ["view.get_u8", "b", ["+", "off", 1]]],
        ["|", ["<<u", "b0", 8], "b1"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._read_u32_be",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off", "ty": "i32" }
      ],
      "result": "i32",
      "body": [
        "begin",
        ["let", "b0", ["view.get_u8", "b", "off"]],
        ["let", "b1", ["view.get_u8", "b", ["+", "off", 1]]],
        ["let", "b2", ["view.get_u8", "b", ["+", "off", 2]]],
        ["let", "b3", ["view.get_u8", "b", ["+", "off", 3]]],
        ["|", ["|", ["|", ["<<u", "b0", 24], ["<<u", "b1", 16]], ["<<u", "b2", 8]], "b3"]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_int_into_value",
      "params": [{ "name": "x", "ty": "i32" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "s", ["std.fmt.s32_to_dec", "x"]],
        ["let", "val", ["ext.data_model.value_number", ["bytes.view", "s"]]],
        "val"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_uint_into_value",
      "params": [{ "name": "x", "ty": "i32" }],
      "result": "bytes",
      "body": [
        "begin",
        ["if", ["<", "x", 0], ["return", ["bytes.alloc", 0]], 0],
        ["let", "s", ["std.fmt.u32_to_dec", "x"]],
        ["let", "val", ["ext.data_model.value_number", ["bytes.view", "s"]]],
        "val"
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_value",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", "off0", "n"], ["return", ["ext.error.context.err_from_code", 300]], 0],
        ["let", "ib", ["view.get_u8", "b", "off0"]],

        ["if", ["<", "ib", 128], ["begin", ["let", "val", ["ext.msgpack.data_model._parse_uint_into_value", "ib"]], ["if", ["=", ["bytes.len", "val"], 0], ["return", ["ext.error.context.err_from_code", 301]], 0], ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 1], ["bytes.view", "val"]]]], 0],
        ["if", [">=u", "ib", 224], ["begin", ["let", "x", ["-", "ib", 256]], ["let", "val", ["ext.msgpack.data_model._parse_int_into_value", "x"]], ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 1], ["bytes.view", "val"]]]], 0],

        ["if", ["=", "ib", 192], ["begin", ["let", "v", ["ext.data_model.value_null"]], ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 1], ["bytes.view", "v"]]]], 0],
        ["if", ["=", "ib", 194], ["begin", ["let", "v", ["ext.data_model.value_bool", 0]], ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 1], ["bytes.view", "v"]]]], 0],
        ["if", ["=", "ib", 195], ["begin", ["let", "v", ["ext.data_model.value_bool", 1]], ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 1], ["bytes.view", "v"]]]], 0],

        [
          "if",
          ["if", [">=u", "ib", 160], ["<u", "ib", 192], 0],
          [
            "begin",
            ["let", "len", ["&", "ib", 31]],
            ["let", "start", ["+", "off0", 1]],
            ["if", [">=u", ["+", "start", "len"], ["+", "n", 1]], ["return", ["ext.error.context.err_from_code", 310]], 0],
            ["let", "s", ["view.slice", "b", "start", "len"]],
            ["let", "val", ["ext.data_model.value_string", "s"]],
            ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]]
          ],
          0
        ],

        [
          "if",
          ["if", [">=u", "ib", 144], ["<u", "ib", 160], 0],
          ["return", ["ext.msgpack.data_model._parse_array", "b", ["+", "off0", 1], ["&", "ib", 15]]],
          0
        ],
        [
          "if",
          ["if", [">=u", "ib", 128], ["<u", "ib", 144], 0],
          ["return", ["ext.msgpack.data_model._parse_map", "b", ["+", "off0", 1], ["&", "ib", 15]]],
          0
        ],

        ["if", ["=", "ib", 204], ["return", ["ext.msgpack.data_model._parse_u8", "b", "off0"]], 0],
        ["if", ["=", "ib", 205], ["return", ["ext.msgpack.data_model._parse_u16", "b", "off0"]], 0],
        ["if", ["=", "ib", 206], ["return", ["ext.msgpack.data_model._parse_u32", "b", "off0"]], 0],
        ["if", ["=", "ib", 208], ["return", ["ext.msgpack.data_model._parse_i8", "b", "off0"]], 0],
        ["if", ["=", "ib", 209], ["return", ["ext.msgpack.data_model._parse_i16", "b", "off0"]], 0],
        ["if", ["=", "ib", 210], ["return", ["ext.msgpack.data_model._parse_i32", "b", "off0"]], 0],

        ["if", ["=", "ib", 217], ["return", ["ext.msgpack.data_model._parse_str8", "b", "off0"]], 0],
        ["if", ["=", "ib", 218], ["return", ["ext.msgpack.data_model._parse_str16", "b", "off0"]], 0],
        ["if", ["=", "ib", 219], ["return", ["ext.msgpack.data_model._parse_str32", "b", "off0"]], 0],

        ["if", ["=", "ib", 220], ["return", ["ext.msgpack.data_model._parse_array16", "b", "off0"]], 0],
        ["if", ["=", "ib", 221], ["return", ["ext.msgpack.data_model._parse_array32", "b", "off0"]], 0],
        ["if", ["=", "ib", 222], ["return", ["ext.msgpack.data_model._parse_map16", "b", "off0"]], 0],
        ["if", ["=", "ib", 223], ["return", ["ext.msgpack.data_model._parse_map32", "b", "off0"]], 0],

        ["if", ["=", "ib", 199], ["return", ["ext.msgpack.data_model._parse_ext8", "b", "off0"]], 0],

        ["ext.error.context.err_from_code", 399]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_u8",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 1], "n"], ["return", ["ext.error.context.err_from_code", 320]], 0],
        ["let", "v", ["view.get_u8", "b", ["+", "off0", 1]]],
        ["let", "val", ["ext.msgpack.data_model._parse_uint_into_value", "v"]],
        ["if", ["=", ["bytes.len", "val"], 0], ["return", ["ext.error.context.err_from_code", 321]], 0],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 2], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_u16",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 320]], 0],
        ["let", "v", ["ext.msgpack.data_model._read_u16_be", "b", ["+", "off0", 1]]],
        ["let", "val", ["ext.msgpack.data_model._parse_uint_into_value", "v"]],
        ["if", ["=", ["bytes.len", "val"], 0], ["return", ["ext.error.context.err_from_code", 321]], 0],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 3], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_u32",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 4], "n"], ["return", ["ext.error.context.err_from_code", 320]], 0],
        ["let", "v", ["ext.msgpack.data_model._read_u32_be", "b", ["+", "off0", 1]]],
        ["if", ["<", "v", 0], ["return", ["ext.error.context.err_from_code", 322]], 0],
        ["let", "val", ["ext.msgpack.data_model._parse_uint_into_value", "v"]],
        ["if", ["=", ["bytes.len", "val"], 0], ["return", ["ext.error.context.err_from_code", 321]], 0],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 5], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_i8",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 1], "n"], ["return", ["ext.error.context.err_from_code", 330]], 0],
        ["let", "u", ["view.get_u8", "b", ["+", "off0", 1]]],
        ["let", "x", ["if", [">=u", "u", 128], ["-", "u", 256], "u"]],
        ["let", "val", ["ext.msgpack.data_model._parse_int_into_value", "x"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 2], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_i16",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 330]], 0],
        ["let", "u", ["ext.msgpack.data_model._read_u16_be", "b", ["+", "off0", 1]]],
        ["let", "x", ["if", [">=u", "u", 32768], ["-", "u", 65536], "u"]],
        ["let", "val", ["ext.msgpack.data_model._parse_int_into_value", "x"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 3], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_i32",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 4], "n"], ["return", ["ext.error.context.err_from_code", 330]], 0],
        ["let", "x", ["ext.msgpack.data_model._read_u32_be", "b", ["+", "off0", 1]]],
        ["let", "val", ["ext.msgpack.data_model._parse_int_into_value", "x"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "off0", 5], ["bytes.view", "val"]]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_str8",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 1], "n"], ["return", ["ext.error.context.err_from_code", 340]], 0],
        ["let", "len", ["view.get_u8", "b", ["+", "off0", 1]]],
        ["let", "start", ["+", "off0", 2]],
        ["if", [">=u", ["+", "start", "len"], ["+", "n", 1]], ["return", ["ext.error.context.err_from_code", 341]], 0],
        ["let", "s", ["view.slice", "b", "start", "len"]],
        ["let", "val", ["ext.data_model.value_string", "s"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_str16",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 340]], 0],
        ["let", "len", ["ext.msgpack.data_model._read_u16_be", "b", ["+", "off0", 1]]],
        ["let", "start", ["+", "off0", 3]],
        ["if", [">=u", ["+", "start", "len"], ["+", "n", 1]], ["return", ["ext.error.context.err_from_code", 341]], 0],
        ["let", "s", ["view.slice", "b", "start", "len"]],
        ["let", "val", ["ext.data_model.value_string", "s"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_str32",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 4], "n"], ["return", ["ext.error.context.err_from_code", 340]], 0],
        ["let", "len", ["ext.msgpack.data_model._read_u32_be", "b", ["+", "off0", 1]]],
        ["if", ["<", "len", 0], ["return", ["ext.error.context.err_from_code", 342]], 0],
        ["let", "start", ["+", "off0", 5]],
        ["if", [">=u", ["+", "start", "len"], ["+", "n", 1]], ["return", ["ext.error.context.err_from_code", 341]], 0],
        ["let", "s", ["view.slice", "b", "start", "len"]],
        ["let", "val", ["ext.data_model.value_string", "s"]],
        ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_array16",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 350]], 0],
        ["let", "count", ["ext.msgpack.data_model._read_u16_be", "b", ["+", "off0", 1]]],
        ["ext.msgpack.data_model._parse_array", "b", ["+", "off0", 3], "count"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_array32",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 4], "n"], ["return", ["ext.error.context.err_from_code", 350]], 0],
        ["let", "count", ["ext.msgpack.data_model._read_u32_be", "b", ["+", "off0", 1]]],
        ["if", ["<", "count", 0], ["return", ["ext.error.context.err_from_code", 351]], 0],
        ["ext.msgpack.data_model._parse_array", "b", ["+", "off0", 5], "count"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_map16",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 360]], 0],
        ["let", "count", ["ext.msgpack.data_model._read_u16_be", "b", ["+", "off0", 1]]],
        ["ext.msgpack.data_model._parse_map", "b", ["+", "off0", 3], "count"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_map32",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 4], "n"], ["return", ["ext.error.context.err_from_code", 360]], 0],
        ["let", "count", ["ext.msgpack.data_model._read_u32_be", "b", ["+", "off0", 1]]],
        ["if", ["<", "count", 0], ["return", ["ext.error.context.err_from_code", 361]], 0],
        ["ext.msgpack.data_model._parse_map", "b", ["+", "off0", 5], "count"]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_array",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" },
        { "name": "count", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["if", ["<", "count", 0], ["return", ["ext.error.context.err_from_code", 370]], 0],
        ["let", "elems", ["vec_u8.with_capacity", ["+", 4, ["*", "count", 8]]]],
        ["set", "elems", ["vec_u8.extend_bytes", "elems", ["codec.write_u32_le", "count"]]],
        ["let", "cur", "off0"],
        [
          "for",
          "i",
          0,
          "count",
          [
            "begin",
            ["let", "r", ["ext.msgpack.data_model._parse_value", "b", "cur"]],
            ["if", ["<", ["bytes.len", "r"], 1], ["return", ["ext.error.context.err_from_code", 371]], 0],
            ["if", ["=", ["bytes.get_u8", "r", 0], 0], ["return", "r"], 0],
            ["let", "rv", ["bytes.view", "r"]],
            ["let", "next", ["codec.read_u32_le", "rv", 1]],
            ["let", "val", ["view.slice", "rv", 5, ["-", ["view.len", "rv"], 5]]],
            ["let", "vlen", ["view.len", "val"]],
            ["set", "elems", ["vec_u8.extend_bytes", "elems", ["codec.write_u32_le", "vlen"]]],
            ["set", "elems", ["vec_u8.extend_bytes_range", "elems", "val", 0, "vlen"]],
            ["set", "cur", "next"]
          ]
        ],
        ["let", "eb", ["vec_u8.into_bytes", "elems"]],
        ["let", "seq", ["ext.data_model.value_seq_from_elems", ["bytes.view", "eb"]]],
        ["if", ["=", ["bytes.len", "seq"], 0], ["return", ["ext.error.context.err_from_code", 372]], 0],
        ["ext.msgpack.data_model._ok_with_off", "cur", ["bytes.view", "seq"]]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_map",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" },
        { "name": "count", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["if", ["<", "count", 0], ["return", ["ext.error.context.err_from_code", 380]], 0],
        ["let", "entries", ["vec_u8.with_capacity", ["+", 4, ["*", "count", 16]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", "count"]]],
        ["let", "cur", "off0"],
        [
          "for",
          "i",
          0,
          "count",
          [
            "begin",
            ["let", "kr", ["ext.msgpack.data_model._parse_value", "b", "cur"]],
            ["if", ["<", ["bytes.len", "kr"], 1], ["return", ["ext.error.context.err_from_code", 381]], 0],
            ["if", ["=", ["bytes.get_u8", "kr", 0], 0], ["return", "kr"], 0],
            ["let", "krv", ["bytes.view", "kr"]],
            ["let", "after_k", ["codec.read_u32_le", "krv", 1]],
            ["let", "kval", ["view.slice", "krv", 5, ["-", ["view.len", "krv"], 5]]],
            ["let", "kk", ["ext.data_model.kind_at", "kval", 0]],
            ["if", ["=", "kk", 3], 0, ["return", ["ext.error.context.err_from_code", 382]]],
            ["let", "key_b", ["ext.data_model.string_get", "kval", 0]],
            ["if", ["=", ["bytes.len", "key_b"], 0], ["return", ["ext.error.context.err_from_code", 383]], 0],
            ["let", "key", ["bytes.view", "key_b"]],
            ["let", "klen", ["view.len", "key"]],
            ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", "klen"]]],
            ["set", "entries", ["vec_u8.extend_bytes_range", "entries", "key", 0, "klen"]],
            ["let", "vr", ["ext.msgpack.data_model._parse_value", "b", "after_k"]],
            ["if", ["<", ["bytes.len", "vr"], 1], ["return", ["ext.error.context.err_from_code", 384]], 0],
            ["if", ["=", ["bytes.get_u8", "vr", 0], 0], ["return", "vr"], 0],
            ["let", "vrv", ["bytes.view", "vr"]],
            ["let", "after_v", ["codec.read_u32_le", "vrv", 1]],
            ["let", "vval", ["view.slice", "vrv", 5, ["-", ["view.len", "vrv"], 5]]],
            ["let", "vlen", ["view.len", "vval"]],
            ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", "vlen"]]],
            ["set", "entries", ["vec_u8.extend_bytes_range", "entries", "vval", 0, "vlen"]],
            ["set", "cur", "after_v"]
          ]
        ],
        ["let", "eb", ["vec_u8.into_bytes", "entries"]],
        ["let", "map", ["ext.data_model.value_map_from_entries", ["bytes.view", "eb"]]],
        ["if", ["=", ["bytes.len", "map"], 0], ["return", ["ext.error.context.err_from_code", 385]], 0],
        ["ext.msgpack.data_model._ok_with_off", "cur", ["bytes.view", "map"]]
      ]
    },

    {
      "kind": "defn",
      "name": "ext.msgpack.data_model._parse_ext8",
      "params": [
        { "name": "b", "ty": "bytes_view" },
        { "name": "off0", "ty": "i32" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "b"]],
        ["if", [">=u", ["+", "off0", 2], "n"], ["return", ["ext.error.context.err_from_code", 390]], 0],
        ["let", "len", ["view.get_u8", "b", ["+", "off0", 1]]],
        ["let", "t", ["view.get_u8", "b", ["+", "off0", 2]]],
        ["let", "start", ["+", "off0", 3]],
        ["if", [">=u", ["+", "start", "len"], ["+", "n", 1]], ["return", ["ext.error.context.err_from_code", 391]], 0],
        ["let", "data", ["view.slice", "b", "start", "len"]],
        [
          "if",
          ["=", "t", 1],
          [
            "begin",
            ["let", "fmt_doc", ["std.math.bigint.fmt.format_dec_v1", "data"]],
            ["let", "fdv", ["bytes.view", "fmt_doc"]],
            ["if", ["std.math.bigint.fmt.is_err", "fdv"], ["return", ["ext.error.context.err_from_code", 392]], 0],
            ["let", "s", ["std.math.bigint.fmt.get_bytes", "fdv"]],
            ["let", "val", ["ext.data_model.value_number", ["bytes.view", "s"]]],
            ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]]
          ],
          0
        ],
        [
          "if",
          ["=", "t", 2],
          [
            "begin",
            ["let", "fmt_doc", ["std.math.decimal.fmt.format_dec_v1", "data"]],
            ["let", "fdv", ["bytes.view", "fmt_doc"]],
            ["if", ["std.math.decimal.fmt.is_err", "fdv"], ["return", ["ext.error.context.err_from_code", 393]], 0],
            ["let", "s", ["std.math.decimal.fmt.get_bytes", "fdv"]],
            ["let", "val", ["ext.data_model.value_number", ["bytes.view", "s"]]],
            ["return", ["ext.msgpack.data_model._ok_with_off", ["+", "start", "len"], ["bytes.view", "val"]]]
          ],
          0
        ],
        ["ext.error.context.err_from_code", 394]
      ]
    }
  ],
  "meta": {
    "generated_by": "manual",
    "package": "x07:ext-msgpack-rs@0.1.0"
  }
}
