{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "ext.streams.tests",
  "imports": [
    "ext.streams",
    "std.deque_u32",
    "std.hash_map",
    "std.hash_set",
    "std.heap_u32",
    "std.io",
    "std.test"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "ext.streams.tests.test_open_read_bytes_roundtrip",
        "ext.streams.tests.test_open_read_view_roundtrip",
        "ext.streams.tests.test_open_read_vec_u8_roundtrip",
        "ext.streams.tests.test_hash_set_u32le_matches_emit",
        "ext.streams.tests.test_hash_map_kv_u32le_u32le_matches_emit",
        "ext.streams.tests.test_deque_u32le_matches_emit",
        "ext.streams.tests.test_heap_u32le_matches_emit"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_open_read_bytes_roundtrip",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "b", ["bytes.lit", "hello_streams"]],
        ["let", "expected", ["view.to_bytes", ["bytes.view", "b"]]],
        ["let", "reader", ["ext.streams.open_read_bytes", "b"]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_open_read_view_roundtrip",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "b", ["bytes.lit", "0123456789"]],
        ["let", "expected", ["view.to_bytes", ["view.slice", ["bytes.view", "b"], 2, 5]]],
        ["let", "reader", ["ext.streams.open_read_view", ["view.slice", ["bytes.view", "b"], 2, 5]]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_open_read_vec_u8_roundtrip",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "seed", ["bytes.lit", "vec_payload"]],
        ["let", "expected", ["view.to_bytes", ["bytes.view", "seed"]]],
        ["let", "v", ["vec_u8.with_capacity", ["bytes.len", "seed"]]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.view", "seed"]]],
        ["let", "reader", ["ext.streams.open_read_vec_u8", "v"]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_hash_set_u32le_matches_emit",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "s", ["std.hash_set.new_u32", 8]],
        ["std.hash_set.add_u32", "s", 9],
        ["std.hash_set.add_u32", "s", 1],
        ["std.hash_set.add_u32", "s", 5],
        ["let", "expected", ["std.hash_set.emit_u32le", "s"]],
        ["let", "reader", ["ext.streams.open_read_hash_set_u32le", "s"]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_hash_map_kv_u32le_u32le_matches_emit",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "m", ["std.hash_map.with_capacity_u32", 4]],
        ["std.hash_map.set_u32", "m", 2, 200],
        ["std.hash_map.set_u32", "m", 1, 100],
        ["std.hash_map.set_u32", "m", 3, 300],
        ["std.hash_map.set_u32", "m", 2, 201],
        ["let", "expected", ["std.hash_map.emit_kv_u32le_u32le", "m"]],
        ["let", "reader", ["ext.streams.open_read_hash_map_kv_u32le_u32le", "m"]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_deque_u32le_matches_emit",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "dq", ["std.deque_u32.with_capacity", 4]],
        ["set", "dq", ["std.deque_u32.push_back", "dq", 9]],
        ["set", "dq", ["std.deque_u32.push_back", "dq", 1]],
        ["set", "dq", ["std.deque_u32.push_back", "dq", 5]],
        ["let", "expected", ["std.deque_u32.emit_u32le", ["bytes.view", "dq"]]],
        ["let", "reader", ["ext.streams.open_read_deque_u32le", ["bytes.view", "dq"]]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.streams.tests.test_heap_u32le_matches_emit",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "h", ["std.heap_u32.with_capacity", 4]],
        ["set", "h", ["std.heap_u32.push", "h", 9]],
        ["set", "h", ["std.heap_u32.push", "h", 1]],
        ["set", "h", ["std.heap_u32.push", "h", 5]],
        ["let", "expected", ["std.heap_u32.emit_u32le", ["view.to_bytes", ["bytes.view", "h"]]]],
        ["let", "reader", ["ext.streams.open_read_heap_u32le", ["bytes.view", "h"]]],
        ["let", "got", ["std.io.read_all", "reader"]],
        ["try", ["std.test.assert_bytes_eq", "got", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["std.heap_u32.len", ["bytes.view", "h"]], 3, ["std.test.code_assert_i32_eq"]]],
        ["std.test.pass"]
      ]
    }
  ]
}

