{
  "schema_version": "x07.x07ast@0.1.0",
  "kind": "module",
  "module_id": "std.math.bigint.parse",
  "imports": [
    "ext.error.context",
    "std.math.bigint"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "std.math.bigint.parse.parse_dec_v1",
        "std.math.bigint.parse.is_err",
        "std.math.bigint.parse.err_code",
        "std.math.bigint.parse.get_bytes"
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.bigint.parse.is_err",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "i32",
      "body": ["begin", ["if", ["<", ["view.len", "doc"], 1], ["return", 1], 0], ["=", ["view.get_u8", "doc", 0], 0]]
    },
    {
      "kind": "defn",
      "name": "std.math.bigint.parse.err_code",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "i32",
      "body": ["ext.error.context.error_code", "doc"]
    },
    {
      "kind": "defn",
      "name": "std.math.bigint.parse.get_bytes",
      "params": [{ "name": "doc", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "doc"]],
        ["if", ["<", "n", 2], ["return", ["bytes.alloc", 0]], 0],
        ["if", ["=", ["view.get_u8", "doc", 0], 1], 0, ["return", ["bytes.alloc", 0]]],
        ["view.to_bytes", ["view.slice", "doc", 1, ["-", "n", 1]]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.bigint.parse._doc_ok",
      "params": [{ "name": "v", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "v"]],
        ["let", "out", ["vec_u8.with_capacity", ["+", 1, "n"]]],
        ["set", "out", ["vec_u8.push", "out", 1]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "v", 0, "n"]],
        ["vec_u8.into_bytes", "out"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.math.bigint.parse.parse_dec_v1",
      "params": [{ "name": "s", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "n", ["view.len", "s"]],
        ["if", ["=", "n", 0], ["return", ["ext.error.context.err_from_code", 1]], 0],
        ["let", "i", 0],
        ["let", "sign", 1],
        [
          "if",
          ["<u", 0, "n"],
          [
            "begin",
            ["let", "c0", ["view.get_u8", "s", 0]],
            [
              "if",
              ["=", "c0", 45],
              ["begin", ["set", "sign", 2], ["set", "i", 1]],
              ["if", ["=", "c0", 43], ["set", "i", 1], 0]
            ]
          ],
          0
        ],
        ["if", [">=u", "i", "n"], ["return", ["ext.error.context.err_from_code", 1]], 0],
        ["let", "mag", ["vec_u8.push", ["vec_u8.with_capacity", 1], 0]],
        ["let", "done", 0],
        [
          "for",
          "_",
          0,
          "n",
          [
            "if",
            ["=", "done", 0],
            [
              "if",
              ["<u", "i", "n"],
              [
                "begin",
                ["let", "c", ["view.get_u8", "s", "i"]],
                ["if", ["<u", "c", 48], ["return", ["ext.error.context.err_from_code", 2]], 0],
                ["if", [">=u", "c", 58], ["return", ["ext.error.context.err_from_code", 2]], 0],
                ["let", "digit", ["-", "c", 48]],
                ["let", "mlen", ["vec_u8.len", "mag"]],
                ["let", "carry", "digit"],
                ["let", "j", 0],
                [
                  "for",
                  "_",
                  0,
                  "mlen",
                  [
                    "begin",
                    ["let", "idx", ["-", ["-", "mlen", 1], "j"]],
                    ["let", "b", ["vec_u8.get", "mag", "idx"]],
                    ["let", "prod", ["+", ["*", "b", 10], "carry"]],
                    ["set", "mag", ["vec_u8.set", "mag", "idx", ["&", "prod", 255]]],
                    ["set", "carry", [">>u", "prod", 8]],
                    ["set", "j", ["+", "j", 1]]
                  ]
                ],
                [
                  "if",
                  [">", "carry", 0],
                  [
                    "begin",
                    ["let", "old", "mag"],
                    ["let", "oldv", ["vec_u8.as_view", "old"]],
                    ["let", "new", ["vec_u8.with_capacity", ["+", "mlen", 4]]],
                    ["if", ["<u", "carry", 256], ["set", "new", ["vec_u8.push", "new", "carry"]], ["begin", ["set", "new", ["vec_u8.push", "new", ["&", [">>u", "carry", 8], 255]]], ["set", "new", ["vec_u8.push", "new", ["&", "carry", 255]]]]],
                    ["set", "new", ["vec_u8.extend_bytes_range", "new", "oldv", 0, "mlen"]],
                    ["set", "mag", "new"]
                  ],
                  0
                ],
                ["set", "i", ["+", "i", 1]]
              ],
              ["set", "done", 1]
            ],
            0
          ]
        ],
        ["set", "mag", ["std.math.bigint._trim_mag_vec", "mag"]],
        [
          "if",
          ["if", ["=", ["vec_u8.len", "mag"], 1], ["=", ["vec_u8.get", "mag", 0], 0], 0],
          [
            "begin",
            ["let", "z", ["bytes.alloc", 1]],
            ["return", ["std.math.bigint.parse._doc_ok", ["bytes.view", "z"]]],
            0
          ],
          0
        ],
        ["let", "magv", ["vec_u8.as_view", "mag"]],
        ["let", "out", ["vec_u8.with_capacity", ["+", 1, ["view.len", "magv"]]]],
        ["set", "out", ["vec_u8.push", "out", "sign"]],
        ["set", "out", ["vec_u8.extend_bytes_range", "out", "magv", 0, ["view.len", "magv"]]],
        ["let", "val", ["vec_u8.into_bytes", "out"]],
        ["std.math.bigint.parse._doc_ok", ["bytes.view", "val"]]
      ]
    }
  ],
  "meta": {
    "generated_by": "manual",
    "package": "x07:ext-bigint-rs@0.1.0"
  }
}
