{"decls":[{"kind":"export","names":["std.crawl.fetch.os.run_rr_missing_v1","std.crawl.fetch.os.run_rr_v1"]},{"body":["begin",["let","caps",["std.net.http.spec.caps_v1",1,30,4,4096,64,"max_body_bytes"]],["let","resp_doc",["std.net.http.client.get_v1","url","caps"]],["let","respv",["bytes.view","resp_doc"]],["let","net_err",["if",["=",["std.net.http.client.resp_is_err_v1","respv"],1],["std.net.http.client.resp_err_code_v1","respv"],0]],["let","body",["std.net.http.client.resp_body_v1","respv"]],["let","entry",["std.crawl.fetch.rr_entry_v1","kind","op","urlv","urlv",["bytes.view","body"],"net_err"]],["if",["=",["bytes.len","entry"],0],["return",["result_bytes.err",9354]],0],["let","ap",["std.rr.append_v1","h",["bytes.view","entry"]]],["if",["!=",["result_i32.err_code","ap"],0],["return",["result_bytes.err",9355]],0],["result_bytes.ok","entry"]],"kind":"defn","name":"std.crawl.fetch.os._http_get_append_entry_v1","params":[{"name":"h","ty":"i32"},{"name":"kind","ty":"bytes_view"},{"name":"op","ty":"bytes_view"},{"name":"url","ty":"bytes"},{"name":"urlv","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"}],"result":"result_bytes"},{"body":["begin",["let","h",["std.rr.current_v1"]],["if",["<=","h",0],["return",["result_bytes.err",9361]],0],["if",["=",["ext.data_model.doc_is_err","plan_doc"],1],["return",["result_bytes.err",9362]],0],["let","root",["ext.data_model.root_offset","plan_doc"]],["let","count",["ext.data_model.seq_len","plan_doc","root"]],["if",["<","count",0],["return",["result_bytes.err",9363]],0],["let","kind_b",["bytes.lit","rr"]],["let","op_b",["bytes.lit","std.crawl.fetch.http_get_v1"]],["let","kind",["bytes.view","kind_b"]],["let","op",["bytes.view","op_b"]],["let","out",["std.vec.with_capacity",256]],["for","i",0,"count",["begin",["let","off",["ext.data_model.seq_get","plan_doc","root","i"]],["let","url",["ext.data_model.string_get","plan_doc","off"]],["let","urlv",["bytes.view","url"]],["let","next",["std.rr.next_v1","h","kind","op","urlv"]],["let","err_code",["result_bytes.err_code","next"]],["if",["=","err_code",0],["begin",["let","entry",["result_bytes.unwrap_or","next",["bytes.alloc",0]]],["let","resp",["std.rr.entry_resp_v1",["bytes.view","entry"]]],["set","out",["std.u32.push_le","out",["bytes.len","resp"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","resp"]]],0],["if",["=","err_code",2009],["begin",["let","entry_r",["std.crawl.fetch.os._http_get_append_entry_v1","h","kind","op","url","urlv","max_body_bytes"]],["if",["!=",["result_bytes.err_code","entry_r"],0],["return",["result_bytes.err",["result_bytes.err_code","entry_r"]]],0],["let","entry",["result_bytes.unwrap_or","entry_r",["bytes.alloc",0]]],["let","resp",["std.rr.entry_resp_v1",["bytes.view","entry"]]],["set","out",["std.u32.push_le","out",["bytes.len","resp"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","resp"]]],0],["return",["result_bytes.err","err_code"]]]],0]],["result_bytes.ok",["std.vec.as_bytes","out"]]],"kind":"defn","name":"std.crawl.fetch.os._process_plan_record_missing_v1","params":[{"name":"plan_doc","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"}],"result":"result_bytes"},{"body":["begin",["let","h",["std.rr.current_v1"]],["if",["<=","h",0],["return",["result_bytes.err",9351]],0],["if",["=",["ext.data_model.doc_is_err","plan_doc"],1],["return",["result_bytes.err",9352]],0],["let","root",["ext.data_model.root_offset","plan_doc"]],["let","count",["ext.data_model.seq_len","plan_doc","root"]],["if",["<","count",0],["return",["result_bytes.err",9353]],0],["let","kind_b",["bytes.lit","rr"]],["let","op_b",["bytes.lit","std.crawl.fetch.http_get_v1"]],["let","kind",["bytes.view","kind_b"]],["let","op",["bytes.view","op_b"]],["let","out",["std.vec.with_capacity",256]],["for","i",0,"count",["begin",["let","off",["ext.data_model.seq_get","plan_doc","root","i"]],["let","url",["ext.data_model.string_get","plan_doc","off"]],["let","urlv",["bytes.view","url"]],["let","entry_r",["std.crawl.fetch.os._http_get_append_entry_v1","h","kind","op","url","urlv","max_body_bytes"]],["if",["!=",["result_bytes.err_code","entry_r"],0],["return",["result_bytes.err",["result_bytes.err_code","entry_r"]]],0],["let","entry",["result_bytes.unwrap_or","entry_r",["bytes.alloc",0]]],["let","resp",["std.rr.entry_resp_v1",["bytes.view","entry"]]],["set","out",["std.u32.push_le","out",["bytes.len","resp"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","resp"]]],0]],["result_bytes.ok",["std.vec.as_bytes","out"]]],"kind":"defn","name":"std.crawl.fetch.os._process_plan_record_v1","params":[{"name":"plan_doc","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"}],"result":"result_bytes"},{"body":["budget.scope_from_arch_v1",["bytes.lit","crawl_default_v1"],["std.rr.with_policy_v1",["bytes.lit","crawl_rr_v1"],["bytes.lit","crawl_v1.rrbin"],["i32.lit",3],["std.crawl.fetch.os._process_plan_record_missing_v1","plan_doc","max_body_bytes"]]],"kind":"defn","name":"std.crawl.fetch.os.run_rr_missing_v1","params":[{"name":"plan_doc","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"}],"result":"result_bytes"},{"body":["budget.scope_from_arch_v1",["bytes.lit","crawl_default_v1"],["std.rr.with_policy_v1",["bytes.lit","crawl_rr_v1"],["bytes.lit","crawl_v1.rrbin"],["i32.lit",1],["std.crawl.fetch.os._process_plan_record_v1","plan_doc","max_body_bytes"]]],"kind":"defn","name":"std.crawl.fetch.os.run_rr_v1","params":[{"name":"plan_doc","ty":"bytes_view"},{"name":"max_body_bytes","ty":"i32"}],"result":"result_bytes"}],"imports":["ext.data_model","std.crawl.fetch","std.net.http.client","std.net.http.spec","std.rr","std.u32","std.vec"],"kind":"module","module_id":"std.crawl.fetch.os","schema_version":"x07.x07ast@0.3.0"}
