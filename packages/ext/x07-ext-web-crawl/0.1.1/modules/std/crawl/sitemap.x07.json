{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "std.crawl.sitemap",
  "imports": [
    "ext.data_model",
    "ext.sitemap",
    "std.text.ascii",
    "std.text.slices",
    "std.u32",
    "std.vec"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "std.crawl.sitemap.parse_urls_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "std.crawl.sitemap.parse_urls_v1",
      "params": [
        { "name": "xml_bytes", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "raw", ["ext.sitemap.urls_v1", "xml_bytes"]],
        ["let", "rawv", ["bytes.view", "raw"]],
        ["let", "slb", ["std.text.ascii.split_lines_view", "rawv"]],
        ["let", "slv", ["bytes.view", "slb"]],
        ["let", "count", ["std.text.slices.count_v1", "slv"]],
        ["let", "entries", ["std.vec.with_capacity", 256]],
        ["set", "entries", ["std.u32.push_le", "entries", 0]],
        ["let", "out_count", 0],
        [
          "for",
          "i",
          0,
          "count",
          [
            "begin",
            ["let", "line", ["std.text.slices.view_at_v1", "rawv", "slv", "i"]],
            ["if", ["=", ["view.len", "line"], 0], 0, [
              "begin",
              ["let", "v", ["ext.data_model.value_string", "line"]],
              ["set", "entries", ["std.u32.push_le", "entries", ["bytes.len", "v"]]],
              ["set", "entries", ["std.vec.extend_bytes", "entries", ["bytes.view", "v"]]],
              ["set", "out_count", ["+", "out_count", 1]],
              0
            ]],
            0
          ]
        ],
        ["set", "entries", ["std.u32.write_le_at_vec_u8", "entries", 0, "out_count"]],
        ["let", "entries_b", ["std.vec.as_bytes", "entries"]],
        ["let", "seq", ["ext.data_model.value_seq_from_elems", ["bytes.view", "entries_b"]]],
        ["if", ["=", ["bytes.len", "seq"], 0], ["return", ["bytes.alloc", 0]], 0],
        ["ext.data_model.doc_ok", ["bytes.view", "seq"]]
      ]
    }
  ]
}
